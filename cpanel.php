<?php
//Default Configuration
$CONFIG = '{"lang":"en","error_reporting":false,"show_hidden":false,"hide_Cols":false,"theme":"light"}';

/**
 * H3K | FLIX FILE MANAGER 
 */

//TFM version
define('VERSION', '2.5.3');

//Application Title
define('APP_TITLE', 'FLIX File Manager');

// --- EDIT BELOW CONFIGURATION CAREFULLY ---

// Auth with login/password
// set true/false to enable/disable it
// Is independent from IP white- and blacklisting
$use_auth = true;

// Login user name and password
// Users: array('Username' => 'Password', 'Username2' => 'Password2', ...)
// Generate secure password hash - https://tinyfilemanager.github.io/docs/pwd.html
$auth_users = array(
    'admin' => '$2y$10$V3XPsbUBAyule/ny9BVx1u/zH7fGM3ELPSHXt9m0RtsyLkFEkMoEO', //Flix@123
    'user' => '$2y$10$V3XPsbUBAyule/ny9BVx1u/zH7fGM3ELPSHXt9m0RtsyLkFEkMoEO' //Flix@123
);

// Readonly users
// e.g. array('users', 'guest', ...)
$readonly_users = array(
    'user'
);

// Global readonly, including when auth is not being used
$global_readonly = false;

// user specific directories
// array('Username' => 'Directory path', 'Username2' => 'Directory path', ...)
$directories_users = array();

// Enable highlight.js (https://highlightjs.org/) on view's page
$use_highlightjs = true;

// highlight.js style
// for dark theme use 'ir-black'
$highlightjs_style = 'vs';

// Enable ace.js (https://ace.c9.io/) on view's page
$edit_files = true;

// Default timezone for date() and time()
// Doc - http://php.net/manual/en/timezones.php
$default_timezone = 'Asia/Kolkata'; // IST

// Root path for file manager
// use absolute path of directory i.e: '/var/www/folder' or $_SERVER['DOCUMENT_ROOT'].'/folder'
$root_path = $_SERVER['DOCUMENT_ROOT'];

// Root url for links in file manager.Relative to $http_host. Variants: '', 'path/to/subfolder'
// Will not working if $root_path will be outside of server document root
$root_url = '';

// Server hostname. Can set manually if wrong
// $_SERVER['HTTP_HOST'].'/folder'
$http_host = $_SERVER['HTTP_HOST'];

// input encoding for iconv
$iconv_input_encoding = 'UTF-8';

// date() format for file modification date
// Doc - https://www.php.net/manual/en/function.date.php
$datetime_format = 'm/d/Y g:i A';

// Allowed file extensions for create and rename files
// e.g. 'txt,html,css,js'
$allowed_file_extensions = '';

// Allowed file extensions for upload files
// e.g. 'gif,png,jpg,html,txt'
$allowed_upload_extensions = '';

// Favicon path. This can be either a full url to an .PNG image, or a path based on the document root.
// full path, e.g http://example.com/favicon.png
// local path, e.g images/icons/favicon.png
$favicon_path = '';

// Files and folders to excluded from listing
// e.g. array('myfile.html', 'personal-folder', '*.php', ...)
$exclude_items = array();

// Online office Docs Viewer
// Availabe rules are 'google', 'microsoft' or false
// Google => View documents using Google Docs Viewer
// Microsoft => View documents using Microsoft Web Apps Viewer
// false => disable online doc viewer
$online_viewer = 'google';

// Sticky Nav bar
// true => enable sticky header
// false => disable sticky header
$sticky_navbar = true;

// Maximum file upload size
// Increase the following values in php.ini to work properly
// memory_limit, upload_max_filesize, post_max_size
$max_upload_size_bytes = 5000000000; // size 5,000,000,000 bytes (~5GB)

// chunk size used for upload
// eg. decrease to 1MB if nginx reports problem 413 entity too large
$upload_chunk_size_bytes = 2000000; // chunk size 2,000,000 bytes (~2MB)

// Possible rules are 'OFF', 'AND' or 'OR'
// OFF => Don't check connection IP, defaults to OFF
// AND => Connection must be on the whitelist, and not on the blacklist
// OR => Connection must be on the whitelist, or not on the blacklist
$ip_ruleset = 'OFF';

// Should users be notified of their block?
$ip_silent = true;

// IP-addresses, both ipv4 and ipv6
$ip_whitelist = array(
    '127.0.0.1',    // local ipv4
    '::1'           // local ipv6
);

// IP-addresses, both ipv4 and ipv6
$ip_blacklist = array(
    '0.0.0.0',      // non-routable meta ipv4
    '::'            // non-routable meta ipv6
);

// External CDN resources that can be used in the HTML (replace for GDPR compliance)
$external = array(
    'css-bootstrap' => '<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">',
    'css-dropzone' => '<link href="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/min/dropzone.min.css" rel="stylesheet">',
    'css-font-awesome' => '<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" crossorigin="anonymous">',
    'css-highlightjs' => '<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/' . $highlightjs_style . '.min.css">',
    'js-ace' => '<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.13.1/ace.js"></script>',
    'js-bootstrap' => '<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>',
    'js-dropzone' => '<script src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/min/dropzone.min.js"></script>',
    'js-jquery' => '<script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>',
    'js-jquery-datatables' => '<script src="https://cdn.datatables.net/1.13.1/js/jquery.dataTables.min.js" crossorigin="anonymous" defer></script>',
    'js-highlightjs' => '<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>',
    'pre-jsdelivr' => '<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin/><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"/>',
    'pre-cloudflare' => '<link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin/><link rel="dns-prefetch" href="https://cdnjs.cloudflare.com"/>'
);

// if User has the external config file, try to use it to override the default config above [config.php]
// sample config - 
$config_file = __DIR__.'/config.php';
if (is_readable($config_file)) {
    @include($config_file);
}

// --- EDIT BELOW CAREFULLY OR DO NOT EDIT AT ALL ---

// max upload file size
define('MAX_UPLOAD_SIZE', $max_upload_size_bytes);

// upload chunk size
define('UPLOAD_CHUNK_SIZE', $upload_chunk_size_bytes);

// private key and session name to store to the session
if ( !defined( 'FM_SESSION_ID')) {
    define('FM_SESSION_ID', 'filemanager');
}

// Configuration
$cfg = new FM_Config();

// Default language
$lang = isset($cfg->data['lang']) ? $cfg->data['lang'] : 'en';

// Show or hide files and folders that starts with a dot
$show_hidden_files = isset($cfg->data['show_hidden']) ? $cfg->data['show_hidden'] : true;

// PHP error reporting - false = Turns off Errors, true = Turns on Errors
$report_errors = isset($cfg->data['error_reporting']) ? $cfg->data['error_reporting'] : true;

// Hide Permissions and Owner cols in file-listing
$hide_Cols = isset($cfg->data['hide_Cols']) ? $cfg->data['hide_Cols'] : true;

// Theme
$theme = isset($cfg->data['theme']) ? $cfg->data['theme'] : 'light';

define('FM_THEME', $theme);

//available languages
$lang_list = array(
    'en' => 'English'
);

if ($report_errors == true) {
    @ini_set('error_reporting', E_ALL);
    @ini_set('display_errors', 1);
} else {
    @ini_set('error_reporting', E_ALL);
    @ini_set('display_errors', 0);
}

// if fm included
if (defined('FM_EMBED')) {
    $use_auth = false;
    $sticky_navbar = false;
} else {
    @set_time_limit(600);

    date_default_timezone_set($default_timezone);

    ini_set('default_charset', 'UTF-8');
    if (version_compare(PHP_VERSION, '5.6.0', '<') && function_exists('mb_internal_encoding')) {
        mb_internal_encoding('UTF-8');
    }
    if (function_exists('mb_regex_encoding')) {
        mb_regex_encoding('UTF-8');
    }

    session_cache_limiter('nocache'); // Prevent logout issue after page was cached
    session_name(FM_SESSION_ID );
    function session_error_handling_function($code, $msg, $file, $line) {
        // Permission denied for default session, try to create a new one
        if ($code == 2) {
            session_abort();
            session_id(session_create_id());
            @session_start();
        }
    }
    set_error_handler('session_error_handling_function');
    session_start();
    restore_error_handler();
}

//Genrating CSRF Token
if (empty($_SESSION['token'])) {
    $_SESSION['token'] = bin2hex(random_bytes(32));
}

if (empty($auth_users)) {
    $use_auth = false;
}

$is_https = isset($_SERVER['HTTPS']) && ($_SERVER['HTTPS'] == 'on' || $_SERVER['HTTPS'] == 1)
    || isset($_SERVER['HTTP_X_FORWARDED_PROTO']) && $_SERVER['HTTP_X_FORWARDED_PROTO'] == 'https';

// update $root_url based on user specific directories
if (isset($_SESSION[FM_SESSION_ID]['logged']) && !empty($directories_users[$_SESSION[FM_SESSION_ID]['logged']])) {
    $wd = fm_clean_path(dirname($_SERVER['PHP_SELF']));
    $root_url =  $root_url.$wd.DIRECTORY_SEPARATOR.$directories_users[$_SESSION[FM_SESSION_ID]['logged']];
}
// clean $root_url
$root_url = fm_clean_path($root_url);

// abs path for site
defined('FM_ROOT_URL') || define('FM_ROOT_URL', ($is_https ? 'https' : 'http') . '://' . $http_host . (!empty($root_url) ? '/' . $root_url : ''));
defined('FM_SELF_URL') || define('FM_SELF_URL', ($is_https ? 'https' : 'http') . '://' . $http_host . $_SERVER['PHP_SELF']);

// logout
if (isset($_GET['logout'])) {
    unset($_SESSION[FM_SESSION_ID]['logged']);
    unset( $_SESSION['token']); 
    fm_redirect(FM_SELF_URL);
}

// Validate connection IP
if ($ip_ruleset != 'OFF') {
    function getClientIP() {
        if (array_key_exists('HTTP_CF_CONNECTING_IP', $_SERVER)) {
            return  $_SERVER["HTTP_CF_CONNECTING_IP"];
        }else if (array_key_exists('HTTP_X_FORWARDED_FOR', $_SERVER)) {
            return  $_SERVER["HTTP_X_FORWARDED_FOR"];
        }else if (array_key_exists('REMOTE_ADDR', $_SERVER)) {
            return $_SERVER['REMOTE_ADDR'];
        }else if (array_key_exists('HTTP_CLIENT_IP', $_SERVER)) {
            return $_SERVER['HTTP_CLIENT_IP'];
        }
        return '';
    }

    $clientIp = getClientIP();
    $proceed = false;
    $whitelisted = in_array($clientIp, $ip_whitelist);
    $blacklisted = in_array($clientIp, $ip_blacklist);

    if($ip_ruleset == 'AND'){
        if($whitelisted == true && $blacklisted == false){
            $proceed = true;
        }
    } else
    if($ip_ruleset == 'OR'){
         if($whitelisted == true || $blacklisted == false){
            $proceed = true;
        }
    }

    if($proceed == false){
        trigger_error('User connection denied from: ' . $clientIp, E_USER_WARNING);

        if($ip_silent == false){
            fm_set_msg(lng('Access denied. IP restriction applicable'), 'error');
            fm_show_header_login();
            fm_show_message();
        }
        exit();
    }
}

// Checking if the user is logged in or not. If not, it will show the login form.
if ($use_auth) {
    if (isset($_SESSION[FM_SESSION_ID]['logged'], $auth_users[$_SESSION[FM_SESSION_ID]['logged']])) {
        // Logged
    } elseif (isset($_POST['fm_usr'], $_POST['fm_pwd'], $_POST['token'])) {
        // Logging In
        sleep(1);
        if(function_exists('password_verify')) {
            if (isset($auth_users[$_POST['fm_usr']]) && isset($_POST['fm_pwd']) && password_verify($_POST['fm_pwd'], $auth_users[$_POST['fm_usr']]) && verifyToken($_POST['token'])) {
                $_SESSION[FM_SESSION_ID]['logged'] = $_POST['fm_usr'];
                fm_set_msg(lng('You are logged in'));
                fm_redirect(FM_ROOT_URL);
            } else {
                unset($_SESSION[FM_SESSION_ID]['logged']);
                fm_set_msg(lng('Login failed. Invalid username or password'), 'error');
                fm_redirect(FM_ROOT_URL);
            }
        } else {
            fm_set_msg(lng('password_hash not supported, Upgrade PHP version'), 'error');;
        }
    } else {
        // Form
        unset($_SESSION[FM_SESSION_ID]['logged']);
        fm_show_header_login();
        ?>
        <section class="h-100">
            <div class="container h-100">
                <div class="row justify-content-md-center h-100">
                    <div class="card-wrapper">
                        <div class="card fat <?php echo fm_get_theme(); ?>">
                            <div class="card-body">
                                <form class="form-signin" action="" method="post" autocomplete="off">
                                    <div class="mb-3">
                                       <div class="brand">
<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="100%" viewBox="0 0 1280 1280" enable-background="new 0 0 1280 1280" xml:space="preserve">
<path fill="#000000" opacity="000000" stroke="none" 
	d="
M582.000000,1281.000000 
	C388.000000,1281.000000 194.500000,1281.000000 1.000000,1281.000000 
	C1.000000,854.333313 1.000000,427.666656 1.000000,1.000000 
	C427.666656,1.000000 854.333313,1.000000 1281.000000,1.000000 
	C1281.000000,427.666656 1281.000000,854.333313 1281.000000,1281.000000 
	C1048.166626,1281.000000 815.333313,1281.000000 582.000000,1281.000000 
M903.955383,840.058350 
	C903.955383,840.058350 903.865967,840.060425 904.171875,840.700012 
	C905.434204,841.183777 906.696594,841.667542 907.959595,842.065002 
	C907.959595,842.065002 907.873413,842.068604 908.279175,842.761414 
	C910.128662,842.779053 911.978210,842.796692 914.699036,842.960205 
	C915.942688,843.281738 917.189148,843.893616 918.429626,843.881897 
	C946.054321,843.620605 973.678162,843.268555 1001.302673,842.984192 
	C1012.476624,842.869141 1016.743042,836.130981 1016.938782,826.026733 
	C1017.254517,809.724670 1017.083374,793.409363 1016.863342,777.103027 
	C1016.791199,771.754456 1016.915955,767.125244 1022.771912,764.422058 
	C1025.303101,763.253601 1026.965332,759.418457 1030.391724,762.002869 
	C1034.125488,764.819031 1040.106934,765.420105 1040.053101,772.148376 
	C1039.909546,790.095886 1039.585571,808.058716 1040.161133,825.988892 
	C1040.508179,836.800293 1042.553955,839.959351 1051.135986,842.558044 
	C1054.832642,843.677490 1058.916260,843.917053 1062.819824,843.890869 
	C1090.104980,843.707947 1117.389038,843.356079 1144.673462,843.046143 
	C1153.369995,842.947388 1158.312134,838.595032 1158.843018,830.135742 
	C1159.364502,821.828247 1159.755249,813.498657 1159.790771,805.177002 
	C1159.914673,776.120178 1159.808350,747.062317 1159.901611,718.005249 
	C1159.933594,708.033081 1157.998657,699.362061 1148.349854,693.873108 
	C1143.568970,691.153381 1139.460449,687.251709 1134.794922,683.691711 
	C1139.042603,680.287354 1142.499634,676.376465 1146.833862,674.275635 
	C1156.442871,669.618042 1159.836304,662.148132 1159.669678,652.004333 
	C1159.464966,639.528137 1159.781982,627.044128 1159.783447,614.563538 
	C1159.786133,591.095398 1159.695435,567.627319 1159.697388,544.159180 
	C1159.699341,520.949524 1159.863892,497.739502 1159.767700,474.530396 
	C1159.716675,462.217499 1159.413574,449.900360 1158.925171,437.596985 
	C1158.699829,431.920410 1153.682007,426.094604 1148.515259,425.219238 
	C1145.412720,424.693604 1142.177979,424.948303 1138.548096,424.122314 
	C1113.522949,424.082031 1088.497681,424.032623 1063.472534,424.040588 
	C1062.626343,424.040863 1061.780396,424.618805 1060.026611,424.995392 
	C1057.586304,425.063324 1055.145874,425.131256 1052.151855,425.020721 
	C1051.723511,425.326263 1051.295044,425.631775 1050.949097,425.937469 
	C1050.949097,425.937469 1050.944702,425.855194 1050.201294,425.981964 
	C1047.752686,427.969666 1045.303955,429.957367 1042.936279,431.949219 
	C1042.936279,431.949219 1042.935669,431.868225 1042.273071,432.227875 
	C1041.795166,434.144501 1041.317261,436.061127 1040.095581,438.428436 
	C1040.063110,456.674835 1039.989624,474.921295 1040.006714,493.167664 
	C1040.039307,527.828674 1040.123779,562.489685 1040.010132,597.776062 
	C1039.598022,598.513611 1039.185791,599.251099 1038.360962,600.063354 
	C1038.089111,600.222229 1037.965454,600.458618 1037.301392,600.978088 
	C1035.150391,602.629028 1032.999268,604.279968 1030.250244,605.950073 
	C1029.858521,606.009827 1029.466919,606.069580 1028.339722,606.010559 
	C1027.607788,606.069702 1026.875732,606.128845 1025.462646,605.979370 
	C1023.808350,604.359985 1022.421570,602.000305 1020.440735,601.284607 
	C1016.965698,600.028992 1016.967468,597.883179 1016.972717,594.888855 
	C1017.061340,543.930481 1017.128479,492.971497 1016.897156,442.014038 
	C1016.873657,436.832764 1016.451111,430.392029 1011.014526,427.838531 
	C1006.558655,425.745728 1001.086853,425.815857 995.623535,424.174713 
	C970.438293,424.117493 945.252991,424.053497 920.067749,424.038940 
	C919.377319,424.038544 918.686584,424.571045 917.100037,424.995361 
	C914.937866,424.995270 912.764771,424.854797 910.615540,425.021545 
	C904.301453,425.511414 898.809570,430.862579 898.115479,436.821991 
	C897.265808,444.117401 897.397888,451.546021 897.388000,458.917419 
	C897.302124,522.699402 897.171875,586.481750 897.371277,650.263000 
	C897.397095,658.528381 896.972778,667.788147 907.128357,672.644775 
	C907.782593,673.052734 908.436768,673.460693 909.413696,674.025024 
	C909.413696,674.025024 909.771851,674.007019 910.082031,674.593689 
	C911.440369,675.568848 912.798767,676.544006 914.210815,677.801575 
	C914.210815,677.801575 914.493958,677.851196 914.881836,678.312805 
	C915.585022,678.617249 916.288208,678.921631 917.063721,679.639038 
	C917.222412,679.911438 917.458801,680.034485 918.065002,680.570679 
	C918.729309,680.955750 919.393616,681.340820 920.643494,682.020630 
	C922.882690,684.303345 920.252747,685.205505 919.199341,686.073425 
	C916.586792,688.225952 913.737854,690.111511 910.881226,691.944153 
	C902.341309,697.422913 897.392273,704.267395 897.503723,715.326782 
	C897.843811,749.056335 897.142822,782.795288 897.208130,816.529846 
	C897.220093,822.698730 898.930054,828.864380 899.989868,835.682861 
	C900.323792,836.197327 900.657776,836.711792 900.974854,837.586121 
	C900.974854,837.586121 901.131409,837.910583 901.126282,838.593079 
	C902.068665,839.111267 903.011047,839.629517 903.955383,840.058350 
M295.052216,730.069702 
	C295.052216,730.069702 295.055328,730.144104 295.749084,730.010376 
	C297.328156,729.294250 298.907227,728.578125 300.783417,727.808289 
	C300.783417,727.808289 300.848328,727.513367 301.349060,727.092407 
	C302.278076,725.389771 303.207092,723.687195 304.873779,721.621216 
	C305.219452,719.068298 305.855347,716.516541 305.865692,713.962280 
	C305.962585,689.984436 306.042755,666.005676 305.904205,642.028503 
	C305.873108,636.645264 304.501831,631.382202 299.506256,628.232117 
	C297.160858,626.753113 294.389313,625.950012 291.443848,624.092224 
	C288.280579,624.061523 285.117401,624.011108 281.954071,624.003235 
	C255.642151,623.937805 229.330215,623.880310 202.948441,622.906677 
	C202.948441,591.083557 202.948441,559.260498 202.948441,526.878723 
	C211.522049,527.274719 219.533920,527.601990 227.540421,528.030334 
	C232.459885,528.293457 237.369202,528.740723 242.286346,529.053894 
	C257.321228,530.011719 272.356018,531.648621 287.394012,531.684326 
	C301.729645,531.718384 305.245819,526.686523 305.706726,514.377319 
	C306.610992,490.225403 305.965302,466.016357 306.013977,441.831085 
	C306.035400,431.197937 299.809906,424.988495 288.987793,424.997406 
	C287.659973,424.998474 286.332092,424.902924 284.548737,424.122650 
	C225.210114,424.082184 165.871475,424.037994 106.532845,424.038239 
	C105.679672,424.038269 104.826492,424.593811 103.135849,425.000244 
	C101.172646,425.169312 99.208786,425.331024 97.246368,425.508728 
	C88.799423,426.273529 83.939415,431.715881 83.944885,440.300171 
	C83.980957,496.952789 84.017517,553.605408 84.002449,610.258057 
	C84.001228,614.866882 85.356888,621.394043 82.949852,623.578491 
	C80.199219,626.074768 73.946404,624.852417 69.208122,624.984253 
	C62.580933,625.168701 57.118397,629.124695 56.010788,635.382568 
	C54.218525,645.508667 55.067528,655.286133 59.801620,664.719849 
	C63.453938,671.997925 66.313599,679.670898 69.615845,687.128357 
	C73.405724,695.687012 77.566200,704.093872 81.022591,712.782715 
	C82.663979,716.908875 83.841980,721.531494 83.869797,725.937744 
	C84.084862,759.997192 83.870682,794.059326 84.042778,828.119324 
	C84.073059,834.112915 86.179192,839.817200 92.678261,841.743469 
	C97.128128,843.062256 101.907372,843.821716 106.546669,843.856384 
	C130.086334,844.032776 153.629181,843.986572 177.169128,843.797485 
	C183.659927,843.745239 189.958633,844.435059 196.045639,839.420898 
	C200.158264,836.033020 202.893799,832.844788 202.933304,828.076477 
	C203.127136,804.674683 202.955093,781.269958 202.923523,757.866272 
	C202.909271,747.304993 202.921112,736.743713 202.921112,726.240723 
	C214.809570,727.213440 226.037415,728.227600 237.281036,729.017029 
	C244.336624,729.512512 251.420578,729.591064 258.483124,730.004822 
	C264.214111,730.340515 269.925751,731.126831 275.657837,731.286621 
	C280.817719,731.430481 285.993744,730.994568 291.873627,730.981995 
	C292.957977,730.678467 294.042297,730.374939 295.052216,730.069702 
M583.749390,840.008606 
	C584.242004,839.341797 584.734558,838.674988 585.639709,837.936890 
	C585.912109,837.778503 586.034729,837.542358 586.650818,836.847595 
	C587.150757,835.240784 587.650635,833.633972 588.898621,831.581482 
	C588.942566,830.918579 589.048462,830.253052 589.021362,829.593079 
	C588.356995,813.434814 587.687744,797.276855 586.998535,781.119629 
	C586.676514,773.570374 586.448914,766.013733 585.938721,758.476685 
	C584.645081,739.368713 583.165955,720.273254 581.861084,701.166016 
	C581.149597,690.747498 581.060486,680.268738 579.914673,669.902954 
	C578.925354,660.953186 574.445312,654.686646 563.492249,654.968018 
	C552.766541,655.243530 542.039246,655.524475 531.320984,655.993042 
	C526.256470,656.214478 521.211182,656.876709 516.157593,657.344177 
	C505.985535,658.285095 495.813782,659.229431 485.652527,660.171326 
	C485.652527,647.882324 485.651520,635.991455 485.652710,624.100586 
	C485.658478,565.691650 485.687012,507.282715 485.625122,448.873901 
	C485.620636,444.613495 485.576599,440.188141 484.481720,436.127777 
	C482.085907,427.243103 478.428131,425.386536 464.580414,424.144623 
	C439.544678,424.096924 414.508911,424.040131 389.473175,424.040710 
	C388.626404,424.040741 387.779663,424.618744 386.036133,424.993591 
	C384.871094,424.996521 383.701599,424.933716 382.541718,425.012543 
	C371.219116,425.781982 366.788757,429.471985 366.620117,442.198975 
	C366.387360,459.762970 366.550995,477.331879 366.477203,494.898407 
	C366.378754,518.343445 366.107361,541.788147 366.110413,565.233032 
	C366.113434,588.446228 366.478973,611.659424 366.479340,634.872620 
	C366.479858,664.864014 366.229004,694.855286 366.172150,724.846741 
	C366.107239,759.100647 366.148071,793.354614 366.114716,827.608582 
	C366.108551,833.942078 371.429596,841.441223 377.436249,842.752991 
	C380.925201,843.514954 384.573303,843.856323 388.150421,843.860657 
	C447.606934,843.933167 507.063599,843.928589 566.520203,843.894226 
	C568.035522,843.893372 569.550659,843.360535 571.929932,843.007812 
	C575.986206,843.247437 579.943970,843.112488 583.044434,840.058716 
	C583.044434,840.058716 583.047241,840.148438 583.749390,840.008606 
M644.164734,837.687805 
	C645.692993,839.048462 647.221252,840.409058 649.384399,841.736938 
	C649.593201,841.700928 649.802063,841.664917 650.548401,842.044067 
	C653.011902,842.389038 655.475464,842.734070 658.376648,843.844666 
	C709.520508,843.577637 760.664185,843.249084 811.808411,843.108582 
	C819.679871,843.086975 826.565002,836.498718 826.712158,828.220581 
	C827.092590,806.815491 826.978027,785.399048 826.797363,763.989319 
	C826.769653,760.702759 826.354675,756.474609 824.350403,754.350525 
	C820.451782,750.218811 815.615967,746.803528 809.162720,747.061646 
	C803.076416,747.304993 796.964600,746.880554 790.874756,747.078857 
	C788.046753,747.170959 787.230591,745.967346 787.272888,743.536377 
	C787.439880,733.928345 787.776001,724.320190 787.762085,714.712585 
	C787.668640,650.387146 787.516602,586.061829 787.304504,521.736755 
	C787.295654,519.058716 787.954651,518.059204 790.746094,518.232666 
	C797.282471,518.638672 803.844482,519.150879 810.378113,518.970520 
	C821.726807,518.657349 826.137085,512.903748 826.351685,502.783325 
	C826.785400,482.323730 826.677979,461.853088 826.859924,441.387573 
	C826.925659,433.994415 821.501221,426.603485 814.488159,425.282776 
	C811.755249,424.768097 808.877319,425.023071 805.623718,424.174866 
	C801.859192,424.116730 798.090515,423.921936 794.331116,424.034760 
	C789.548645,424.178345 784.773682,424.571075 779.066589,424.993683 
	C758.316650,424.994843 737.566772,424.983002 716.816833,425.000244 
	C688.377197,425.023865 659.937561,425.064606 631.497925,425.111542 
	C627.700134,425.117798 620.157288,429.591888 619.299866,432.623901 
	C616.154419,443.746429 616.812988,454.616821 621.656250,465.214661 
	C625.300049,473.187866 628.619934,481.310364 632.327209,489.252869 
	C635.002441,494.984375 638.077576,500.529236 640.751221,506.785736 
	C645.121399,520.819336 657.080750,518.864258 667.999634,519.032532 
	C667.999634,521.415588 667.999634,523.227173 667.999634,525.038818 
	C667.999634,598.188782 668.000793,671.338806 667.993164,744.488770 
	C667.992981,746.318176 667.896667,748.147644 666.953979,749.953064 
	C660.257324,750.315308 653.548584,750.531555 646.867676,751.084229 
	C641.085510,751.562439 635.129150,751.727478 629.641235,753.352661 
	C625.845886,754.476624 620.826172,757.144043 619.632019,760.344910 
	C615.490906,771.444092 616.986145,782.777649 621.985779,793.499084 
	C624.691711,799.301758 627.798340,804.916565 630.681458,810.637695 
	C635.115967,819.437378 639.513733,828.255615 644.164734,837.687805 
z"/>
<path fill="#02CBFB" opacity="1.000000" stroke="none" 
	d="
M899.856201,835.031494 
	C898.930054,828.864380 897.220093,822.698730 897.208130,816.529846 
	C897.142822,782.795288 897.843811,749.056335 897.503723,715.326782 
	C897.392273,704.267395 902.341309,697.422913 910.881226,691.944153 
	C913.737854,690.111511 916.586792,688.225952 919.199341,686.073425 
	C920.252747,685.205505 922.882690,684.303345 920.219238,681.594238 
	C919.121033,680.781311 918.447021,680.394653 917.773010,680.008057 
	C917.458801,680.034485 917.222412,679.911438 916.941467,679.089355 
	C916.044128,678.310181 915.269043,678.080688 914.493958,677.851196 
	C914.493958,677.851196 914.210815,677.801575 914.306274,677.306274 
	C912.858459,675.876282 911.315186,674.941650 909.771851,674.007019 
	C909.771851,674.007019 909.413696,674.025024 909.225830,673.676392 
	C908.334595,672.907715 907.631226,672.487732 906.927795,672.067749 
	C896.972778,667.788147 897.397095,658.528381 897.371277,650.263000 
	C897.171875,586.481750 897.302124,522.699402 897.388000,458.917419 
	C897.397888,451.546021 897.265808,444.117401 898.115479,436.821991 
	C898.809570,430.862579 904.301453,425.511414 910.615540,425.021545 
	C912.764771,424.854797 914.937866,424.995270 917.755615,425.086487 
	C929.289978,425.158905 940.168945,425.154785 951.047729,425.118042 
	C966.053711,425.067352 981.059509,424.992004 996.065430,424.927185 
	C1001.086853,425.815857 1006.558655,425.745728 1011.014526,427.838531 
	C1016.451111,430.392029 1016.873657,436.832764 1016.897156,442.014038 
	C1017.128479,492.971497 1017.061340,543.930481 1016.972717,594.888855 
	C1016.967468,597.883179 1016.965698,600.028992 1020.440735,601.284607 
	C1022.421570,602.000305 1023.808350,604.359985 1025.844482,606.309082 
	C1027.176025,606.468994 1028.125610,606.299133 1029.075195,606.129272 
	C1029.466919,606.069580 1029.858521,606.009827 1030.790649,606.123291 
	C1033.550659,604.455200 1035.770264,602.613831 1037.989990,600.772461 
	C1037.965454,600.458618 1038.089111,600.222229 1038.877686,599.983032 
	C1039.658569,598.985413 1039.922607,598.068054 1040.186768,597.150696 
	C1040.123779,562.489685 1040.039307,527.828674 1040.006714,493.167664 
	C1039.989624,474.921295 1040.063110,456.674835 1040.750244,437.970154 
	C1041.915161,435.630646 1042.425415,433.749451 1042.935669,431.868225 
	C1042.935669,431.868225 1042.936279,431.949219 1043.254272,431.918213 
	C1046.029785,429.876495 1048.487183,427.865845 1050.944702,425.855194 
	C1050.944702,425.855194 1050.949097,425.937469 1051.170898,425.936279 
	C1051.830200,425.689789 1052.267944,425.444458 1052.705566,425.199158 
	C1055.145874,425.131256 1057.586304,425.063324 1060.854370,424.977539 
	C1062.508179,425.059387 1063.334106,425.244415 1064.160278,425.246155 
	C1080.216064,425.279938 1096.272217,425.346710 1112.327637,425.287689 
	C1121.219727,425.255005 1130.110962,425.004578 1139.002563,424.852295 
	C1142.177979,424.948303 1145.412720,424.693604 1148.515259,425.219238 
	C1153.682007,426.094604 1158.699829,431.920410 1158.925171,437.596985 
	C1159.413574,449.900360 1159.716675,462.217499 1159.767700,474.530396 
	C1159.863892,497.739502 1159.699341,520.949524 1159.697388,544.159180 
	C1159.695435,567.627319 1159.786133,591.095398 1159.783447,614.563538 
	C1159.781982,627.044128 1159.464966,639.528137 1159.669678,652.004333 
	C1159.836304,662.148132 1156.442871,669.618042 1146.833862,674.275635 
	C1142.499634,676.376465 1139.042603,680.287354 1134.794922,683.691711 
	C1139.460449,687.251709 1143.568970,691.153381 1148.349854,693.873108 
	C1157.998657,699.362061 1159.933594,708.033081 1159.901611,718.005249 
	C1159.808350,747.062317 1159.914673,776.120178 1159.790771,805.177002 
	C1159.755249,813.498657 1159.364502,821.828247 1158.843018,830.135742 
	C1158.312134,838.595032 1153.369995,842.947388 1144.673462,843.046143 
	C1117.389038,843.356079 1090.104980,843.707947 1062.819824,843.890869 
	C1058.916260,843.917053 1054.832642,843.677490 1051.135986,842.558044 
	C1042.553955,839.959351 1040.508179,836.800293 1040.161133,825.988892 
	C1039.585571,808.058716 1039.909546,790.095886 1040.053101,772.148376 
	C1040.106934,765.420105 1034.125488,764.819031 1030.391724,762.002869 
	C1026.965332,759.418457 1025.303101,763.253601 1022.771912,764.422058 
	C1016.915955,767.125244 1016.791199,771.754456 1016.863342,777.103027 
	C1017.083374,793.409363 1017.254517,809.724670 1016.938782,826.026733 
	C1016.743042,836.130981 1012.476624,842.869141 1001.302673,842.984192 
	C973.678162,843.268555 946.054321,843.620605 918.429626,843.881897 
	C917.189148,843.893616 915.942688,843.281738 914.147339,842.659424 
	C911.688232,842.261963 909.780823,842.165283 907.873413,842.068604 
	C907.873413,842.068604 907.959595,842.065002 907.877197,841.749268 
	C906.485229,840.975830 905.175598,840.518127 903.865967,840.060425 
	C903.865967,840.060425 903.955383,840.058350 903.901978,839.771973 
	C902.942871,838.960632 902.037170,838.435608 901.131409,837.910583 
	C901.131409,837.910583 900.974854,837.586121 900.944092,837.086426 
	C900.560913,836.068237 900.208557,835.549866 899.856201,835.031494 
M1145.910400,450.650604 
	C1145.885132,439.806915 1144.177490,438.066559 1133.533691,438.065338 
	C1111.035278,438.062805 1088.536865,438.061859 1066.038452,438.065948 
	C1055.711548,438.067841 1053.950806,439.860992 1053.950806,450.358612 
	C1053.951294,501.688324 1053.983521,553.018066 1053.852295,604.347473 
	C1053.846802,606.514954 1052.958496,609.466248 1051.406128,610.706909 
	C1044.905762,615.901794 1038.074951,620.702026 1031.158813,625.339294 
	C1029.969116,626.137085 1027.325073,626.121399 1026.125244,625.322021 
	C1019.751770,621.075562 1013.747437,616.273499 1007.359619,612.050476 
	C1004.198059,609.960449 1003.185730,607.638733 1003.195923,603.875549 
	C1003.336060,552.046265 1003.302368,500.216492 1003.292786,448.386841 
	C1003.291321,440.544281 1000.917969,438.085358 993.272400,438.075897 
	C969.274109,438.046234 945.275696,438.041473 921.277466,438.082123 
	C914.194824,438.094116 911.373474,440.765747 911.369995,447.639130 
	C911.335754,514.967712 911.364624,582.296265 911.317322,649.624817 
	C911.314453,653.700684 912.961426,656.530823 916.239990,658.823364 
	C922.793213,663.405945 929.215454,668.175842 935.692688,672.867188 
	C940.477905,676.333130 945.264587,679.796997 950.566467,683.635254 
	C939.159729,691.968506 928.516357,699.957397 917.626709,707.595276 
	C913.236389,710.674561 911.267029,714.339478 911.286804,719.705322 
	C911.409058,752.869141 911.330688,786.033752 911.355652,819.198059 
	C911.362000,827.638062 913.562439,829.785706 922.125549,829.794373 
	C945.623901,829.818237 969.122192,829.816284 992.620544,829.795654 
	C1001.280701,829.788025 1003.289978,827.792236 1003.295593,819.258179 
	C1003.307983,800.426147 1003.361572,781.593689 1003.220642,762.762634 
	C1003.197021,759.610718 1003.998047,757.530640 1006.701355,755.710693 
	C1012.918457,751.525085 1019.009277,747.131165 1024.933228,742.540344 
	C1027.605591,740.469421 1029.506592,740.258606 1032.288208,742.443787 
	C1038.179932,747.072327 1044.297974,751.432373 1050.512817,755.621094 
	C1053.203735,757.434753 1054.045776,759.500977 1054.023193,762.661865 
	C1053.886108,781.826172 1053.921143,800.992065 1053.967896,820.157227 
	C1053.985596,827.407410 1056.309204,829.762390 1063.580200,829.778931 
	C1087.744995,829.834045 1111.910278,829.832581 1136.075073,829.783630 
	C1143.594971,829.768372 1145.881714,827.444946 1145.890747,819.791748 
	C1145.930420,786.127441 1145.883423,752.463196 1145.929321,718.798950 
	C1145.935547,714.271118 1144.328247,710.896545 1140.545532,708.229004 
	C1131.695190,701.987854 1123.009155,695.513672 1114.273438,689.110718 
	C1111.924561,687.389038 1109.636597,685.584290 1106.935303,683.523743 
	C1117.737061,675.697266 1127.795044,667.998291 1138.298950,660.965454 
	C1143.896851,657.217346 1146.062500,652.885559 1146.039062,646.099182 
	C1145.816040,581.271240 1145.908325,516.442200 1145.910400,450.650604 
z"/>
<path fill="#02CAFA" opacity="1.000000" stroke="none" 
	d="
M291.810852,624.840637 
	C294.389313,625.950012 297.160858,626.753113 299.506256,628.232117 
	C304.501831,631.382202 305.873108,636.645264 305.904205,642.028503 
	C306.042755,666.005676 305.962585,689.984436 305.865692,713.962280 
	C305.855347,716.516541 305.219452,719.068298 304.201630,721.984131 
	C302.635773,724.069153 301.742035,725.791260 300.848328,727.513367 
	C300.848328,727.513367 300.783417,727.808289 300.332397,727.677734 
	C297.785095,727.506653 295.292023,726.728821 295.055328,730.144104 
	C295.055328,730.144104 295.052216,730.069702 294.803589,730.008545 
	C293.424194,730.236389 292.293427,730.525391 291.162659,730.814453 
	C285.993744,730.994568 280.817719,731.430481 275.657837,731.286621 
	C269.925751,731.126831 264.214111,730.340515 258.483124,730.004822 
	C251.420578,729.591064 244.336624,729.512512 237.281036,729.017029 
	C226.037415,728.227600 214.809570,727.213440 202.921112,726.240723 
	C202.921112,736.743713 202.909271,747.304993 202.923523,757.866272 
	C202.955093,781.269958 203.127136,804.674683 202.933304,828.076477 
	C202.893799,832.844788 200.158264,836.033020 196.045639,839.420898 
	C189.958633,844.435059 183.659927,843.745239 177.169128,843.797485 
	C153.629181,843.986572 130.086334,844.032776 106.546669,843.856384 
	C101.907372,843.821716 97.128128,843.062256 92.678261,841.743469 
	C86.179192,839.817200 84.073059,834.112915 84.042778,828.119324 
	C83.870682,794.059326 84.084862,759.997192 83.869797,725.937744 
	C83.841980,721.531494 82.663979,716.908875 81.022591,712.782715 
	C77.566200,704.093872 73.405724,695.687012 69.615845,687.128357 
	C66.313599,679.670898 63.453938,671.997925 59.801620,664.719849 
	C55.067528,655.286133 54.218525,645.508667 56.010788,635.382568 
	C57.118397,629.124695 62.580933,625.168701 69.208122,624.984253 
	C73.946404,624.852417 80.199219,626.074768 82.949852,623.578491 
	C85.356888,621.394043 84.001228,614.866882 84.002449,610.258057 
	C84.017517,553.605408 83.980957,496.952789 83.944885,440.300171 
	C83.939415,431.715881 88.799423,426.273529 97.246368,425.508728 
	C99.208786,425.331024 101.172646,425.169312 103.838013,425.100098 
	C114.631508,425.166321 124.722824,425.114868 134.814178,425.102997 
	C152.002060,425.082794 169.189957,425.080933 186.377853,425.083435 
	C203.907364,425.086029 221.436966,425.140594 238.966370,425.102661 
	C254.312439,425.069458 269.658295,424.939453 285.004242,424.852173 
	C286.332092,424.902924 287.659973,424.998474 288.987793,424.997406 
	C299.809906,424.988495 306.035400,431.197937 306.013977,441.831085 
	C305.965302,466.016357 306.610992,490.225403 305.706726,514.377319 
	C305.245819,526.686523 301.729645,531.718384 287.394012,531.684326 
	C272.356018,531.648621 257.321228,530.011719 242.286346,529.053894 
	C237.369202,528.740723 232.459885,528.293457 227.540421,528.030334 
	C219.533920,527.601990 211.522049,527.274719 202.948441,526.878723 
	C202.948441,559.260498 202.948441,591.083557 203.115906,623.596985 
	C204.946701,624.688354 206.609512,625.435974 208.273483,625.438538 
	C233.979462,625.478088 259.685608,625.433594 285.391602,625.362854 
	C287.531830,625.356995 289.671112,625.022461 291.810852,624.840637 
M98.396385,722.519531 
	C98.396347,754.350342 98.390312,786.181213 98.399757,818.012024 
	C98.402748,828.102478 100.044380,829.775452 109.924072,829.780090 
	C132.922577,829.790833 155.921066,829.789612 178.919571,829.782776 
	C188.509888,829.779968 190.247589,828.040344 190.248322,818.383850 
	C190.250824,784.719421 190.237808,751.054932 190.230759,717.390503 
	C190.230362,715.455627 190.230713,713.520752 190.230713,711.336121 
	C192.095078,711.336121 193.249252,711.265015 194.392563,711.346436 
	C223.477859,713.417297 252.563858,715.479309 281.645233,717.604187 
	C289.845398,718.203430 292.878845,715.485718 292.887115,707.102722 
	C292.906281,687.604004 292.907898,668.105225 292.887451,648.606506 
	C292.878571,640.124146 290.708038,637.941772 282.275024,637.937744 
	C253.610229,637.923889 224.945435,637.935425 196.280640,637.937256 
	C194.371857,637.937378 192.463074,637.937256 190.658981,637.937256 
	C190.658981,595.391907 190.658981,553.684265 190.658981,511.835693 
	C192.737488,511.835693 194.388092,511.735931 196.023651,511.850647 
	C224.278427,513.832458 252.530884,515.847595 280.784973,517.839355 
	C290.385864,518.516113 292.886047,516.221069 292.891083,506.755127 
	C292.901184,487.756378 292.897858,468.757599 292.892700,449.758850 
	C292.890106,440.144897 290.809296,438.079834 281.110046,438.079254 
	C224.280426,438.075989 167.450806,438.076935 110.621185,438.078156 
	C100.116417,438.078369 98.398247,439.784943 98.398079,450.271423 
	C98.397087,510.767487 98.401642,571.263550 98.404312,631.759583 
	C98.404396,633.679871 98.404327,635.600159 98.404327,637.930786 
	C92.492546,637.930786 87.324738,638.299194 82.227150,637.857422 
	C69.994469,636.797302 68.251984,643.765015 72.367081,652.529175 
	C80.145134,669.094604 86.987556,686.096863 94.534828,702.774597 
	C97.276268,708.832458 99.142944,714.856079 98.396385,722.519531 
z"/>
<path fill="#02CBFA" opacity="1.000000" stroke="none" 
	d="
M465.025085,424.888702 
	C478.428131,425.386536 482.085907,427.243103 484.481720,436.127777 
	C485.576599,440.188141 485.620636,444.613495 485.625122,448.873901 
	C485.687012,507.282715 485.658478,565.691650 485.652710,624.100586 
	C485.651520,635.991455 485.652527,647.882324 485.652527,660.171326 
	C495.813782,659.229431 505.985535,658.285095 516.157593,657.344177 
	C521.211182,656.876709 526.256470,656.214478 531.320984,655.993042 
	C542.039246,655.524475 552.766541,655.243530 563.492249,654.968018 
	C574.445312,654.686646 578.925354,660.953186 579.914673,669.902954 
	C581.060486,680.268738 581.149597,690.747498 581.861084,701.166016 
	C583.165955,720.273254 584.645081,739.368713 585.938721,758.476685 
	C586.448914,766.013733 586.676514,773.570374 586.998535,781.119629 
	C587.687744,797.276855 588.356995,813.434814 589.021362,829.593079 
	C589.048462,830.253052 588.942566,830.918579 588.201294,831.987061 
	C587.005188,834.004517 586.506348,835.616455 586.007568,837.228394 
	C586.034729,837.542358 585.912109,837.778503 585.095703,838.029602 
	C584.050232,838.797668 583.548706,839.473083 583.047241,840.148438 
	C583.047241,840.148438 583.044434,840.058716 582.665710,840.037476 
	C578.546631,841.036072 574.806274,842.055969 571.065857,843.075806 
	C569.550659,843.360535 568.035522,843.893372 566.520203,843.894226 
	C507.063599,843.928589 447.606934,843.933167 388.150421,843.860657 
	C384.573303,843.856323 380.925201,843.514954 377.436249,842.752991 
	C371.429596,841.441223 366.108551,833.942078 366.114716,827.608582 
	C366.148071,793.354614 366.107239,759.100647 366.172150,724.846741 
	C366.229004,694.855286 366.479858,664.864014 366.479340,634.872620 
	C366.478973,611.659424 366.113434,588.446228 366.110413,565.233032 
	C366.107361,541.788147 366.378754,518.343445 366.477203,494.898407 
	C366.550995,477.331879 366.387360,459.762970 366.620117,442.198975 
	C366.788757,429.471985 371.219116,425.781982 382.541718,425.012543 
	C383.701599,424.933716 384.871094,424.996521 386.887512,424.967468 
	C413.500977,424.923828 439.263031,424.906281 465.025085,424.888702 
M491.465179,737.226074 
	C491.465179,743.139893 491.465179,749.053711 491.465179,755.305603 
	C484.922760,755.688965 478.870209,756.043579 472.341064,756.426147 
	C472.341064,753.885864 472.340942,752.086060 472.341064,750.286255 
	C472.347412,649.979919 472.356049,549.673645 472.356445,449.367310 
	C472.356476,440.012421 470.373016,438.093445 460.790192,438.091034 
	C438.129639,438.085327 415.469055,438.086792 392.808502,438.090210 
	C382.627747,438.091736 380.876831,439.836090 380.876740,449.973297 
	C380.875580,572.606934 380.875458,695.240540 380.876831,817.874207 
	C380.876953,828.237061 382.390594,829.764648 392.692780,829.765381 
	C450.177307,829.769287 507.661835,829.769226 565.146362,829.760681 
	C566.809204,829.760437 568.496948,829.811462 570.129700,829.558411 
	C573.687622,829.007263 575.825439,826.921387 576.031616,823.234497 
	C576.142944,821.244446 576.068481,819.234436 575.943298,817.241943 
	C573.007202,770.523926 570.064636,723.806396 567.087280,677.091064 
	C566.681274,670.720825 563.604309,668.066467 557.374573,668.549011 
	C538.274719,670.028320 519.177063,671.535706 500.078979,673.036743 
	C493.187592,673.578369 490.964142,675.920105 491.010864,682.790161 
	C491.132111,700.618164 491.302124,718.445801 491.465179,737.226074 
z"/>
<path fill="#02CBFB" opacity="1.000000" stroke="none" 
	d="
M640.974365,506.157349 
	C638.077576,500.529236 635.002441,494.984375 632.327209,489.252869 
	C628.619934,481.310364 625.300049,473.187866 621.656250,465.214661 
	C616.812988,454.616821 616.154419,443.746429 619.299866,432.623901 
	C620.157288,429.591888 627.700134,425.117798 631.497925,425.111542 
	C659.937561,425.064606 688.377197,425.023865 716.816833,425.000244 
	C737.566772,424.983002 758.316650,424.994843 779.775635,425.071838 
	C789.011658,425.075867 797.538574,425.001678 806.065491,424.927490 
	C808.877319,425.023071 811.755249,424.768097 814.488159,425.282776 
	C821.501221,426.603485 826.925659,433.994415 826.859924,441.387573 
	C826.677979,461.853088 826.785400,482.323730 826.351685,502.783325 
	C826.137085,512.903748 821.726807,518.657349 810.378113,518.970520 
	C803.844482,519.150879 797.282471,518.638672 790.746094,518.232666 
	C787.954651,518.059204 787.295654,519.058716 787.304504,521.736755 
	C787.516602,586.061829 787.668640,650.387146 787.762085,714.712585 
	C787.776001,724.320190 787.439880,733.928345 787.272888,743.536377 
	C787.230591,745.967346 788.046753,747.170959 790.874756,747.078857 
	C796.964600,746.880554 803.076416,747.304993 809.162720,747.061646 
	C815.615967,746.803528 820.451782,750.218811 824.350403,754.350525 
	C826.354675,756.474609 826.769653,760.702759 826.797363,763.989319 
	C826.978027,785.399048 827.092590,806.815491 826.712158,828.220581 
	C826.565002,836.498718 819.679871,843.086975 811.808411,843.108582 
	C760.664185,843.249084 709.520508,843.577637 658.027832,843.224854 
	C655.122986,842.279724 652.566956,841.954346 650.010864,841.628906 
	C649.802063,841.664917 649.593201,841.700928 649.096802,841.356934 
	C647.181824,839.673279 645.554443,838.369629 643.927063,837.065979 
	C639.513733,828.255615 635.115967,819.437378 630.681458,810.637695 
	C627.798340,804.916565 624.691711,799.301758 621.985779,793.499084 
	C616.986145,782.777649 615.490906,771.444092 619.632019,760.344910 
	C620.826172,757.144043 625.845886,754.476624 629.641235,753.352661 
	C635.129150,751.727478 641.085510,751.562439 646.867676,751.084229 
	C653.548584,750.531555 660.257324,750.315308 667.669312,749.648315 
	C668.582764,747.378967 668.953369,745.414551 668.954163,743.449951 
	C668.983459,669.998108 668.978821,596.546265 668.978638,523.094421 
	C668.978638,521.348267 668.978577,519.602173 668.978577,517.766541 
	C666.932739,517.663513 665.612549,517.496399 664.300720,517.547180 
	C655.487183,517.888123 647.416992,516.688354 642.834045,507.733490 
	C642.492371,507.065765 641.606995,506.676208 640.974365,506.157349 
M682.275085,565.499878 
	C682.275085,631.274902 682.275085,697.049927 682.275085,763.034119 
	C667.996094,764.103210 654.235840,765.107544 640.480469,766.173950 
	C633.324707,766.728699 630.244080,771.541321 633.155212,777.861572 
	C640.329773,793.437866 647.677307,808.934387 654.865479,824.504456 
	C656.606812,828.276367 659.161499,829.879395 663.444763,829.869080 
	C709.940735,829.756775 756.437073,829.810486 802.933350,829.787720 
	C811.054443,829.783752 813.143250,827.591614 813.153198,819.264282 
	C813.172119,803.432251 813.174438,787.600159 813.152222,771.768127 
	C813.140381,763.348755 810.962891,761.092773 802.552368,761.014465 
	C793.267456,760.927979 783.981140,760.994690 774.508972,760.994690 
	C774.508972,674.828308 774.508972,589.769653 774.508972,505.197784 
	C784.608276,505.197784 794.391602,505.193665 804.174927,505.199310 
	C810.453125,505.202911 813.097717,502.797150 813.127319,496.562714 
	C813.205566,480.064423 813.197388,463.565338 813.133667,447.066925 
	C813.110168,440.964844 810.353638,438.097992 804.283447,438.101532 
	C749.954590,438.133453 695.625610,438.205170 641.296936,438.354462 
	C633.241577,438.376587 630.164612,443.253845 633.375366,450.636047 
	C640.411560,466.814056 647.661621,482.899689 654.601379,499.118469 
	C656.546204,503.663635 659.523315,505.405792 664.309082,505.045074 
	C670.073914,504.610565 675.862549,504.492218 682.275085,504.208984 
	C682.275085,524.610352 682.275085,544.555054 682.275085,565.499878 
z"/>
<path fill="#01FFFF" opacity="1.000000" stroke="none" 
	d="
M640.862793,506.471558 
	C641.606995,506.676208 642.492371,507.065765 642.834045,507.733490 
	C647.416992,516.688354 655.487183,517.888123 664.300720,517.547180 
	C665.612549,517.496399 666.932739,517.663513 668.978577,517.766541 
	C668.978577,519.602173 668.978638,521.348267 668.978638,523.094421 
	C668.978821,596.546265 668.983459,669.998108 668.954163,743.449951 
	C668.953369,745.414551 668.582764,747.378967 668.114868,749.660278 
	C667.896667,748.147644 667.992981,746.318176 667.993164,744.488770 
	C668.000793,671.338806 667.999634,598.188782 667.999634,525.038818 
	C667.999634,523.227173 667.999634,521.415588 667.999634,519.032532 
	C657.080750,518.864258 645.121399,520.819336 640.862793,506.471558 
z"/>
<path fill="#0BFFFF" opacity="1.000000" stroke="none" 
	d="
M284.776489,424.487427 
	C269.658295,424.939453 254.312439,425.069458 238.966370,425.102661 
	C221.436966,425.140594 203.907364,425.086029 186.377853,425.083435 
	C169.189957,425.080933 152.002060,425.082794 134.814178,425.102997 
	C124.722824,425.114868 114.631508,425.166321 104.256744,425.045044 
	C104.826492,424.593811 105.679672,424.038269 106.532845,424.038239 
	C165.871475,424.037994 225.210114,424.082184 284.776489,424.487427 
z"/>
<path fill="#07FFFF" opacity="1.000000" stroke="none" 
	d="
M291.627350,624.466431 
	C289.671112,625.022461 287.531830,625.356995 285.391602,625.362854 
	C259.685608,625.433594 233.979462,625.478088 208.273483,625.438538 
	C206.609512,625.435974 204.946701,624.688354 203.150818,624.053833 
	C229.330215,623.880310 255.642151,623.937805 281.954071,624.003235 
	C285.117401,624.011108 288.280579,624.061523 291.627350,624.466431 
z"/>
<path fill="#0BFFFF" opacity="1.000000" stroke="none" 
	d="
M995.844482,424.550964 
	C981.059509,424.992004 966.053711,425.067352 951.047729,425.118042 
	C940.168945,425.154785 929.289978,425.158905 918.203613,425.016357 
	C918.686584,424.571045 919.377319,424.038544 920.067749,424.038940 
	C945.252991,424.053497 970.438293,424.117493 995.844482,424.550964 
z"/>
<path fill="#0BFFFF" opacity="1.000000" stroke="none" 
	d="
M1138.775391,424.487305 
	C1130.110962,425.004578 1121.219727,425.255005 1112.327637,425.287689 
	C1096.272217,425.346710 1080.216064,425.279938 1064.160278,425.246155 
	C1063.334106,425.244415 1062.508179,425.059387 1061.308228,424.943604 
	C1061.780396,424.618805 1062.626343,424.040863 1063.472534,424.040588 
	C1088.497681,424.032623 1113.522949,424.082031 1138.775391,424.487305 
z"/>
<path fill="#0BFFFF" opacity="1.000000" stroke="none" 
	d="
M464.802734,424.516663 
	C439.263031,424.906281 413.500977,424.923828 387.335907,424.934387 
	C387.779663,424.618744 388.626404,424.040741 389.473175,424.040710 
	C414.508911,424.040131 439.544678,424.096924 464.802734,424.516663 
z"/>
<path fill="#0BFFFF" opacity="1.000000" stroke="none" 
	d="
M805.844604,424.551178 
	C797.538574,425.001678 789.011658,425.075867 780.240112,425.003235 
	C784.773682,424.571075 789.548645,424.178345 794.331116,424.034760 
	C798.090515,423.921936 801.859192,424.116730 805.844604,424.551178 
z"/>
<path fill="#02FFFF" opacity="1.000000" stroke="none" 
	d="
M571.497925,843.041870 
	C574.806274,842.055969 578.546631,841.036072 582.710571,840.038086 
	C579.943970,843.112488 575.986206,843.247437 571.497925,843.041870 
z"/>
<path fill="#00FBFF" opacity="1.000000" stroke="none" 
	d="
M1050.572998,425.918579 
	C1048.487183,427.865845 1046.029785,429.876495 1043.213867,431.916138 
	C1045.303955,429.957367 1047.752686,427.969666 1050.572998,425.918579 
z"/>
<path fill="#00FBFF" opacity="1.000000" stroke="none" 
	d="
M1037.645752,600.875244 
	C1035.770264,602.613831 1033.550659,604.455200 1031.089600,606.113770 
	C1032.999268,604.279968 1035.150391,602.629028 1037.645752,600.875244 
z"/>
<path fill="#02FFFF" opacity="1.000000" stroke="none" 
	d="
M650.279663,841.836548 
	C652.566956,841.954346 655.122986,842.279724 657.809021,842.842041 
	C655.475464,842.734070 653.011902,842.389038 650.279663,841.836548 
z"/>
<path fill="#02FFFF" opacity="1.000000" stroke="none" 
	d="
M644.045898,837.376892 
	C645.554443,838.369629 647.181824,839.673279 648.779297,841.373291 
	C647.221252,840.409058 645.692993,839.048462 644.045898,837.376892 
z"/>
<path fill="#01FFFF" opacity="1.000000" stroke="none" 
	d="
M295.402222,730.077271 
	C295.292023,726.728821 297.785095,727.506653 300.183838,727.704590 
	C298.907227,728.578125 297.328156,729.294250 295.402222,730.077271 
z"/>
<path fill="#01FFFF" opacity="1.000000" stroke="none" 
	d="
M909.926941,674.300354 
	C911.315186,674.941650 912.858459,675.876282 914.279419,677.165039 
	C912.798767,676.544006 911.440369,675.568848 909.926941,674.300354 
z"/>
<path fill="#01FFFF" opacity="1.000000" stroke="none" 
	d="
M301.098694,727.302856 
	C301.742035,725.791260 302.635773,724.069153 303.832794,722.165771 
	C303.207092,723.687195 302.278076,725.389771 301.098694,727.302856 
z"/>
<path fill="#02FFFF" opacity="1.000000" stroke="none" 
	d="
M908.076294,842.415039 
	C909.780823,842.165283 911.688232,842.261963 913.711670,842.586548 
	C911.978210,842.796692 910.128662,842.779053 908.076294,842.415039 
z"/>
<path fill="#00FBFF" opacity="1.000000" stroke="none" 
	d="
M1042.604370,432.048035 
	C1042.425415,433.749451 1041.915161,435.630646 1041.122070,437.744812 
	C1041.317261,436.061127 1041.795166,434.144501 1042.604370,432.048035 
z"/>
<path fill="#02FFFF" opacity="1.000000" stroke="none" 
	d="
M586.329163,837.037964 
	C586.506348,835.616455 587.005188,834.004517 587.827271,832.209839 
	C587.650635,833.633972 587.150757,835.240784 586.329163,837.037964 
z"/>
<path fill="#02FFFF" opacity="1.000000" stroke="none" 
	d="
M904.018921,840.380249 
	C905.175598,840.518127 906.485229,840.975830 907.876953,841.792480 
	C906.696594,841.667542 905.434204,841.183777 904.018921,840.380249 
z"/>
<path fill="#01FFFF" opacity="1.000000" stroke="none" 
	d="
M291.518127,730.898193 
	C292.293427,730.525391 293.424194,730.236389 294.840820,730.009399 
	C294.042297,730.374939 292.957977,730.678467 291.518127,730.898193 
z"/>
<path fill="#02FFFF" opacity="1.000000" stroke="none" 
	d="
M901.128845,838.251831 
	C902.037170,838.435608 902.942871,838.960632 903.901001,839.816711 
	C903.011047,839.629517 902.068665,839.111267 901.128845,838.251831 
z"/>
<path fill="#01FFFF" opacity="1.000000" stroke="none" 
	d="
M914.687866,678.082031 
	C915.269043,678.080688 916.044128,678.310181 916.905334,678.882874 
	C916.288208,678.921631 915.585022,678.617249 914.687866,678.082031 
z"/>
<path fill="#01FFFF" opacity="1.000000" stroke="none" 
	d="
M907.028076,672.356262 
	C907.631226,672.487732 908.334595,672.907715 909.064514,673.598206 
	C908.436768,673.460693 907.782593,673.052734 907.028076,672.356262 
z"/>
<path fill="#02FFFF" opacity="1.000000" stroke="none" 
	d="
M583.398315,840.078491 
	C583.548706,839.473083 584.050232,838.797668 584.889404,838.065247 
	C584.734558,838.674988 584.242004,839.341797 583.398315,840.078491 
z"/>
<path fill="#00FBFF" opacity="1.000000" stroke="none" 
	d="
M1040.098389,597.463379 
	C1039.922607,598.068054 1039.658569,598.985413 1039.084106,599.945679 
	C1039.185791,599.251099 1039.598022,598.513611 1040.098389,597.463379 
z"/>
<path fill="#00FBFF" opacity="1.000000" stroke="none" 
	d="
M1028.707520,606.069946 
	C1028.125610,606.299133 1027.176025,606.468994 1026.185059,606.413391 
	C1026.875732,606.128845 1027.607788,606.069702 1028.707520,606.069946 
z"/>
<path fill="#01FFFF" opacity="1.000000" stroke="none" 
	d="
M917.919006,680.289307 
	C918.447021,680.394653 919.121033,680.781311 919.926453,681.446899 
	C919.393616,681.340820 918.729309,680.955750 917.919006,680.289307 
z"/>
<path fill="#00FBFF" opacity="1.000000" stroke="none" 
	d="
M1052.428711,425.109924 
	C1052.267944,425.444458 1051.830200,425.689789 1051.129639,425.936218 
	C1051.295044,425.631775 1051.723511,425.326263 1052.428711,425.109924 
z"/>
<path fill="#02FFFF" opacity="1.000000" stroke="none" 
	d="
M899.923035,835.357178 
	C900.208557,835.549866 900.560913,836.068237 900.952515,836.906494 
	C900.657776,836.711792 900.323792,836.197327 899.923035,835.357178 
z"/>
<path fill="#000D10" opacity="1.000000" stroke="none" 
	d="
M1145.910156,451.132019 
	C1145.908325,516.442200 1145.816040,581.271240 1146.039062,646.099182 
	C1146.062500,652.885559 1143.896851,657.217346 1138.298950,660.965454 
	C1127.795044,667.998291 1117.737061,675.697266 1106.935303,683.523743 
	C1109.636597,685.584290 1111.924561,687.389038 1114.273438,689.110718 
	C1123.009155,695.513672 1131.695190,701.987854 1140.545532,708.229004 
	C1144.328247,710.896545 1145.935547,714.271118 1145.929321,718.798950 
	C1145.883423,752.463196 1145.930420,786.127441 1145.890747,819.791748 
	C1145.881714,827.444946 1143.594971,829.768372 1136.075073,829.783630 
	C1111.910278,829.832581 1087.744995,829.834045 1063.580200,829.778931 
	C1056.309204,829.762390 1053.985596,827.407410 1053.967896,820.157227 
	C1053.921143,800.992065 1053.886108,781.826172 1054.023193,762.661865 
	C1054.045776,759.500977 1053.203735,757.434753 1050.512817,755.621094 
	C1044.297974,751.432373 1038.179932,747.072327 1032.288208,742.443787 
	C1029.506592,740.258606 1027.605591,740.469421 1024.933228,742.540344 
	C1019.009277,747.131165 1012.918457,751.525085 1006.701355,755.710693 
	C1003.998047,757.530640 1003.197021,759.610718 1003.220642,762.762634 
	C1003.361572,781.593689 1003.307983,800.426147 1003.295593,819.258179 
	C1003.289978,827.792236 1001.280701,829.788025 992.620544,829.795654 
	C969.122192,829.816284 945.623901,829.818237 922.125549,829.794373 
	C913.562439,829.785706 911.362000,827.638062 911.355652,819.198059 
	C911.330688,786.033752 911.409058,752.869141 911.286804,719.705322 
	C911.267029,714.339478 913.236389,710.674561 917.626709,707.595276 
	C928.516357,699.957397 939.159729,691.968506 950.566467,683.635254 
	C945.264587,679.796997 940.477905,676.333130 935.692688,672.867188 
	C929.215454,668.175842 922.793213,663.405945 916.239990,658.823364 
	C912.961426,656.530823 911.314453,653.700684 911.317322,649.624817 
	C911.364624,582.296265 911.335754,514.967712 911.369995,447.639130 
	C911.373474,440.765747 914.194824,438.094116 921.277466,438.082123 
	C945.275696,438.041473 969.274109,438.046234 993.272400,438.075897 
	C1000.917969,438.085358 1003.291321,440.544281 1003.292786,448.386841 
	C1003.302368,500.216492 1003.336060,552.046265 1003.195923,603.875549 
	C1003.185730,607.638733 1004.198059,609.960449 1007.359619,612.050476 
	C1013.747437,616.273499 1019.751770,621.075562 1026.125244,625.322021 
	C1027.325073,626.121399 1029.969116,626.137085 1031.158813,625.339294 
	C1038.074951,620.702026 1044.905762,615.901794 1051.406128,610.706909 
	C1052.958496,609.466248 1053.846802,606.514954 1053.852295,604.347473 
	C1053.983521,553.018066 1053.951294,501.688324 1053.950806,450.358612 
	C1053.950806,439.860992 1055.711548,438.067841 1066.038452,438.065948 
	C1088.536865,438.061859 1111.035278,438.062805 1133.533691,438.065338 
	C1144.177490,438.066559 1145.885132,439.806915 1145.910156,451.132019 
M1030.224731,731.966187 
	C1040.494019,739.310120 1050.763428,746.654114 1061.044922,754.935547 
	C1061.044922,777.174500 1061.044922,799.413452 1061.044922,821.860901 
	C1067.089111,821.860901 1072.542480,821.860901 1078.922241,822.017517 
	C1098.514282,822.017517 1118.106323,822.017517 1137.503906,822.017517 
	C1137.828735,821.226562 1138.052612,820.935486 1138.052979,820.644226 
	C1138.098999,786.522339 1138.153076,752.400391 1138.068115,718.278809 
	C1138.064697,716.911621 1137.076904,715.089722 1135.965454,714.255066 
	C1127.456299,707.864868 1118.802734,701.667114 1109.755981,694.930786 
	C1104.672241,691.196655 1099.588501,687.462524 1094.065552,683.405762 
	C1100.117188,678.877625 1105.656982,674.732483 1111.847656,670.303650 
	C1119.652344,664.663086 1127.517822,659.103149 1135.205078,653.306763 
	C1136.571411,652.276428 1138.034790,650.266296 1138.040039,648.703735 
	C1138.138306,619.804138 1138.021606,590.903748 1138.135376,561.081421 
	C1138.135376,522.625244 1138.135376,484.169067 1138.135376,445.761841 
	C1125.893066,445.761841 1114.451782,445.761841 1102.101196,445.504913 
	C1091.071289,445.591675 1080.041504,445.678406 1068.119263,445.504913 
	C1065.877686,445.504913 1063.636108,445.504913 1061.248413,445.504913 
	C1061.248413,473.480347 1061.248413,500.741913 1061.098755,528.929749 
	C1061.088257,555.527405 1061.028809,582.125183 1061.135254,608.722412 
	C1061.147339,611.720947 1060.226807,613.514893 1057.754150,615.216370 
	C1050.926147,619.914856 1044.318359,624.932983 1036.963623,629.933594 
	C1034.141846,631.932556 1031.319946,633.931580 1028.477661,635.945129 
	C1020.922363,630.671875 1013.564209,625.536133 1005.765259,619.934998 
	C1004.691956,619.149109 1003.717468,618.138123 1002.528442,617.615723 
	C996.893250,615.139832 995.696228,610.914856 995.725281,604.941956 
	C995.972839,553.955688 995.858276,502.967590 995.852173,451.980042 
	C995.851929,450.018951 995.852112,448.057831 995.852112,445.756927 
	C969.969788,445.756927 944.593628,445.756927 918.941833,445.756927 
	C918.840698,447.291016 918.681091,448.584290 918.680847,449.877563 
	C918.668518,515.694824 918.690063,581.512085 918.605103,647.329285 
	C918.601196,650.367737 919.670044,652.109924 922.088745,653.822693 
	C934.182983,662.386719 946.141479,671.142578 958.141296,679.839783 
	C959.587952,680.888306 960.996582,681.989502 962.772644,683.330444 
	C949.043213,693.436035 935.854004,703.303833 922.456726,712.880554 
	C919.500977,714.993347 918.583496,717.219238 918.596924,720.714722 
	C918.720276,752.706421 918.669373,784.698792 918.669312,816.690979 
	C918.669312,818.310059 918.669312,819.929138 918.669312,821.863525 
	C931.764954,821.863525 944.381104,821.863525 957.923096,822.021729 
	C970.492737,822.021729 983.062317,822.021729 995.874878,822.021729 
	C995.874878,800.289246 995.948792,779.323059 995.796448,758.358521 
	C995.773132,755.153870 996.728088,753.193665 999.357727,751.389038 
	C1008.000549,745.458069 1016.438049,739.228455 1025.044556,733.243042 
	C1026.394409,732.304199 1028.212036,732.038208 1030.224731,731.966187 
z"/>
<path fill="#000A0D" opacity="1.000000" stroke="none" 
	d="
M98.396667,722.024475 
	C99.142944,714.856079 97.276268,708.832458 94.534828,702.774597 
	C86.987556,686.096863 80.145134,669.094604 72.367081,652.529175 
	C68.251984,643.765015 69.994469,636.797302 82.227150,637.857422 
	C87.324738,638.299194 92.492546,637.930786 98.404327,637.930786 
	C98.404327,635.600159 98.404396,633.679871 98.404312,631.759583 
	C98.401642,571.263550 98.397087,510.767487 98.398079,450.271423 
	C98.398247,439.784943 100.116417,438.078369 110.621185,438.078156 
	C167.450806,438.076935 224.280426,438.075989 281.110046,438.079254 
	C290.809296,438.079834 292.890106,440.144897 292.892700,449.758850 
	C292.897858,468.757599 292.901184,487.756378 292.891083,506.755127 
	C292.886047,516.221069 290.385864,518.516113 280.784973,517.839355 
	C252.530884,515.847595 224.278427,513.832458 196.023651,511.850647 
	C194.388092,511.735931 192.737488,511.835693 190.658981,511.835693 
	C190.658981,553.684265 190.658981,595.391907 190.658981,637.937256 
	C192.463074,637.937256 194.371857,637.937378 196.280640,637.937256 
	C224.945435,637.935425 253.610229,637.923889 282.275024,637.937744 
	C290.708038,637.941772 292.878571,640.124146 292.887451,648.606506 
	C292.907898,668.105225 292.906281,687.604004 292.887115,707.102722 
	C292.878845,715.485718 289.845398,718.203430 281.645233,717.604187 
	C252.563858,715.479309 223.477859,713.417297 194.392563,711.346436 
	C193.249252,711.265015 192.095078,711.336121 190.230713,711.336121 
	C190.230713,713.520752 190.230362,715.455627 190.230759,717.390503 
	C190.237808,751.054932 190.250824,784.719421 190.248322,818.383850 
	C190.247589,828.040344 188.509888,829.779968 178.919571,829.782776 
	C155.921066,829.789612 132.922577,829.790833 109.924072,829.780090 
	C100.044380,829.775452 98.402748,828.102478 98.399757,818.012024 
	C98.390312,786.181213 98.396347,754.350342 98.396667,722.024475 
M239.829132,507.316681 
	C254.845169,508.413635 269.861206,509.510620 285.127502,510.625854 
	C285.127502,488.595795 285.127502,467.244354 285.127502,445.754791 
	C276.861755,445.754791 268.927399,445.754791 260.098541,445.468597 
	C246.729263,445.563904 233.360001,445.659210 219.095764,445.471527 
	C207.740494,445.567047 196.385239,445.662537 184.126938,445.478546 
	C174.429703,445.570251 164.732468,445.661957 154.239685,445.473389 
	C138.295410,445.473389 122.351135,445.473389 105.859055,445.473389 
	C105.859055,512.131287 105.859055,578.321838 105.859055,645.035889 
	C96.276779,645.035889 87.235970,645.035889 77.624382,645.035889 
	C78.474136,647.187012 79.025330,648.706726 79.666824,650.187378 
	C87.599510,668.496094 95.662468,686.749939 103.385994,705.146362 
	C104.874977,708.692993 105.703346,712.788696 105.724442,716.637207 
	C105.906136,749.778442 105.832588,782.921021 105.835167,816.063232 
	C105.835320,817.975830 105.835190,819.888428 105.835190,821.867493 
	C120.735779,821.867493 134.870483,821.867493 149.931534,822.015503 
	C159.622177,821.965515 169.312805,821.915527 179.867065,822.015503 
	C183.970016,822.625732 182.912415,819.594666 182.914490,817.526184 
	C182.950943,781.229370 182.944885,744.932495 182.948044,708.635681 
	C182.948196,706.862732 182.948059,705.089783 182.948059,703.160645 
	C185.719116,703.160645 187.856720,703.160645 190.786896,703.503296 
	C207.525467,704.627869 224.264023,705.752502 241.864532,707.071533 
	C256.238831,708.127808 270.613129,709.184082 285.157288,710.252869 
	C285.157288,688.149475 285.157288,666.781250 285.157288,645.179688 
	C268.567596,645.179688 252.285477,645.179688 235.074722,645.041077 
	C218.719070,645.088745 202.363419,645.136414 185.134735,645.036438 
	C184.406250,643.398682 183.045868,641.762573 183.041473,640.122864 
	C182.923645,596.293457 182.942657,552.463684 182.953857,508.633972 
	C182.954269,507.034912 183.110214,505.435944 183.204926,503.621490 
	C189.080017,503.878479 194.538849,504.117249 200.766891,504.665497 
	C213.511459,505.443878 226.256027,506.222229 239.829132,507.316681 
z"/>
<path fill="#000709" opacity="1.000000" stroke="none" 
	d="
M491.458923,736.749878 
	C491.302124,718.445801 491.132111,700.618164 491.010864,682.790161 
	C490.964142,675.920105 493.187592,673.578369 500.078979,673.036743 
	C519.177063,671.535706 538.274719,670.028320 557.374573,668.549011 
	C563.604309,668.066467 566.681274,670.720825 567.087280,677.091064 
	C570.064636,723.806396 573.007202,770.523926 575.943298,817.241943 
	C576.068481,819.234436 576.142944,821.244446 576.031616,823.234497 
	C575.825439,826.921387 573.687622,829.007263 570.129700,829.558411 
	C568.496948,829.811462 566.809204,829.760437 565.146362,829.760681 
	C507.661835,829.769226 450.177307,829.769287 392.692780,829.765381 
	C382.390594,829.764648 380.876953,828.237061 380.876831,817.874207 
	C380.875458,695.240540 380.875580,572.606934 380.876740,449.973297 
	C380.876831,439.836090 382.627747,438.091736 392.808502,438.090210 
	C415.469055,438.086792 438.129639,438.085327 460.790192,438.091034 
	C470.373016,438.093445 472.356476,440.012421 472.356445,449.367310 
	C472.356049,549.673645 472.347412,649.979919 472.341064,750.286255 
	C472.340942,752.086060 472.341064,753.885864 472.341064,756.426147 
	C478.870209,756.043579 484.922760,755.688965 491.465179,755.305603 
	C491.465179,749.053711 491.465179,743.139893 491.458923,736.749878 
M483.500000,822.060791 
	C511.900970,822.060791 540.301941,822.060791 568.829651,822.060791 
	C565.740784,772.893433 562.696838,724.440430 559.625854,675.557068 
	C538.805908,677.166321 518.631287,678.725769 498.552765,680.277710 
	C498.552765,707.744446 498.552765,734.653137 498.552765,761.842712 
	C487.402710,762.593384 476.381073,763.335388 464.906006,764.107971 
	C464.906006,657.551880 464.906006,551.659668 464.906006,445.764343 
	C439.113556,445.764343 413.739197,445.764343 388.324707,445.764343 
	C388.324707,571.340149 388.324707,696.535583 388.324707,822.060791 
	C419.913849,822.060791 451.206909,822.060791 483.500000,822.060791 
z"/>
<path fill="#000C0F" opacity="1.000000" stroke="none" 
	d="
M682.275085,564.999878 
	C682.275085,544.555054 682.275085,524.610352 682.275085,504.208984 
	C675.862549,504.492218 670.073914,504.610565 664.309082,505.045074 
	C659.523315,505.405792 656.546204,503.663635 654.601379,499.118469 
	C647.661621,482.899689 640.411560,466.814056 633.375366,450.636047 
	C630.164612,443.253845 633.241577,438.376587 641.296936,438.354462 
	C695.625610,438.205170 749.954590,438.133453 804.283447,438.101532 
	C810.353638,438.097992 813.110168,440.964844 813.133667,447.066925 
	C813.197388,463.565338 813.205566,480.064423 813.127319,496.562714 
	C813.097717,502.797150 810.453125,505.202911 804.174927,505.199310 
	C794.391602,505.193665 784.608276,505.197784 774.508972,505.197784 
	C774.508972,589.769653 774.508972,674.828308 774.508972,760.994690 
	C783.981140,760.994690 793.267456,760.927979 802.552368,761.014465 
	C810.962891,761.092773 813.140381,763.348755 813.152222,771.768127 
	C813.174438,787.600159 813.172119,803.432251 813.153198,819.264282 
	C813.143250,827.591614 811.054443,829.783752 802.933350,829.787720 
	C756.437073,829.810486 709.940735,829.756775 663.444763,829.869080 
	C659.161499,829.879395 656.606812,828.276367 654.865479,824.504456 
	C647.677307,808.934387 640.329773,793.437866 633.155212,777.861572 
	C630.244080,771.541321 633.324707,766.728699 640.480469,766.173950 
	C654.235840,765.107544 667.996094,764.103210 682.275085,763.034119 
	C682.275085,697.049927 682.275085,631.274902 682.275085,564.999878 
M793.490295,767.937073 
	C784.715088,767.937073 775.939819,767.937073 767.116211,767.937073 
	C767.116211,676.786865 767.116211,586.862183 767.116211,497.173218 
	C780.084595,497.173218 792.792786,497.173218 805.406494,497.173218 
	C805.406494,480.088074 805.406494,463.012085 805.406494,445.982971 
	C750.046753,445.982971 695.047119,445.982971 639.866089,445.982971 
	C640.032410,447.042023 640.009094,447.561035 640.196106,447.987854 
	C647.004028,463.523102 653.902100,479.019440 660.590210,494.605927 
	C661.773682,497.364014 663.428345,497.590912 666.024597,497.522949 
	C673.769714,497.320160 681.523621,497.450134 689.644226,497.450134 
	C689.644226,498.858337 689.644226,500.499512 689.644226,502.140686 
	C689.644226,589.300781 689.644226,676.460815 689.644226,763.620911 
	C689.644226,764.454163 689.559937,765.297363 689.657532,766.118958 
	C689.995850,768.965942 688.652283,769.880432 685.932739,769.988220 
	C680.275330,770.212402 674.626465,770.682800 668.978455,771.109619 
	C659.288696,771.841736 649.602356,772.618103 639.430237,773.413757 
	C640.266479,775.454895 640.766174,776.838257 641.387207,778.164856 
	C647.592529,791.420532 653.959290,804.603577 659.937805,817.960449 
	C661.428223,821.290344 663.281006,822.126343 666.697266,822.118103 
	C711.360291,822.010986 756.023682,822.046997 800.686951,822.046997 
	C802.293091,822.046997 803.899231,822.046936 805.582642,822.046936 
	C805.582642,803.804932 805.582642,786.164490 805.582642,767.950928 
	C801.767456,767.950928 798.127808,767.950928 793.490295,767.937073 
z"/>
<path fill="#02CDFE" opacity="1.000000" stroke="none" 
	d="
M956.997192,821.863525 
	C944.381104,821.863525 931.764954,821.863525 918.669312,821.863525 
	C918.669312,819.929138 918.669312,818.310059 918.669312,816.690979 
	C918.669373,784.698792 918.720276,752.706421 918.596924,720.714722 
	C918.583496,717.219238 919.500977,714.993347 922.456726,712.880554 
	C935.854004,703.303833 949.043213,693.436035 962.772644,683.330444 
	C960.996582,681.989502 959.587952,680.888306 958.141296,679.839783 
	C946.141479,671.142578 934.182983,662.386719 922.088745,653.822693 
	C919.670044,652.109924 918.601196,650.367737 918.605103,647.329285 
	C918.690063,581.512085 918.668518,515.694824 918.680847,449.877563 
	C918.681091,448.584290 918.840698,447.291016 918.941833,445.756927 
	C944.593628,445.756927 969.969788,445.756927 995.852112,445.756927 
	C995.852112,448.057831 995.851929,450.018951 995.852173,451.980042 
	C995.858276,502.967590 995.972839,553.955688 995.725281,604.941956 
	C995.696228,610.914856 996.893250,615.139832 1002.528442,617.615723 
	C1003.717468,618.138123 1004.691956,619.149109 1005.888184,620.604980 
	C1006.006470,625.701294 1006.175964,630.136047 1005.963196,634.552368 
	C1005.404358,646.155151 1005.291443,657.825012 1003.880249,669.330688 
	C1001.621338,687.747864 999.271240,706.223633 995.490417,724.368469 
	C989.420410,753.499695 978.281128,780.943787 964.773193,807.416443 
	C962.288147,812.286682 959.594543,817.050537 956.997192,821.863525 
z"/>
<path fill="#01AFFF" opacity="1.000000" stroke="none" 
	d="
M1111.196777,670.587280 
	C1105.656982,674.732483 1100.117188,678.877625 1094.065552,683.405762 
	C1099.588501,687.462524 1104.672241,691.196655 1109.933960,695.666870 
	C1108.453125,707.722168 1107.239258,719.129395 1105.020264,730.337646 
	C1102.379028,743.678711 1099.443237,757.016907 1095.590088,770.047302 
	C1091.456299,784.027039 1086.088013,797.640564 1081.304810,811.430054 
	C1080.109863,814.875061 1079.093994,818.382263 1077.995850,821.860901 
	C1072.542480,821.860901 1067.089111,821.860901 1061.044922,821.860901 
	C1061.044922,799.413452 1061.044922,777.174500 1061.407959,754.434631 
	C1063.125122,751.505981 1065.183594,749.223022 1065.717041,746.626709 
	C1068.786255,731.687805 1071.894531,716.735901 1074.198730,701.667480 
	C1076.048706,689.570312 1076.819214,677.305603 1077.974976,665.106323 
	C1078.331665,661.341003 1078.475830,657.548340 1078.549438,653.764954 
	C1078.717529,645.126465 1079.372803,636.444031 1078.763550,627.855164 
	C1077.556641,610.840027 1076.259766,593.784424 1073.810913,576.918152 
	C1071.600464,561.692566 1067.871582,546.682556 1064.593262,531.625122 
	C1064.291870,530.240784 1062.401123,529.202454 1061.248413,528.003479 
	C1061.248413,500.741913 1061.248413,473.480347 1061.248413,445.504913 
	C1063.636108,445.504913 1065.877686,445.504913 1068.567017,446.043457 
	C1069.480591,448.328247 1069.745605,450.160339 1070.448364,451.805420 
	C1073.054321,457.905396 1076.068237,463.841980 1078.454102,470.023224 
	C1087.916382,494.537476 1095.730103,519.588501 1100.947998,545.345337 
	C1103.673584,558.799377 1105.503052,572.458984 1107.183105,586.093994 
	C1108.822510,599.400452 1110.264526,612.771118 1110.863892,626.155212 
	C1111.525757,640.941284 1111.131226,655.774536 1111.196777,670.587280 
z"/>
<path fill="#01A6FE" opacity="1.000000" stroke="none" 
	d="
M1111.522217,670.445435 
	C1111.131226,655.774536 1111.525757,640.941284 1110.863892,626.155212 
	C1110.264526,612.771118 1108.822510,599.400452 1107.183105,586.093994 
	C1105.503052,572.458984 1103.673584,558.799377 1100.947998,545.345337 
	C1095.730103,519.588501 1087.916382,494.537476 1078.454102,470.023224 
	C1076.068237,463.841980 1073.054321,457.905396 1070.448364,451.805420 
	C1069.745605,450.160339 1069.480591,448.328247 1069.013184,446.173584 
	C1080.041504,445.678406 1091.071289,445.591675 1102.557861,446.045532 
	C1103.400269,448.181244 1103.657104,449.821045 1104.191650,451.364532 
	C1110.257812,468.877197 1117.121826,486.157410 1122.247314,503.939423 
	C1127.188599,521.082947 1130.270874,538.758423 1134.386230,556.149048 
	C1134.886597,558.263306 1136.729492,560.059814 1137.950317,562.003540 
	C1138.021606,590.903748 1138.138306,619.804138 1138.040039,648.703735 
	C1138.034790,650.266296 1136.571411,652.276428 1135.205078,653.306763 
	C1127.517822,659.103149 1119.652344,664.663086 1111.522217,670.445435 
z"/>
<path fill="#01B9FF" opacity="1.000000" stroke="none" 
	d="
M1061.173584,528.466614 
	C1062.401123,529.202454 1064.291870,530.240784 1064.593262,531.625122 
	C1067.871582,546.682556 1071.600464,561.692566 1073.810913,576.918152 
	C1076.259766,593.784424 1077.556641,610.840027 1078.763550,627.855164 
	C1079.372803,636.444031 1078.717529,645.126465 1078.549438,653.764954 
	C1078.475830,657.548340 1078.331665,661.341003 1077.974976,665.106323 
	C1076.819214,677.305603 1076.048706,689.570312 1074.198730,701.667480 
	C1071.894531,716.735901 1068.786255,731.687805 1065.717041,746.626709 
	C1065.183594,749.223022 1063.125122,751.505981 1061.401855,753.965942 
	C1050.763428,746.654114 1040.494019,739.310120 1030.178955,731.337952 
	C1032.755249,716.871765 1035.941528,703.109985 1037.823608,689.172119 
	C1039.373413,677.694824 1039.385742,666.009216 1040.062256,654.414917 
	C1040.390747,648.784424 1041.067017,643.134155 1040.814941,637.527466 
	C1040.697388,634.917358 1038.744385,632.389709 1037.623535,629.824707 
	C1044.318359,624.932983 1050.926147,619.914856 1057.754150,615.216370 
	C1060.226807,613.514893 1061.147339,611.720947 1061.135254,608.722412 
	C1061.028809,582.125183 1061.088257,555.527405 1061.173584,528.466614 
z"/>
<path fill="#02C5FE" opacity="1.000000" stroke="none" 
	d="
M1037.293579,629.879150 
	C1038.744385,632.389709 1040.697388,634.917358 1040.814941,637.527466 
	C1041.067017,643.134155 1040.390747,648.784424 1040.062256,654.414917 
	C1039.385742,666.009216 1039.373413,677.694824 1037.823608,689.172119 
	C1035.941528,703.109985 1032.755249,716.871765 1029.973267,731.085449 
	C1028.212036,732.038208 1026.394409,732.304199 1025.044556,733.243042 
	C1016.438049,739.228455 1008.000549,745.458069 999.357727,751.389038 
	C996.728088,753.193665 995.773132,755.153870 995.796448,758.358521 
	C995.948792,779.323059 995.874878,800.289246 995.874878,822.021729 
	C983.062317,822.021729 970.492737,822.021729 957.460144,821.942627 
	C959.594543,817.050537 962.288147,812.286682 964.773193,807.416443 
	C978.281128,780.943787 989.420410,753.499695 995.490417,724.368469 
	C999.271240,706.223633 1001.621338,687.747864 1003.880249,669.330688 
	C1005.291443,657.825012 1005.404358,646.155151 1005.963196,634.552368 
	C1006.175964,630.136047 1006.006470,625.701294 1006.108582,620.837646 
	C1013.564209,625.536133 1020.922363,630.671875 1028.477661,635.945129 
	C1031.319946,633.931580 1034.141846,631.932556 1037.293579,629.879150 
z"/>
<path fill="#01A4FF" opacity="1.000000" stroke="none" 
	d="
M1078.458984,821.939209 
	C1079.093994,818.382263 1080.109863,814.875061 1081.304810,811.430054 
	C1086.088013,797.640564 1091.456299,784.027039 1095.590088,770.047302 
	C1099.443237,757.016907 1102.379028,743.678711 1105.020264,730.337646 
	C1107.239258,719.129395 1108.453125,707.722168 1110.152954,695.906250 
	C1118.802734,701.667114 1127.456299,707.864868 1135.965454,714.255066 
	C1137.076904,715.089722 1138.064697,716.911621 1138.068115,718.278809 
	C1138.153076,752.400391 1138.098999,786.522339 1138.052979,820.644226 
	C1138.052612,820.935486 1137.828735,821.226562 1137.503906,822.017517 
	C1118.106323,822.017517 1098.514282,822.017517 1078.458984,821.939209 
z"/>
<path fill="#019DFD" opacity="1.000000" stroke="none" 
	d="
M1138.042847,561.542480 
	C1136.729492,560.059814 1134.886597,558.263306 1134.386230,556.149048 
	C1130.270874,538.758423 1127.188599,521.082947 1122.247314,503.939423 
	C1117.121826,486.157410 1110.257812,468.877197 1104.191650,451.364532 
	C1103.657104,449.821045 1103.400269,448.181244 1103.012451,446.174011 
	C1114.451782,445.761841 1125.893066,445.761841 1138.135376,445.761841 
	C1138.135376,484.169067 1138.135376,522.625244 1138.042847,561.542480 
z"/>
<path fill="#01A3FE" opacity="1.000000" stroke="none" 
	d="
M189.994339,703.160645 
	C187.856720,703.160645 185.719116,703.160645 182.948059,703.160645 
	C182.948059,705.089783 182.948196,706.862732 182.948044,708.635681 
	C182.944885,744.932495 182.950943,781.229370 182.914490,817.526184 
	C182.912415,819.594666 183.970016,822.625732 179.428284,821.549500 
	C176.390778,812.872620 173.714615,804.685303 171.211319,796.445496 
	C167.350891,783.738586 162.988525,771.140259 159.980667,758.229919 
	C156.565170,743.569824 154.483032,728.602478 151.682755,713.794922 
	C147.749115,692.994141 146.759964,671.917664 146.131653,650.854065 
	C145.750488,638.075439 146.362564,625.240967 147.086990,612.463196 
	C147.781128,600.219666 148.641647,587.934998 150.432526,575.816711 
	C152.807922,559.742920 155.712112,543.714478 159.227097,527.852234 
	C162.125824,514.771057 165.859207,501.837830 169.922241,489.061462 
	C174.553497,474.498322 179.960251,460.181763 185.029968,445.758057 
	C196.385239,445.662537 207.740494,445.567047 219.538010,445.951019 
	C215.634415,457.328674 210.946686,468.106567 207.055542,479.164734 
	C204.167130,487.373291 202.312698,495.945679 199.997696,504.356018 
	C194.538849,504.117249 189.080017,503.878479 183.204926,503.621490 
	C183.110214,505.435944 182.954269,507.034912 182.953857,508.633972 
	C182.942657,552.463684 182.923645,596.293457 183.041473,640.122864 
	C183.045868,641.762573 184.406250,643.398682 185.569366,645.567139 
	C186.213028,653.235474 186.153427,660.393494 186.691452,667.506287 
	C187.591614,679.406250 188.873260,691.277405 189.994339,703.160645 
z"/>
<path fill="#019CFF" opacity="1.000000" stroke="none" 
	d="
M184.578461,445.618286 
	C179.960251,460.181763 174.553497,474.498322 169.922241,489.061462 
	C165.859207,501.837830 162.125824,514.771057 159.227097,527.852234 
	C155.712112,543.714478 152.807922,559.742920 150.432526,575.816711 
	C148.641647,587.934998 147.781128,600.219666 147.086990,612.463196 
	C146.362564,625.240967 145.750488,638.075439 146.131653,650.854065 
	C146.759964,671.917664 147.749115,692.994141 151.682755,713.794922 
	C154.483032,728.602478 156.565170,743.569824 159.980667,758.229919 
	C162.988525,771.140259 167.350891,783.738586 171.211319,796.445496 
	C173.714615,804.685303 176.390778,812.872620 178.996475,821.474487 
	C169.312805,821.915527 159.622177,821.965515 149.465652,821.537109 
	C148.685181,819.266785 148.545166,817.422791 148.028442,815.691223 
	C143.806046,801.541931 139.000137,787.543762 135.375366,773.245178 
	C131.099136,756.376892 126.908745,739.390564 124.355766,722.206604 
	C121.312965,701.725708 119.271523,681.018982 118.252762,660.338318 
	C117.411774,643.266479 118.625229,626.088440 119.065018,608.960999 
	C119.231155,602.490601 119.273689,595.952393 120.249870,589.579529 
	C123.284882,569.765625 126.068840,549.873291 130.232849,530.284119 
	C133.954468,512.776001 139.136963,495.559601 144.139236,478.349457 
	C147.334244,467.357178 151.374130,456.610504 155.035233,445.753662 
	C164.732468,445.661957 174.429703,445.570251 184.578461,445.618286 
z"/>
<path fill="#0093FD" opacity="1.000000" stroke="none" 
	d="
M154.637451,445.613525 
	C151.374130,456.610504 147.334244,467.357178 144.139236,478.349457 
	C139.136963,495.559601 133.954468,512.776001 130.232849,530.284119 
	C126.068840,549.873291 123.284882,569.765625 120.249870,589.579529 
	C119.273689,595.952393 119.231155,602.490601 119.065018,608.960999 
	C118.625229,626.088440 117.411774,643.266479 118.252762,660.338318 
	C119.271523,681.018982 121.312965,701.725708 124.355766,722.206604 
	C126.908745,739.390564 131.099136,756.376892 135.375366,773.245178 
	C139.000137,787.543762 143.806046,801.541931 148.028442,815.691223 
	C148.545166,817.422791 148.685181,819.266785 149.002472,821.463135 
	C134.870483,821.867493 120.735779,821.867493 105.835190,821.867493 
	C105.835190,819.888428 105.835320,817.975830 105.835167,816.063232 
	C105.832588,782.921021 105.906136,749.778442 105.724442,716.637207 
	C105.703346,712.788696 104.874977,708.692993 103.385994,705.146362 
	C95.662468,686.749939 87.599510,668.496094 79.666824,650.187378 
	C79.025330,648.706726 78.474136,647.187012 77.624382,645.035889 
	C87.235970,645.035889 96.276779,645.035889 105.859055,645.035889 
	C105.859055,578.321838 105.859055,512.131287 105.859055,445.473389 
	C122.351135,445.473389 138.295410,445.473389 154.637451,445.613525 
z"/>
<path fill="#01B3FF" opacity="1.000000" stroke="none" 
	d="
M190.390625,703.331970 
	C188.873260,691.277405 187.591614,679.406250 186.691452,667.506287 
	C186.153427,660.393494 186.213028,653.235474 186.005875,645.640930 
	C202.363419,645.136414 218.719070,645.088745 235.538040,645.567078 
	C235.942200,666.496460 237.826614,686.739868 241.002594,706.877075 
	C224.264023,705.752502 207.525467,704.627869 190.390625,703.331970 
z"/>
<path fill="#02BEFB" opacity="1.000000" stroke="none" 
	d="
M241.433563,706.974304 
	C237.826614,686.739868 235.942200,666.496460 236.002350,645.636353 
	C252.285477,645.179688 268.567596,645.179688 285.157288,645.179688 
	C285.157288,666.781250 285.157288,688.149475 285.157288,710.252869 
	C270.613129,709.184082 256.238831,708.127808 241.433563,706.974304 
z"/>
<path fill="#01AEFE" opacity="1.000000" stroke="none" 
	d="
M200.382294,504.510742 
	C202.312698,495.945679 204.167130,487.373291 207.055542,479.164734 
	C210.946686,468.106567 215.634415,457.328674 219.985489,446.092529 
	C233.360001,445.659210 246.729263,445.563904 260.539093,445.959656 
	C259.335144,450.552277 257.757660,454.682343 256.032043,458.749512 
	C252.555817,466.942627 248.576889,474.951294 245.599243,483.318573 
	C242.858566,491.020020 241.158859,499.091919 239.000595,507.000610 
	C226.256027,506.222229 213.511459,505.443878 200.382294,504.510742 
z"/>
<path fill="#01B9FF" opacity="1.000000" stroke="none" 
	d="
M239.414856,507.158630 
	C241.158859,499.091919 242.858566,491.020020 245.599243,483.318573 
	C248.576889,474.951294 252.555817,466.942627 256.032043,458.749512 
	C257.757660,454.682343 259.335144,450.552277 260.986328,446.102722 
	C268.927399,445.754791 276.861755,445.754791 285.127502,445.754791 
	C285.127502,467.244354 285.127502,488.595795 285.127502,510.625854 
	C269.861206,509.510620 254.845169,508.413635 239.414856,507.158630 
z"/>
<path fill="#02CEFE" opacity="1.000000" stroke="none" 
	d="
M483.000000,822.060791 
	C451.206909,822.060791 419.913849,822.060791 388.324707,822.060791 
	C388.324707,696.535583 388.324707,571.340149 388.324707,445.764343 
	C413.739197,445.764343 439.113556,445.764343 464.906006,445.764343 
	C464.906006,551.659668 464.906006,657.551880 464.906006,764.107971 
	C476.381073,763.335388 487.402710,762.593384 498.552765,761.842712 
	C498.552765,734.653137 498.552765,707.744446 498.552765,680.277710 
	C518.631287,678.725769 538.805908,677.166321 559.625854,675.557068 
	C562.696838,724.440430 565.740784,772.893433 568.829651,822.060791 
	C540.301941,822.060791 511.900970,822.060791 483.000000,822.060791 
z"/>
<path fill="#02CEFE" opacity="1.000000" stroke="none" 
	d="
M793.989258,767.943970 
	C798.127808,767.950928 801.767456,767.950928 805.582642,767.950928 
	C805.582642,786.164490 805.582642,803.804932 805.582642,822.046936 
	C803.899231,822.046936 802.293091,822.046997 800.686951,822.046997 
	C756.023682,822.046997 711.360291,822.010986 666.697266,822.118103 
	C663.281006,822.126343 661.428223,821.290344 659.937805,817.960449 
	C653.959290,804.603577 647.592529,791.420532 641.387207,778.164856 
	C640.766174,776.838257 640.266479,775.454895 639.430237,773.413757 
	C649.602356,772.618103 659.288696,771.841736 668.978455,771.109619 
	C674.626465,770.682800 680.275330,770.212402 685.932739,769.988220 
	C688.652283,769.880432 689.995850,768.965942 689.657532,766.118958 
	C689.559937,765.297363 689.644226,764.454163 689.644226,763.620911 
	C689.644226,676.460815 689.644226,589.300781 689.644226,502.140686 
	C689.644226,500.499512 689.644226,498.858337 689.644226,497.450134 
	C681.523621,497.450134 673.769714,497.320160 666.024597,497.522949 
	C663.428345,497.590912 661.773682,497.364014 660.590210,494.605927 
	C653.902100,479.019440 647.004028,463.523102 640.196106,447.987854 
	C640.009094,447.561035 640.032410,447.042023 639.866089,445.982971 
	C695.047119,445.982971 750.046753,445.982971 805.406494,445.982971 
	C805.406494,463.012085 805.406494,480.088074 805.406494,497.173218 
	C792.792786,497.173218 780.084595,497.173218 767.116211,497.173218 
	C767.116211,586.862183 767.116211,676.786865 767.116211,767.937073 
	C775.939819,767.937073 784.715088,767.937073 793.989258,767.943970 
z"/>
</svg>
                                        </div>
                                        <div class="text-center">
                                            <h1 class="card-title"><?php echo APP_TITLE; ?></h1>
                                        </div>
                                    </div>
                                    <hr />
                                    <div class="mb-3">
                                        <label for="fm_usr" class="pb-2"><?php echo lng('Username'); ?></label>
                                        <input type="text" class="form-control" id="fm_usr" name="fm_usr" required autofocus>
                                    </div>

                                    <div class="mb-3">
                                        <label for="fm_pwd" class="pb-2"><?php echo lng('Password'); ?></label>
                                        <input type="password" class="form-control" id="fm_pwd" name="fm_pwd" required>
                                    </div>

                                    <div class="mb-3">
                                        <?php fm_show_message(); ?>
                                    </div>
                                    <input type="hidden" name="token" value="<?php echo htmlentities($_SESSION['token']); ?>" />
                                    <div class="mb-3">
                                        <button type="submit" class="btn btn-success btn-block w-100 mt-4" role="button">
                                            <?php echo lng('Login'); ?>
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="footer text-center">
                            &mdash;&mdash; &copy;
                            <a href="" target="_blank" class="text-decoration-none text-muted" data-version="<?php echo VERSION; ?>">FLIX OP</a> &mdash;&mdash;
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <?php
        fm_show_footer_login();
        exit;
    }
}

// update root path
if ($use_auth && isset($_SESSION[FM_SESSION_ID]['logged'])) {
    $root_path = isset($directories_users[$_SESSION[FM_SESSION_ID]['logged']]) ? $directories_users[$_SESSION[FM_SESSION_ID]['logged']] : $root_path;
}

// clean and check $root_path
$root_path = rtrim($root_path, '\\/');
$root_path = str_replace('\\', '/', $root_path);
if (!@is_dir($root_path)) {
    echo "<h1>".lng('Root path')." \"{$root_path}\" ".lng('not found!')." </h1>";
    exit;
}

defined('FM_SHOW_HIDDEN') || define('FM_SHOW_HIDDEN', $show_hidden_files);
defined('FM_ROOT_PATH') || define('FM_ROOT_PATH', $root_path);
defined('FM_LANG') || define('FM_LANG', $lang);
defined('FM_FILE_EXTENSION') || define('FM_FILE_EXTENSION', $allowed_file_extensions);
defined('FM_UPLOAD_EXTENSION') || define('FM_UPLOAD_EXTENSION', $allowed_upload_extensions);
defined('FM_EXCLUDE_ITEMS') || define('FM_EXCLUDE_ITEMS', (version_compare(PHP_VERSION, '7.0.0', '<') ? serialize($exclude_items) : $exclude_items));
defined('FM_DOC_VIEWER') || define('FM_DOC_VIEWER', $online_viewer);
define('FM_READONLY', $global_readonly || ($use_auth && !empty($readonly_users) && isset($_SESSION[FM_SESSION_ID]['logged']) && in_array($_SESSION[FM_SESSION_ID]['logged'], $readonly_users)));
define('FM_IS_WIN', DIRECTORY_SEPARATOR == '\\');

// always use ?p=
if (!isset($_GET['p']) && empty($_FILES)) {
    fm_redirect(FM_SELF_URL . '?p=');
}

// get path
$p = isset($_GET['p']) ? $_GET['p'] : (isset($_POST['p']) ? $_POST['p'] : '');

// clean path
$p = fm_clean_path($p);

// for ajax request - save
$input = file_get_contents('php://input');
$_POST = (strpos($input, 'ajax') != FALSE && strpos($input, 'save') != FALSE) ? json_decode($input, true) : $_POST;

// instead globals vars
define('FM_PATH', $p);
define('FM_USE_AUTH', $use_auth);
define('FM_EDIT_FILE', $edit_files);
defined('FM_ICONV_INPUT_ENC') || define('FM_ICONV_INPUT_ENC', $iconv_input_encoding);
defined('FM_USE_HIGHLIGHTJS') || define('FM_USE_HIGHLIGHTJS', $use_highlightjs);
defined('FM_HIGHLIGHTJS_STYLE') || define('FM_HIGHLIGHTJS_STYLE', $highlightjs_style);
defined('FM_DATETIME_FORMAT') || define('FM_DATETIME_FORMAT', $datetime_format);

unset($p, $use_auth, $iconv_input_encoding, $use_highlightjs, $highlightjs_style);

/*************************** ACTIONS ***************************/

// Handle all AJAX Request
if ((isset($_SESSION[FM_SESSION_ID]['logged'], $auth_users[$_SESSION[FM_SESSION_ID]['logged']]) || !FM_USE_AUTH) && isset($_POST['ajax'], $_POST['token']) && !FM_READONLY) {
    if(!verifyToken($_POST['token'])) {
        header('HTTP/1.0 401 Unauthorized');
        die("Invalid Token.");
    }

    //search : get list of files from the current folder
    if(isset($_POST['type']) && $_POST['type']=="search") {
        $dir = $_POST['path'] == "." ? '': $_POST['path'];
        $response = scan(fm_clean_path($dir), $_POST['content']);
        echo json_encode($response);
        exit();
    }

    // save editor file
    if (isset($_POST['type']) && $_POST['type'] == "save") {
        // get current path
        $path = FM_ROOT_PATH;
        if (FM_PATH != '') {
            $path .= '/' . FM_PATH;
        }
        // check path
        if (!is_dir($path)) {
            fm_redirect(FM_SELF_URL . '?p=');
        }
        $file = $_GET['edit'];
        $file = fm_clean_path($file);
        $file = str_replace('/', '', $file);
        if ($file == '' || !is_file($path . '/' . $file)) {
            fm_set_msg(lng('File not found'), 'error');
            $FM_PATH=FM_PATH; fm_redirect(FM_SELF_URL . '?p=' . urlencode($FM_PATH));
        }
        header('X-XSS-Protection:0');
        $file_path = $path . '/' . $file;

        $writedata = $_POST['content'];
        $fd = fopen($file_path, "w");
        $write_results = @fwrite($fd, $writedata);
        fclose($fd);
        if ($write_results === false){
            header("HTTP/1.1 500 Internal Server Error");
            die("Could Not Write File! - Check Permissions / Ownership");
        }
        die(true);
    }

    // backup files
    if (isset($_POST['type']) && $_POST['type'] == "backup" && !empty($_POST['file'])) {
        $fileName = fm_clean_path($_POST['file']);
        $fullPath = FM_ROOT_PATH . '/';
        if (!empty($_POST['path'])) {
            $relativeDirPath = fm_clean_path($_POST['path']);
            $fullPath .= "{$relativeDirPath}/";
        }
        $date = date("dMy-His");
        $newFileName = "{$fileName}-{$date}.bak";
        $fullyQualifiedFileName = $fullPath . $fileName;
        try {
            if (!file_exists($fullyQualifiedFileName)) {
                throw new Exception("File {$fileName} not found");
            }
            if (copy($fullyQualifiedFileName, $fullPath . $newFileName)) {
                echo "Backup {$newFileName} created";
            } else {
                throw new Exception("Could not copy file {$fileName}");
            }
        } catch (Exception $e) {
            echo $e->getMessage();
        }
    }

    // Save Config
    if (isset($_POST['type']) && $_POST['type'] == "settings") {
        global $cfg, $lang, $report_errors, $show_hidden_files, $lang_list, $hide_Cols, $theme;
        $newLng = $_POST['js-language'];
        fm_get_translations([]);
        if (!array_key_exists($newLng, $lang_list)) {
            $newLng = 'en';
        }

        $erp = isset($_POST['js-error-report']) && $_POST['js-error-report'] == "true" ? true : false;
        $shf = isset($_POST['js-show-hidden']) && $_POST['js-show-hidden'] == "true" ? true : false;
        $hco = isset($_POST['js-hide-cols']) && $_POST['js-hide-cols'] == "true" ? true : false;
        $te3 = $_POST['js-theme-3'];

        if ($cfg->data['lang'] != $newLng) {
            $cfg->data['lang'] = $newLng;
            $lang = $newLng;
        }
        if ($cfg->data['error_reporting'] != $erp) {
            $cfg->data['error_reporting'] = $erp;
            $report_errors = $erp;
        }
        if ($cfg->data['show_hidden'] != $shf) {
            $cfg->data['show_hidden'] = $shf;
            $show_hidden_files = $shf;
        }
        if ($cfg->data['show_hidden'] != $shf) {
            $cfg->data['show_hidden'] = $shf;
            $show_hidden_files = $shf;
        }
        if ($cfg->data['hide_Cols'] != $hco) {
            $cfg->data['hide_Cols'] = $hco;
            $hide_Cols = $hco;
        }
        if ($cfg->data['theme'] != $te3) {
            $cfg->data['theme'] = $te3;
            $theme = $te3;
        }
        $cfg->save();
        echo true;
    }

    // new password hash
    if (isset($_POST['type']) && $_POST['type'] == "pwdhash") {
        $res = isset($_POST['inputPassword2']) && !empty($_POST['inputPassword2']) ? password_hash($_POST['inputPassword2'], PASSWORD_DEFAULT) : '';
        echo $res;
    }

    //upload using url
    if(isset($_POST['type']) && $_POST['type'] == "upload" && !empty($_REQUEST["uploadurl"])) {
        $path = FM_ROOT_PATH;
        if (FM_PATH != '') {
            $path .= '/' . FM_PATH;
        }

         function event_callback ($message) {
            global $callback;
            echo json_encode($message);
        }

        function get_file_path () {
            global $path, $fileinfo, $temp_file;
            return $path."/".basename($fileinfo->name);
        }

        $url = !empty($_REQUEST["uploadurl"]) && preg_match("|^http(s)?://.+$|", stripslashes($_REQUEST["uploadurl"])) ? stripslashes($_REQUEST["uploadurl"]) : null;

        //prevent 127.* domain and known ports
        $domain = parse_url($url, PHP_URL_HOST);
        $port = parse_url($url, PHP_URL_PORT);
        $knownPorts = [22, 23, 25, 3306];

        if (preg_match("/^localhost$|^127(?:\.[0-9]+){0,2}\.[0-9]+$|^(?:0*\:)*?:?0*1$/i", $domain) || in_array($port, $knownPorts)) {
            $err = array("message" => "URL is not allowed");
            event_callback(array("fail" => $err));
            exit();
        }

        $use_curl = false;
        $temp_file = tempnam(sys_get_temp_dir(), "upload-");
        $fileinfo = new stdClass();
        $fileinfo->name = trim(basename($url), ".\x00..\x20");

        $allowed = (FM_UPLOAD_EXTENSION) ? explode(',', FM_UPLOAD_EXTENSION) : false;
        $ext = strtolower(pathinfo($fileinfo->name, PATHINFO_EXTENSION));
        $isFileAllowed = ($allowed) ? in_array($ext, $allowed) : true;

        $err = false;

        if(!$isFileAllowed) {
            $err = array("message" => "File extension is not allowed");
            event_callback(array("fail" => $err));
            exit();
        }

        if (!$url) {
            $success = false;
        } else if ($use_curl) {
            @$fp = fopen($temp_file, "w");
            @$ch = curl_init($url);
            curl_setopt($ch, CURLOPT_NOPROGRESS, false );
            curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);
            curl_setopt($ch, CURLOPT_FILE, $fp);
            @$success = curl_exec($ch);
            $curl_info = curl_getinfo($ch);
            if (!$success) {
                $err = array("message" => curl_error($ch));
            }
            @curl_close($ch);
            fclose($fp);
            $fileinfo->size = $curl_info["size_download"];
            $fileinfo->type = $curl_info["content_type"];
        } else {
            $ctx = stream_context_create();
            @$success = copy($url, $temp_file, $ctx);
            if (!$success) {
                $err = error_get_last();
            }
        }

        if ($success) {
            $success = rename($temp_file, strtok(get_file_path(), '?'));
        }

        if ($success) {
            event_callback(array("done" => $fileinfo));
        } else {
            unlink($temp_file);
            if (!$err) {
                $err = array("message" => "Invalid url parameter");
            }
            event_callback(array("fail" => $err));
        }
    }
    exit();
}

// Delete file / folder
if (isset($_GET['del'], $_POST['token']) && !FM_READONLY) {
    $del = str_replace( '/', '', fm_clean_path( $_GET['del'] ) );
    if ($del != '' && $del != '..' && $del != '.' && verifyToken($_POST['token'])) {
        $path = FM_ROOT_PATH;
        if (FM_PATH != '') {
            $path .= '/' . FM_PATH;
        }
        $is_dir = is_dir($path . '/' . $del);
        if (fm_rdelete($path . '/' . $del)) {
            $msg = $is_dir ? lng('Folder').' <b>%s</b> '.lng('Deleted') : lng('File').' <b>%s</b> '.lng('Deleted');
            fm_set_msg(sprintf($msg, fm_enc($del)));
        } else {
            $msg = $is_dir ? lng('Folder').' <b>%s</b> '.lng('not deleted') : lng('File').' <b>%s</b> '.lng('not deleted');
            fm_set_msg(sprintf($msg, fm_enc($del)), 'error');
        }
    } else {
        fm_set_msg(lng('Invalid file or folder name'), 'error');
    }
    $FM_PATH=FM_PATH; fm_redirect(FM_SELF_URL . '?p=' . urlencode($FM_PATH));
}

// Create a new file/folder
if (isset($_POST['newfilename'], $_POST['newfile'], $_POST['token']) && !FM_READONLY) {
    $type = urldecode($_POST['newfile']);
    $new = str_replace( '/', '', fm_clean_path( strip_tags( $_POST['newfilename'] ) ) );
    if (fm_isvalid_filename($new) && $new != '' && $new != '..' && $new != '.' && verifyToken($_POST['token'])) {
        $path = FM_ROOT_PATH;
        if (FM_PATH != '') {
            $path .= '/' . FM_PATH;
        }
        if ($type == "file") {
            if (!file_exists($path . '/' . $new)) {
                if(fm_is_valid_ext($new)) {
                    @fopen($path . '/' . $new, 'w') or die('Cannot open file:  ' . $new);
                    fm_set_msg(sprintf(lng('File').' <b>%s</b> '.lng('Created'), fm_enc($new)));
                } else {
                    fm_set_msg(lng('File extension is not allowed'), 'error');
                }
            } else {
                fm_set_msg(sprintf(lng('File').' <b>%s</b> '.lng('already exists'), fm_enc($new)), 'alert');
            }
        } else {
            if (fm_mkdir($path . '/' . $new, false) === true) {
                fm_set_msg(sprintf(lng('Folder').' <b>%s</b> '.lng('Created'), $new));
            } elseif (fm_mkdir($path . '/' . $new, false) === $path . '/' . $new) {
                fm_set_msg(sprintf(lng('Folder').' <b>%s</b> '.lng('already exists'), fm_enc($new)), 'alert');
            } else {
                fm_set_msg(sprintf(lng('Folder').' <b>%s</b> '.lng('not created'), fm_enc($new)), 'error');
            }
        }
    } else {
        fm_set_msg(lng('Invalid characters in file or folder name'), 'error');
    }
    $FM_PATH=FM_PATH; fm_redirect(FM_SELF_URL . '?p=' . urlencode($FM_PATH));
}

// Copy folder / file
if (isset($_GET['copy'], $_GET['finish']) && !FM_READONLY) {
    // from
    $copy = urldecode($_GET['copy']);
    $copy = fm_clean_path($copy);
    // empty path
    if ($copy == '') {
        fm_set_msg(lng('Source path not defined'), 'error');
        $FM_PATH=FM_PATH; fm_redirect(FM_SELF_URL . '?p=' . urlencode($FM_PATH));
    }
    // abs path from
    $from = FM_ROOT_PATH . '/' . $copy;
    // abs path to
    $dest = FM_ROOT_PATH;
    if (FM_PATH != '') {
        $dest .= '/' . FM_PATH;
    }
    $dest .= '/' . basename($from);
    // move?
    $move = isset($_GET['move']);
    $move = fm_clean_path(urldecode($move));
    // copy/move/duplicate
    if ($from != $dest) {
        $msg_from = trim(FM_PATH . '/' . basename($from), '/');
        if ($move) { // Move and to != from so just perform move
            $rename = fm_rename($from, $dest);
            if ($rename) {
                fm_set_msg(sprintf(lng('Moved from').' <b>%s</b> '.lng('to').' <b>%s</b>', fm_enc($copy), fm_enc($msg_from)));
            } elseif ($rename === null) {
                fm_set_msg(lng('File or folder with this path already exists'), 'alert');
            } else {
                fm_set_msg(sprintf(lng('Error while moving from').' <b>%s</b> '.lng('to').' <b>%s</b>', fm_enc($copy), fm_enc($msg_from)), 'error');
            }
        } else { // Not move and to != from so copy with original name
            if (fm_rcopy($from, $dest)) {
                fm_set_msg(sprintf(lng('Copied from').' <b>%s</b> '.lng('to').' <b>%s</b>', fm_enc($copy), fm_enc($msg_from)));
            } else {
                fm_set_msg(sprintf(lng('Error while copying from').' <b>%s</b> '.lng('to').' <b>%s</b>', fm_enc($copy), fm_enc($msg_from)), 'error');
            }
        }
    } else {
       if (!$move){ //Not move and to = from so duplicate
            $msg_from = trim(FM_PATH . '/' . basename($from), '/');
            $fn_parts = pathinfo($from);
            $extension_suffix = '';
            if(!is_dir($from)){
               $extension_suffix = '.'.$fn_parts['extension'];
            }
            //Create new name for duplicate
            $fn_duplicate = $fn_parts['dirname'].'/'.$fn_parts['filename'].'-'.date('YmdHis').$extension_suffix;
            $loop_count = 0;
            $max_loop = 1000;
            // Check if a file with the duplicate name already exists, if so, make new name (edge case...)
            while(file_exists($fn_duplicate) & $loop_count < $max_loop){
               $fn_parts = pathinfo($fn_duplicate);
               $fn_duplicate = $fn_parts['dirname'].'/'.$fn_parts['filename'].'-copy'.$extension_suffix;
               $loop_count++;
            }
            if (fm_rcopy($from, $fn_duplicate, False)) {
                fm_set_msg(sprintf('Copyied from <b>%s</b> to <b>%s</b>', fm_enc($copy), fm_enc($fn_duplicate)));
            } else {
                fm_set_msg(sprintf('Error while copying from <b>%s</b> to <b>%s</b>', fm_enc($copy), fm_enc($fn_duplicate)), 'error');
            }
       }
       else{
           fm_set_msg(lng('Paths must be not equal'), 'alert');
       }
    }
    $FM_PATH=FM_PATH; fm_redirect(FM_SELF_URL . '?p=' . urlencode($FM_PATH));
}

// Mass copy files/ folders
if (isset($_POST['file'], $_POST['copy_to'], $_POST['finish'], $_POST['token']) && !FM_READONLY) {

    if(!verifyToken($_POST['token'])) {
        fm_set_msg(lng('Invalid Token.'), 'error');
    }
    
    // from
    $path = FM_ROOT_PATH;
    if (FM_PATH != '') {
        $path .= '/' . FM_PATH;
    }
    // to
    $copy_to_path = FM_ROOT_PATH;
    $copy_to = fm_clean_path($_POST['copy_to']);
    if ($copy_to != '') {
        $copy_to_path .= '/' . $copy_to;
    }
    if ($path == $copy_to_path) {
        fm_set_msg(lng('Paths must be not equal'), 'alert');
        $FM_PATH=FM_PATH; fm_redirect(FM_SELF_URL . '?p=' . urlencode($FM_PATH));
    }
    if (!is_dir($copy_to_path)) {
        if (!fm_mkdir($copy_to_path, true)) {
            fm_set_msg('Unable to create destination folder', 'error');
            $FM_PATH=FM_PATH; fm_redirect(FM_SELF_URL . '?p=' . urlencode($FM_PATH));
        }
    }
    // move?
    $move = isset($_POST['move']);
    // copy/move
    $errors = 0;
    $files = $_POST['file'];
    if (is_array($files) && count($files)) {
        foreach ($files as $f) {
            if ($f != '') {
                $f = fm_clean_path($f);
                // abs path from
                $from = $path . '/' . $f;
                // abs path to
                $dest = $copy_to_path . '/' . $f;
                // do
                if ($move) {
                    $rename = fm_rename($from, $dest);
                    if ($rename === false) {
                        $errors++;
                    }
                } else {
                    if (!fm_rcopy($from, $dest)) {
                        $errors++;
                    }
                }
            }
        }
        if ($errors == 0) {
            $msg = $move ? 'Selected files and folders moved' : 'Selected files and folders copied';
            fm_set_msg($msg);
        } else {
            $msg = $move ? 'Error while moving items' : 'Error while copying items';
            fm_set_msg($msg, 'error');
        }
    } else {
        fm_set_msg(lng('Nothing selected'), 'alert');
    }
    $FM_PATH=FM_PATH; fm_redirect(FM_SELF_URL . '?p=' . urlencode($FM_PATH));
}

// Rename
if (isset($_POST['rename_from'], $_POST['rename_to'], $_POST['token']) && !FM_READONLY) {
    if(!verifyToken($_POST['token'])) {
        fm_set_msg("Invalid Token.", 'error');
    }
    // old name
    $old = urldecode($_POST['rename_from']);
    $old = fm_clean_path($old);
    $old = str_replace('/', '', $old);
    // new name
    $new = urldecode($_POST['rename_to']);
    $new = fm_clean_path(strip_tags($new));
    $new = str_replace('/', '', $new);
    // path
    $path = FM_ROOT_PATH;
    if (FM_PATH != '') {
        $path .= '/' . FM_PATH;
    }
    // rename
    if (fm_isvalid_filename($new) && $old != '' && $new != '') {
        if (fm_rename($path . '/' . $old, $path . '/' . $new)) {
            fm_set_msg(sprintf(lng('Renamed from').' <b>%s</b> '. lng('to').' <b>%s</b>', fm_enc($old), fm_enc($new)));
        } else {
            fm_set_msg(sprintf(lng('Error while renaming from').' <b>%s</b> '. lng('to').' <b>%s</b>', fm_enc($old), fm_enc($new)), 'error');
        }
    } else {
        fm_set_msg(lng('Invalid characters in file name'), 'error');
    }
    $FM_PATH=FM_PATH; fm_redirect(FM_SELF_URL . '?p=' . urlencode($FM_PATH));
}

// Download
if (isset($_GET['dl'], $_POST['token'])) {
    if(!verifyToken($_POST['token'])) {
        fm_set_msg("Invalid Token.", 'error');
    }

    $dl = urldecode($_GET['dl']);
    $dl = fm_clean_path($dl);
    $dl = str_replace('/', '', $dl);
    $path = FM_ROOT_PATH;
    if (FM_PATH != '') {
        $path .= '/' . FM_PATH;
    }
    if ($dl != '' && is_file($path . '/' . $dl)) {
        fm_download_file($path . '/' . $dl, $dl, 1024);
        exit;
    } else {
        fm_set_msg(lng('File not found'), 'error');
        $FM_PATH=FM_PATH; fm_redirect(FM_SELF_URL . '?p=' . urlencode($FM_PATH));
    }
}

// Upload
if (!empty($_FILES) && !FM_READONLY) {
    if(isset($_POST['token'])) {
        if(!verifyToken($_POST['token'])) {
            $response = array ('status' => 'error','info' => "Invalid Token.");
            echo json_encode($response); exit();
        }
    } else {
        $response = array ('status' => 'error','info' => "Token Missing.");
        echo json_encode($response); exit();
    }

    $override_file_name = false;
    $chunkIndex = $_POST['dzchunkindex'];
    $chunkTotal = $_POST['dztotalchunkcount'];
    $fullPathInput = fm_clean_path($_REQUEST['fullpath']);

    $f = $_FILES;
    $path = FM_ROOT_PATH;
    $ds = DIRECTORY_SEPARATOR;
    if (FM_PATH != '') {
        $path .= '/' . FM_PATH;
    }

    $errors = 0;
    $uploads = 0;
    $allowed = (FM_UPLOAD_EXTENSION) ? explode(',', FM_UPLOAD_EXTENSION) : false;
    $response = array (
        'status' => 'error',
        'info'   => 'Oops! Try again'
    );

    $filename = $f['file']['name'];
    $tmp_name = $f['file']['tmp_name'];
    $ext = pathinfo($filename, PATHINFO_FILENAME) != '' ? strtolower(pathinfo($filename, PATHINFO_EXTENSION)) : '';
    $isFileAllowed = ($allowed) ? in_array($ext, $allowed) : true;

    if(!fm_isvalid_filename($filename) && !fm_isvalid_filename($fullPathInput)) {
        $response = array (
            'status'    => 'error',
            'info'      => "Invalid File name!",
        );
        echo json_encode($response); exit();
    }

    $targetPath = $path . $ds;
    if ( is_writable($targetPath) ) {
        $fullPath = $path . '/' . basename($fullPathInput);
        $folder = substr($fullPath, 0, strrpos($fullPath, "/"));

        if(file_exists ($fullPath) && !$override_file_name && !$chunks) {
            $ext_1 = $ext ? '.'.$ext : '';
            $fullPath = $path . '/' . basename($fullPathInput, $ext_1) .'_'. date('ymdHis'). $ext_1;
        }

        if (!is_dir($folder)) {
            $old = umask(0);
            mkdir($folder, 0777, true);
            umask($old);
        }

        if (empty($f['file']['error']) && !empty($tmp_name) && $tmp_name != 'none' && $isFileAllowed) {
            if ($chunkTotal){
                $out = @fopen("{$fullPath}.part", $chunkIndex == 0 ? "wb" : "ab");
                if ($out) {
                    $in = @fopen($tmp_name, "rb");
                    if ($in) {
                        while ($buff = fread($in, 4096)) { fwrite($out, $buff); }
                        $response = array (
                            'status'    => 'success',
                            'info' => "file upload successful"
                        );
                    } else {
                        $response = array (
                        'status'    => 'error',
                        'info' => "failed to open output stream",
                        'errorDetails' => error_get_last()
                        );
                    }
                    @fclose($in);
                    @fclose($out);
                    @unlink($tmp_name);

                    $response = array (
                        'status'    => 'success',
                        'info' => "file upload successful"
                    );
                } else {
                    $response = array (
                        'status'    => 'error',
                        'info' => "failed to open output stream"
                        );
                }

                if ($chunkIndex == $chunkTotal - 1) {
                    rename("{$fullPath}.part", $fullPath);
                }

            } else if (move_uploaded_file($tmp_name, $fullPath)) {
                // Be sure that the file has been uploaded
                if ( file_exists($fullPath) ) {
                    $response = array (
                        'status'    => 'success',
                        'info' => "file upload successful"
                    );
                } else {
                    $response = array (
                        'status' => 'error',
                        'info'   => 'Couldn\'t upload the requested file.'
                    );
                }
            } else {
                $response = array (
                    'status'    => 'error',
                    'info'      => "Error while uploading files. Uploaded files $uploads",
                );
            }
        }
    } else {
        $response = array (
            'status' => 'error',
            'info'   => 'The specified folder for upload isn\'t writeable.'
        );
    }
    // Return the response
    echo json_encode($response);
    exit();
}

// Mass deleting
if (isset($_POST['group'], $_POST['delete'], $_POST['token']) && !FM_READONLY) {

    if(!verifyToken($_POST['token'])) {
        fm_set_msg(lng("Invalid Token."), 'error');
    }

    $path = FM_ROOT_PATH;
    if (FM_PATH != '') {
        $path .= '/' . FM_PATH;
    }

    $errors = 0;
    $files = $_POST['file'];
    if (is_array($files) && count($files)) {
        foreach ($files as $f) {
            if ($f != '') {
                $new_path = $path . '/' . $f;
                if (!fm_rdelete($new_path)) {
                    $errors++;
                }
            }
        }
        if ($errors == 0) {
            fm_set_msg(lng('Selected files and folder deleted'));
        } else {
            fm_set_msg(lng('Error while deleting items'), 'error');
        }
    } else {
        fm_set_msg(lng('Nothing selected'), 'alert');
    }

    $FM_PATH=FM_PATH; fm_redirect(FM_SELF_URL . '?p=' . urlencode($FM_PATH));
}

// Pack files zip, tar
if (isset($_POST['group'], $_POST['token']) && (isset($_POST['zip']) || isset($_POST['tar'])) && !FM_READONLY) {

    if(!verifyToken($_POST['token'])) {
        fm_set_msg(lng("Invalid Token."), 'error');
    }

    $path = FM_ROOT_PATH;
    $ext = 'zip';
    if (FM_PATH != '') {
        $path .= '/' . FM_PATH;
    }

    //set pack type
    $ext = isset($_POST['tar']) ? 'tar' : 'zip';

    if (($ext == "zip" && !class_exists('ZipArchive')) || ($ext == "tar" && !class_exists('PharData'))) {
        fm_set_msg(lng('Operations with archives are not available'), 'error');
        $FM_PATH=FM_PATH; fm_redirect(FM_SELF_URL . '?p=' . urlencode($FM_PATH));
    }

    $files = $_POST['file'];
    $sanitized_files = array();

    // clean path
    foreach($files as $file){
        array_push($sanitized_files, fm_clean_path($file));
    }
    
    $files = $sanitized_files;
    
    if (!empty($files)) {
        chdir($path);

        if (count($files) == 1) {
            $one_file = reset($files);
            $one_file = basename($one_file);
            $zipname = $one_file . '_' . date('ymd_His') . '.'.$ext;
        } else {
            $zipname = 'archive_' . date('ymd_His') . '.'.$ext;
        }

        if($ext == 'zip') {
            $zipper = new FM_Zipper();
            $res = $zipper->create($zipname, $files);
        } elseif ($ext == 'tar') {
            $tar = new FM_Zipper_Tar();
            $res = $tar->create($zipname, $files);
        }

        if ($res) {
            fm_set_msg(sprintf(lng('Archive').' <b>%s</b> '.lng('Created'), fm_enc($zipname)));
        } else {
            fm_set_msg(lng('Archive not created'), 'error');
        }
    } else {
        fm_set_msg(lng('Nothing selected'), 'alert');
    }

    $FM_PATH=FM_PATH; fm_redirect(FM_SELF_URL . '?p=' . urlencode($FM_PATH));
}

// Unpack zip, tar
if (isset($_POST['unzip'], $_POST['token']) && !FM_READONLY) {

    if(!verifyToken($_POST['token'])) {
        fm_set_msg(lng("Invalid Token."), 'error');
    }

    $unzip = urldecode($_POST['unzip']);
    $unzip = fm_clean_path($unzip);
    $unzip = str_replace('/', '', $unzip);
    $isValid = false;

    $path = FM_ROOT_PATH;
    if (FM_PATH != '') {
        $path .= '/' . FM_PATH;
    }

    if ($unzip != '' && is_file($path . '/' . $unzip)) {
        $zip_path = $path . '/' . $unzip;
        $ext = pathinfo($zip_path, PATHINFO_EXTENSION);
        $isValid = true;
    } else {
        fm_set_msg(lng('File not found'), 'error');
    }

    if (($ext == "zip" && !class_exists('ZipArchive')) || ($ext == "tar" && !class_exists('PharData'))) {
        fm_set_msg(lng('Operations with archives are not available'), 'error');
        $FM_PATH=FM_PATH; fm_redirect(FM_SELF_URL . '?p=' . urlencode($FM_PATH));
    }

    if ($isValid) {
        //to folder
        $tofolder = '';
        if (isset($_POST['tofolder'])) {
            $tofolder = pathinfo($zip_path, PATHINFO_FILENAME);
            if (fm_mkdir($path . '/' . $tofolder, true)) {
                $path .= '/' . $tofolder;
            }
        }

        if($ext == "zip") {
            $zipper = new FM_Zipper();
            $res = $zipper->unzip($zip_path, $path);
        } elseif ($ext == "tar") {
            try {
                $gzipper = new PharData($zip_path);
                if (@$gzipper->extractTo($path,null, true)) {
                    $res = true;
                } else {
                    $res = false;
                }
            } catch (Exception $e) {
                //TODO:: need to handle the error
                $res = true;
            }
        }

        if ($res) {
            fm_set_msg(lng('Archive unpacked'));
        } else {
            fm_set_msg(lng('Archive not unpacked'), 'error');
        }
    } else {
        fm_set_msg(lng('File not found'), 'error');
    }
    $FM_PATH=FM_PATH; fm_redirect(FM_SELF_URL . '?p=' . urlencode($FM_PATH));
}

// Change Perms (not for Windows)
if (isset($_POST['chmod'], $_POST['token']) && !FM_READONLY && !FM_IS_WIN) {

    if(!verifyToken($_POST['token'])) {
        fm_set_msg(lng("Invalid Token."), 'error');
    }
    
    $path = FM_ROOT_PATH;
    if (FM_PATH != '') {
        $path .= '/' . FM_PATH;
    }

    $file = $_POST['chmod'];
    $file = fm_clean_path($file);
    $file = str_replace('/', '', $file);
    if ($file == '' || (!is_file($path . '/' . $file) && !is_dir($path . '/' . $file))) {
        fm_set_msg(lng('File not found'), 'error');
        $FM_PATH=FM_PATH; fm_redirect(FM_SELF_URL . '?p=' . urlencode($FM_PATH));
    }

    $mode = 0;
    if (!empty($_POST['ur'])) {
        $mode |= 0400;
    }
    if (!empty($_POST['uw'])) {
        $mode |= 0200;
    }
    if (!empty($_POST['ux'])) {
        $mode |= 0100;
    }
    if (!empty($_POST['gr'])) {
        $mode |= 0040;
    }
    if (!empty($_POST['gw'])) {
        $mode |= 0020;
    }
    if (!empty($_POST['gx'])) {
        $mode |= 0010;
    }
    if (!empty($_POST['or'])) {
        $mode |= 0004;
    }
    if (!empty($_POST['ow'])) {
        $mode |= 0002;
    }
    if (!empty($_POST['ox'])) {
        $mode |= 0001;
    }

    if (@chmod($path . '/' . $file, $mode)) {
        fm_set_msg(lng('Permissions changed'));
    } else {
        fm_set_msg(lng('Permissions not changed'), 'error');
    }

    $FM_PATH=FM_PATH; fm_redirect(FM_SELF_URL . '?p=' . urlencode($FM_PATH));
}

/*************************** ACTIONS ***************************/

// get current path
$path = FM_ROOT_PATH;
if (FM_PATH != '') {
    $path .= '/' . FM_PATH;
}

// check path
if (!is_dir($path)) {
    fm_redirect(FM_SELF_URL . '?p=');
}

// get parent folder
$parent = fm_get_parent_path(FM_PATH);

$objects = is_readable($path) ? scandir($path) : array();
$folders = array();
$files = array();
$current_path = array_slice(explode("/",$path), -1)[0];
if (is_array($objects) && fm_is_exclude_items($current_path)) {
    foreach ($objects as $file) {
        if ($file == '.' || $file == '..') {
            continue;
        }
        if (!FM_SHOW_HIDDEN && substr($file, 0, 1) === '.') {
            continue;
        }
        $new_path = $path . '/' . $file;
        if (@is_file($new_path) && fm_is_exclude_items($file)) {
            $files[] = $file;
        } elseif (@is_dir($new_path) && $file != '.' && $file != '..' && fm_is_exclude_items($file)) {
            $folders[] = $file;
        }
    }
}

if (!empty($files)) {
    natcasesort($files);
}
if (!empty($folders)) {
    natcasesort($folders);
}

// upload form
if (isset($_GET['upload']) && !FM_READONLY) {
    fm_show_header(); // HEADER
    fm_show_nav_path(FM_PATH); // current path
    //get the allowed file extensions
    function getUploadExt() {
        $extArr = explode(',', FM_UPLOAD_EXTENSION);
        if(FM_UPLOAD_EXTENSION && $extArr) {
            array_walk($extArr, function(&$x) {$x = ".$x";});
            return implode(',', $extArr);
        }
        return '';
    }
    ?>
    <?php print_external('css-dropzone'); ?>
    <div class="path">

        <div class="card mb-2 fm-upload-wrapper <?php echo fm_get_theme(); ?>">
            <div class="card-header">
                <ul class="nav nav-tabs card-header-tabs">
                    <li class="nav-item">
                        <a class="nav-link active" href="#fileUploader" data-target="#fileUploader"><i class="fa fa-arrow-circle-o-up"></i> <?php echo lng('UploadingFiles') ?></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#urlUploader" class="js-url-upload" data-target="#urlUploader"><i class="fa fa-link"></i> <?php echo lng('Upload from URL') ?></a>
                    </li>
                </ul>
            </div>
            <div class="card-body">
                <p class="card-text">
                    <a href="?p=<?php echo FM_PATH ?>" class="float-right"><i class="fa fa-chevron-circle-left go-back"></i> <?php echo lng('Back')?></a>
                    <strong><?php echo lng('DestinationFolder') ?></strong>: <?php echo fm_enc(fm_convert_win(FM_PATH)) ?>
                </p>

                <form action="<?php echo htmlspecialchars(FM_SELF_URL) . '?p=' . fm_enc(FM_PATH) ?>" class="dropzone card-tabs-container" id="fileUploader" enctype="multipart/form-data">
                    <input type="hidden" name="p" value="<?php echo fm_enc(FM_PATH) ?>">
                    <input type="hidden" name="fullpath" id="fullpath" value="<?php echo fm_enc(FM_PATH) ?>">
                    <input type="hidden" name="token" value="<?php echo $_SESSION['token']; ?>">
                    <div class="fallback">
                        <input name="file" type="file" multiple/>
                    </div>
                </form>

                <div class="upload-url-wrapper card-tabs-container hidden" id="urlUploader">
                    <form id="js-form-url-upload" class="row row-cols-lg-auto g-3 align-items-center" onsubmit="return upload_from_url(this);" method="POST" action="">
                        <input type="hidden" name="type" value="upload" aria-label="hidden" aria-hidden="true">
                        <input type="url" placeholder="URL" name="uploadurl" required class="form-control" style="width: 80%">
                        <input type="hidden" name="token" value="<?php echo $_SESSION['token']; ?>">
                        <button type="submit" class="btn btn-primary ms-3"><?php echo lng('Upload') ?></button>
                        <div class="lds-facebook"><div></div><div></div><div></div></div>
                    </form>
                    <div id="js-url-upload__list" class="col-9 mt-3"></div>
                </div>
            </div>
        </div>
    </div>
    <?php print_external('js-dropzone'); ?>
    <script>
        Dropzone.options.fileUploader = {
            chunking: true,
            chunkSize: <?php echo UPLOAD_CHUNK_SIZE; ?>,
            forceChunking: true,
            retryChunks: true,
            retryChunksLimit: 3,
            parallelUploads: 1,
            parallelChunkUploads: false,
            timeout: 120000,
            maxFilesize: "<?php echo MAX_UPLOAD_SIZE; ?>",
            acceptedFiles : "<?php echo getUploadExt() ?>",
            init: function () {
                this.on("sending", function (file, xhr, formData) {
                    let _path = (file.fullPath) ? file.fullPath : file.name;
                    document.getElementById("fullpath").value = _path;
                    xhr.ontimeout = (function() {
                        toast('Error: Server Timeout');
                    });
                }).on("success", function (res) {
                    let _response = JSON.parse(res.xhr.response);

                    if(_response.status == "error") {
                        toast(_response.info);
                    }
                }).on("error", function(file, response) {
                    toast(response);
                });
            }
        }
    </script>
    <?php
    fm_show_footer();
    exit;
}

// copy form POST
if (isset($_POST['copy']) && !FM_READONLY) {
    $copy_files = isset($_POST['file']) ? $_POST['file'] : null;
    if (!is_array($copy_files) || empty($copy_files)) {
        fm_set_msg(lng('Nothing selected'), 'alert');
        $FM_PATH=FM_PATH; fm_redirect(FM_SELF_URL . '?p=' . urlencode($FM_PATH));
    }

    fm_show_header(); // HEADER
    fm_show_nav_path(FM_PATH); // current path
    ?>
    <div class="path">
        <div class="card <?php echo fm_get_theme(); ?>">
            <div class="card-header">
                <h6><?php echo lng('Copying') ?></h6>
            </div>
            <div class="card-body">
                <form action="" method="post">
                    <input type="hidden" name="p" value="<?php echo fm_enc(FM_PATH) ?>">
                    <input type="hidden" name="finish" value="1">
                    <?php
                    foreach ($copy_files as $cf) {
                        echo '<input type="hidden" name="file[]" value="' . fm_enc($cf) . '">' . PHP_EOL;
                    }
                    ?>
                    <p class="break-word"><strong><?php echo lng('Files') ?></strong>: <b><?php echo implode('</b>, <b>', $copy_files) ?></b></p>
                    <p class="break-word"><strong><?php echo lng('SourceFolder') ?></strong>: <?php echo fm_enc(fm_convert_win(FM_ROOT_PATH . '/' . FM_PATH)) ?><br>
                        <label for="inp_copy_to"><strong><?php echo lng('DestinationFolder') ?></strong>:</label>
                        <?php echo FM_ROOT_PATH ?>/<input type="text" name="copy_to" id="inp_copy_to" value="<?php echo fm_enc(FM_PATH) ?>">
                    </p>
                    <p class="custom-checkbox custom-control"><input type="checkbox" name="move" value="1" id="js-move-files" class="custom-control-input"><label for="js-move-files" class="custom-control-label ms-2"> <?php echo lng('Move') ?></label></p>
                    <p>
                        <b><a href="?p=<?php echo urlencode(FM_PATH) ?>" class="btn btn-outline-danger"><i class="fa fa-times-circle"></i> <?php echo lng('Cancel') ?></a></b>&nbsp;
                        <input type="hidden" name="token" value="<?php echo $_SESSION['token']; ?>">
                        <button type="submit" class="btn btn-success"><i class="fa fa-check-circle"></i> <?php echo lng('Copy') ?></button> 
                    </p>
                </form>
            </div>
        </div>
    </div>
    <?php
    fm_show_footer();
    exit;
}

// copy form
if (isset($_GET['copy']) && !isset($_GET['finish']) && !FM_READONLY) {
    $copy = $_GET['copy'];
    $copy = fm_clean_path($copy);
    if ($copy == '' || !file_exists(FM_ROOT_PATH . '/' . $copy)) {
        fm_set_msg(lng('File not found'), 'error');
        $FM_PATH=FM_PATH; fm_redirect(FM_SELF_URL . '?p=' . urlencode($FM_PATH));
    }

    fm_show_header(); // HEADER
    fm_show_nav_path(FM_PATH); // current path
    ?>
    <div class="path">
        <p><b>Copying</b></p>
        <p class="break-word">
            <strong>Source path:</strong> <?php echo fm_enc(fm_convert_win(FM_ROOT_PATH . '/' . $copy)) ?><br>
            <strong>Destination folder:</strong> <?php echo fm_enc(fm_convert_win(FM_ROOT_PATH . '/' . FM_PATH)) ?>
        </p>
        <p>
            <b><a href="?p=<?php echo urlencode(FM_PATH) ?>&amp;copy=<?php echo urlencode($copy) ?>&amp;finish=1"><i class="fa fa-check-circle"></i> Copy</a></b> &nbsp;
            <b><a href="?p=<?php echo urlencode(FM_PATH) ?>&amp;copy=<?php echo urlencode($copy) ?>&amp;finish=1&amp;move=1"><i class="fa fa-check-circle"></i> Move</a></b> &nbsp;
            <b><a href="?p=<?php echo urlencode(FM_PATH) ?>" class="text-danger"><i class="fa fa-times-circle"></i> Cancel</a></b>
        </p>
        <p><i><?php echo lng('Select folder') ?></i></p>
        <ul class="folders break-word">
            <?php
            if ($parent !== false) {
                ?>
                <li><a href="?p=<?php echo urlencode($parent) ?>&amp;copy=<?php echo urlencode($copy) ?>"><i class="fa fa-chevron-circle-left"></i> ..</a></li>
                <?php
            }
            foreach ($folders as $f) {
                ?>
                <li>
                    <a href="?p=<?php echo urlencode(trim(FM_PATH . '/' . $f, '/')) ?>&amp;copy=<?php echo urlencode($copy) ?>"><i class="fa fa-folder-o"></i> <?php echo fm_convert_win($f) ?></a></li>
                <?php
            }
            ?>
        </ul>
    </div>
    <?php
    fm_show_footer();
    exit;
}

if (isset($_GET['settings']) && !FM_READONLY) {
    fm_show_header(); // HEADER
    fm_show_nav_path(FM_PATH); // current path
    global $cfg, $lang, $lang_list;
    ?>

    <div class="col-md-8 offset-md-2 pt-3">
        <div class="card mb-2 <?php echo fm_get_theme(); ?>">
            <h6 class="card-header d-flex justify-content-between">
                <span><i class="fa fa-cog"></i>  <?php echo lng('Settings') ?></span>
                <a href="?p=<?php echo FM_PATH ?>" class="text-danger"><i class="fa fa-times-circle-o"></i> <?php echo lng('Cancel')?></a>
            </h6>
            <div class="card-body">
                <form id="js-settings-form" action="" method="post" data-type="ajax" onsubmit="return save_settings(this)">
                    <input type="hidden" name="type" value="settings" aria-label="hidden" aria-hidden="true">
                    <div class="form-group row">
                        <label for="js-language" class="col-sm-3 col-form-label"><?php echo lng('Language') ?></label>
                        <div class="col-sm-5">
                            <select class="form-select" id="js-language" name="js-language">
                                <?php
                                function getSelected($l) {
                                    global $lang;
                                    return ($lang == $l) ? 'selected' : '';
                                }
                                foreach ($lang_list as $k => $v) {
                                    echo "<option value='$k' ".getSelected($k).">$v</option>";
                                }
                                ?>
                            </select>
                        </div>
                    </div>
                    <div class="mt-3 mb-3 row ">
                        <label for="js-error-report" class="col-sm-3 col-form-label"><?php echo lng('ErrorReporting') ?></label>
                        <div class="col-sm-9">
                            <div class="form-check form-switch">
                              <input class="form-check-input" type="checkbox" role="switch" id="js-error-report" name="js-error-report" value="true" <?php echo $report_errors ? 'checked' : ''; ?> />
                            </div>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label for="js-show-hidden" class="col-sm-3 col-form-label"><?php echo lng('ShowHiddenFiles') ?></label>
                        <div class="col-sm-9">
                            <div class="form-check form-switch">
                              <input class="form-check-input" type="checkbox" role="switch" id="js-show-hidden" name="js-show-hidden" value="true" <?php echo $show_hidden_files ? 'checked' : ''; ?> />
                            </div>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label for="js-hide-cols" class="col-sm-3 col-form-label"><?php echo lng('HideColumns') ?></label>
                        <div class="col-sm-9">
                            <div class="form-check form-switch">
                              <input class="form-check-input" type="checkbox" role="switch" id="js-hide-cols" name="js-hide-cols" value="true" <?php echo $hide_Cols ? 'checked' : ''; ?> />
                            </div>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label for="js-3-1" class="col-sm-3 col-form-label"><?php echo lng('Theme') ?></label>
                        <div class="col-sm-5">
                            <select class="form-select w-100" id="js-3-0" name="js-theme-3">
                                <option value='light' <?php if($theme == "light"){echo "selected";} ?>><?php echo lng('light') ?></option>
                                <option value='dark' <?php if($theme == "dark"){echo "selected";} ?>><?php echo lng('dark') ?></option>
                            </select>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <div class="col-sm-10">
                            <button type="submit" class="btn btn-success"> <i class="fa fa-check-circle"></i> <?php echo lng('Save'); ?></button>
                        </div>
                    </div>

                </form>
            </div>
        </div>
    </div>
    <?php
    fm_show_footer();
    exit;
}

if (isset($_GET['help'])) {
    fm_show_header(); // HEADER
    fm_show_nav_path(FM_PATH); // current path
    global $cfg, $lang;
    ?>

    <div class="col-md-8 offset-md-2 pt-3">
        <div class="card mb-2 <?php echo fm_get_theme(); ?>">
            <h6 class="card-header d-flex justify-content-between">
                <span><i class="fa fa-exclamation-circle"></i> <?php echo lng('Help') ?></span>
                <a href="?p=<?php echo FM_PATH ?>" class="text-danger"><i class="fa fa-times-circle-o"></i> <?php echo lng('Cancel')?></a>
            </h6>
            <div class="card-body">
                <div class="row">
                    <div class="col-xs-12 col-sm-6">
                        <p><h3><a href="" target="_blank" class="app-v-title"> Flix File Manager <?php echo VERSION; ?></a></h3></p>
                        <p>Author: FLIX OP</p>
                        <p>Mail Us: <a href="mailto:Flixjod@gmail.com">flixjod@gmail.com</a> </p>
                    </div>
                    <div class="col-xs-12 col-sm-6">
                        <div class="card">
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item"><a href="" target="_blank"><i class="fa fa-question-circle"></i> <?php echo lng('Help Documents') ?> </a> </li>
                                <li class="list-group-item"><a href="s" target="_blank"><i class="fa fa-bug"></i> <?php echo lng('Report Issue') ?></a></li>
                                <?php if(!FM_READONLY) { ?>
                                <li class="list-group-item"><a href="javascript:show_new_pwd();"><i class="fa fa-lock"></i> <?php echo lng('Generate new password hash') ?></a></li>
                                <?php } ?>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="row js-new-pwd hidden mt-2">
                    <div class="col-12">
                        <form class="form-inline" onsubmit="return new_password_hash(this)" method="POST" action="">
                            <input type="hidden" name="type" value="pwdhash" aria-label="hidden" aria-hidden="true">
                            <div class="form-group mb-2">
                                <label for="staticEmail2"><?php echo lng('Generate new password hash') ?></label>
                            </div>
                            <div class="form-group mx-sm-3 mb-2">
                                <label for="inputPassword2" class="sr-only"><?php echo lng('Password') ?></label>
                                <input type="text" class="form-control btn-sm" id="inputPassword2" name="inputPassword2" placeholder="<?php echo lng('Password') ?>" required>
                            </div>
                            <button type="submit" class="btn btn-success btn-sm mb-2"><?php echo lng('Generate') ?></button>
                        </form>
                        <textarea class="form-control" rows="2" readonly id="js-pwd-result"></textarea>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <?php
    fm_show_footer();
    exit;
}

// file viewer
if (isset($_GET['view'])) {
    $file = $_GET['view'];
    $file = fm_clean_path($file, false);
    $file = str_replace('/', '', $file);
    if ($file == '' || !is_file($path . '/' . $file) || in_array($file, $GLOBALS['exclude_items'])) {
        fm_set_msg(lng('File not found'), 'error');
        $FM_PATH=FM_PATH; fm_redirect(FM_SELF_URL . '?p=' . urlencode($FM_PATH));
    }

    fm_show_header(); // HEADER
    fm_show_nav_path(FM_PATH); // current path

    $file_url = FM_ROOT_URL . fm_convert_win((FM_PATH != '' ? '/' . FM_PATH : '') . '/' . $file);
    $file_path = $path . '/' . $file;

    $ext = strtolower(pathinfo($file_path, PATHINFO_EXTENSION));
    $mime_type = fm_get_mime_type($file_path);
    $filesize_raw = fm_get_size($file_path);
    $filesize = fm_get_filesize($filesize_raw);

    $is_zip = false;
    $is_gzip = false;
    $is_image = false;
    $is_audio = false;
    $is_video = false;
    $is_text = false;
    $is_onlineViewer = false;

    $view_title = 'File';
    $filenames = false; // for zip
    $content = ''; // for text
    $online_viewer = strtolower(FM_DOC_VIEWER);

    if($online_viewer && $online_viewer !== 'false' && in_array($ext, fm_get_onlineViewer_exts())){
        $is_onlineViewer = true;
    }
    elseif ($ext == 'zip' || $ext == 'tar') {
        $is_zip = true;
        $view_title = 'Archive';
        $filenames = fm_get_zif_info($file_path, $ext);
    } elseif (in_array($ext, fm_get_image_exts())) {
        $is_image = true;
        $view_title = 'Image';
    } elseif (in_array($ext, fm_get_audio_exts())) {
        $is_audio = true;
        $view_title = 'Audio';
    } elseif (in_array($ext, fm_get_video_exts())) {
        $is_video = true;
        $view_title = 'Video';
    } elseif (in_array($ext, fm_get_text_exts()) || substr($mime_type, 0, 4) == 'text' || in_array($mime_type, fm_get_text_mimes())) {
        $is_text = true;
        $content = file_get_contents($file_path);
    }

    ?>
    <div class="row">
        <div class="col-12">
            <p class="break-word"><b><?php echo lng($view_title) ?> "<?php echo fm_enc(fm_convert_win($file)) ?>"</b></p>
            <p class="break-word">
                <strong>Full path:</strong> <?php echo fm_enc(fm_convert_win($file_path)) ?><br>
                <strong>File size:</strong> <?php echo ($filesize_raw <= 1000) ? "$filesize_raw bytes" : $filesize; ?><br>
                <strong>MIME-type:</strong> <?php echo $mime_type ?><br>
                <?php
                // ZIP info
                if (($is_zip || $is_gzip) && $filenames !== false) {
                    $total_files = 0;
                    $total_comp = 0;
                    $total_uncomp = 0;
                    foreach ($filenames as $fn) {
                        if (!$fn['folder']) {
                            $total_files++;
                        }
                        $total_comp += $fn['compressed_size'];
                        $total_uncomp += $fn['filesize'];
                    }
                    ?>
                    <?php echo lng('Files in archive') ?>: <?php echo $total_files ?><br>
                    <?php echo lng('Total size') ?>: <?php echo fm_get_filesize($total_uncomp) ?><br>
                    <?php echo lng('Size in archive') ?>: <?php echo fm_get_filesize($total_comp) ?><br>
                    <?php echo lng('Compression') ?>: <?php echo round(($total_comp / max($total_uncomp, 1)) * 100) ?>%<br>
                    <?php
                }
                // Image info
                if ($is_image) {
                    $image_size = getimagesize($file_path);
                    echo lng('Image sizes').': ' . (isset($image_size[0]) ? $image_size[0] : '0') . ' x ' . (isset($image_size[1]) ? $image_size[1] : '0') . '<br>';
                }
                // Text info
                if ($is_text) {
                    $is_utf8 = fm_is_utf8($content);
                    if (function_exists('iconv')) {
                        if (!$is_utf8) {
                            $content = iconv(FM_ICONV_INPUT_ENC, 'UTF-8//IGNORE', $content);
                        }
                    }
                    echo '<strong>'.lng('Charset').':</strong> ' . ($is_utf8 ? 'utf-8' : '8 bit') . '<br>';
                }
                ?>
            </p>
            <div class="d-flex align-items-center mb-3">
                <form method="post" class="d-inline ms-2" action="?p=<?php echo urlencode(FM_PATH) ?>&amp;dl=<?php echo urlencode($file) ?>">
                    <input type="hidden" name="token" value="<?php echo $_SESSION['token']; ?>">
                    <button type="submit" class="btn btn-link text-decoration-none fw-bold p-0"><i class="fa fa-cloud-download"></i> <?php echo lng('Download') ?></button> &nbsp;
                </form>
                <b class="ms-2"><a href="<?php echo fm_enc($file_url) ?>" target="_blank"><i class="fa fa-external-link-square"></i> <?php echo lng('Open') ?></a></b>
                <?php
                // ZIP actions
                if (!FM_READONLY && ($is_zip || $is_gzip) && $filenames !== false) {
                    $zip_name = pathinfo($file_path, PATHINFO_FILENAME);
                    ?>
                    <form method="post" class="d-inline ms-2">
                        <input type="hidden" name="token" value="<?php echo $_SESSION['token']; ?>">
                        <input type="hidden" name="unzip" value="<?php echo urlencode($file); ?>">
                        <button type="submit" class="btn btn-link text-decoration-none fw-bold p-0" style="font-size: 14px;"><i class="fa fa-check-circle"></i> <?php echo lng('UnZip') ?></button>
                    </form>&nbsp;
                    <form method="post" class="d-inline ms-2">
                        <input type="hidden" name="token" value="<?php echo $_SESSION['token']; ?>">
                        <input type="hidden" name="unzip" value="<?php echo urlencode($file); ?>">
                        <input type="hidden" name="tofolder" value="1">
                        <button type="submit" class="btn btn-link text-decoration-none fw-bold p-0" style="font-size: 14px;" title="UnZip to <?php echo fm_enc($zip_name) ?>"><i class="fa fa-check-circle"></i> <?php echo lng('UnZipToFolder') ?></button>
                    </form>&nbsp;
                    <?php
                }
                if ($is_text && !FM_READONLY) {
                    ?>
                    <b class="ms-2"><a href="?p=<?php echo urlencode(trim(FM_PATH)) ?>&amp;edit=<?php echo urlencode($file) ?>" class="edit-file"><i class="fa fa-pencil-square"></i> <?php echo lng('Edit') ?>
                        </a></b> &nbsp;
                    <b class="ms-2"><a href="?p=<?php echo urlencode(trim(FM_PATH)) ?>&amp;edit=<?php echo urlencode($file) ?>&env=ace"
                            class="edit-file"><i class="fa fa-pencil-square-o"></i> <?php echo lng('AdvancedEditor') ?>
                        </a></b> &nbsp;
                <?php } ?>
                <b class="ms-2"><a href="?p=<?php echo urlencode(FM_PATH) ?>"><i class="fa fa-chevron-circle-left go-back"></i> <?php echo lng('Back') ?></a></b>
            </div>
            <?php
            if($is_onlineViewer) {
                if($online_viewer == 'google') {
                    echo '<iframe src="https://docs.google.com/viewer?embedded=true&hl=en&url=' . fm_enc($file_url) . '" frameborder="no" style="width:100%;min-height:460px"></iframe>';
                } else if($online_viewer == 'microsoft') {
                    echo '<iframe src="https://view.officeapps.live.com/op/embed.aspx?src=' . fm_enc($file_url) . '" frameborder="no" style="width:100%;min-height:460px"></iframe>';
                }
            } elseif ($is_zip) {
                // ZIP content
                if ($filenames !== false) {
                    echo '<code class="maxheight">';
                    foreach ($filenames as $fn) {
                        if ($fn['folder']) {
                            echo '<b>' . fm_enc($fn['name']) . '</b><br>';
                        } else {
                            echo $fn['name'] . ' (' . fm_get_filesize($fn['filesize']) . ')<br>';
                        }
                    }
                    echo '</code>';
                } else {
                    echo '<p>'.lng('Error while fetching archive info').'</p>';
                }
            } elseif ($is_image) {
                // Image content
                if (in_array($ext, array('gif', 'jpg', 'jpeg', 'png', 'bmp', 'ico', 'svg', 'webp', 'avif'))) {
                    echo '<p><img src="' . fm_enc($file_url) . '" alt="image" class="preview-img-container" class="preview-img"></p>';
                }
            } elseif ($is_audio) {
                // Audio content
                echo '<p><audio src="' . fm_enc($file_url) . '" controls preload="metadata"></audio></p>';
            } elseif ($is_video) {
                // Video content
                echo '<div class="preview-video"><video src="' . fm_enc($file_url) . '" width="640" height="360" controls preload="metadata"></video></div>';
            } elseif ($is_text) {
                if (FM_USE_HIGHLIGHTJS) {
                    // highlight
                    $hljs_classes = array(
                        'shtml' => 'xml',
                        'htaccess' => 'apache',
                        'phtml' => 'php',
                        'lock' => 'json',
                        'svg' => 'xml',
                    );
                    $hljs_class = isset($hljs_classes[$ext]) ? 'lang-' . $hljs_classes[$ext] : 'lang-' . $ext;
                    if (empty($ext) || in_array(strtolower($file), fm_get_text_names()) || preg_match('#\.min\.(css|js)$#i', $file)) {
                        $hljs_class = 'nohighlight';
                    }
                    $content = '<pre class="with-hljs"><code class="' . $hljs_class . '">' . fm_enc($content) . '</code></pre>';
                } elseif (in_array($ext, array('php', 'php4', 'php5', 'phtml', 'phps'))) {
                    // php highlight
                    $content = highlight_string($content, true);
                } else {
                    $content = '<pre>' . fm_enc($content) . '</pre>';
                }
                echo $content;
            }
            ?>
        </div>
    </div>
    <?php
        fm_show_footer();
    exit;
}

// file editor
if (isset($_GET['edit']) && !FM_READONLY) {
    $file = $_GET['edit'];
    $file = fm_clean_path($file, false);
    $file = str_replace('/', '', $file);
    if ($file == '' || !is_file($path . '/' . $file) || in_array($file, $GLOBALS['exclude_items'])) {
        fm_set_msg(lng('File not found'), 'error');
        $FM_PATH=FM_PATH; fm_redirect(FM_SELF_URL . '?p=' . urlencode($FM_PATH));
    }
    $editFile = ' : <i><b>'. $file. '</b></i>';
    header('X-XSS-Protection:0');
    fm_show_header(); // HEADER
    fm_show_nav_path(FM_PATH); // current path

    $file_url = FM_ROOT_URL . fm_convert_win((FM_PATH != '' ? '/' . FM_PATH : '') . '/' . $file);
    $file_path = $path . '/' . $file;

    // normal editer
    $isNormalEditor = true;
    if (isset($_GET['env'])) {
        if ($_GET['env'] == "ace") {
            $isNormalEditor = false;
        }
    }

    // Save File
    if (isset($_POST['savedata'])) {
        $writedata = $_POST['savedata'];
        $fd = fopen($file_path, "w");
        @fwrite($fd, $writedata);
        fclose($fd);
        fm_set_msg(lng('File Saved Successfully'));
    }

    $ext = strtolower(pathinfo($file_path, PATHINFO_EXTENSION));
    $mime_type = fm_get_mime_type($file_path);
    $filesize = filesize($file_path);
    $is_text = false;
    $content = ''; // for text

    if (in_array($ext, fm_get_text_exts()) || substr($mime_type, 0, 4) == 'text' || in_array($mime_type, fm_get_text_mimes())) {
        $is_text = true;
        $content = file_get_contents($file_path);
    }

    ?>
    <div class="path">
        <div class="row">
            <div class="col-xs-12 col-sm-5 col-lg-6 pt-1">
                <div class="btn-toolbar" role="toolbar">
                    <?php if (!$isNormalEditor) { ?>
                        <div class="btn-group js-ace-toolbar">
                            <button data-cmd="none" data-option="fullscreen" class="btn btn-sm btn-outline-secondary" id="js-ace-fullscreen" title="<?php echo lng('Fullscreen') ?>"><i class="fa fa-expand" title="<?php echo lng('Fullscreen') ?>"></i></button>
                            <button data-cmd="find" class="btn btn-sm btn-outline-secondary" id="js-ace-search" title="<?php echo lng('Search') ?>"><i class="fa fa-search" title="<?php echo lng('Search') ?>"></i></button>
                            <button data-cmd="undo" class="btn btn-sm btn-outline-secondary" id="js-ace-undo" title="<?php echo lng('Undo') ?>"><i class="fa fa-undo" title="<?php echo lng('Undo') ?>"></i></button>
                            <button data-cmd="redo" class="btn btn-sm btn-outline-secondary" id="js-ace-redo" title="<?php echo lng('Redo') ?>"><i class="fa fa-repeat" title="<?php echo lng('Redo') ?>"></i></button>
                            <button data-cmd="none" data-option="wrap" class="btn btn-sm btn-outline-secondary" id="js-ace-wordWrap" title="<?php echo lng('Word Wrap') ?>"><i class="fa fa-text-width" title="<?php echo lng('Word Wrap') ?>"></i></button>
                            <select id="js-ace-mode" data-type="mode" title="<?php echo lng('Select Document Type') ?>" class="btn-outline-secondary border-start-0 d-none d-md-block"><option>-- <?php echo lng('Select Mode') ?> --</option></select>
                            <select id="js-ace-theme" data-type="theme" title="<?php echo lng('Select Theme') ?>" class="btn-outline-secondary border-start-0 d-none d-lg-block"><option>-- <?php echo lng('Select Theme') ?> --</option></select>
                            <select id="js-ace-fontSize" data-type="fontSize" title="<?php echo lng('Select Font Size') ?>" class="btn-outline-secondary border-start-0 d-none d-lg-block"><option>-- <?php echo lng('Select Font Size') ?> --</option></select>
                        </div>
                    <?php } ?>
                </div>
            </div>
            <div class="edit-file-actions col-xs-12 col-sm-7 col-lg-6 text-end pt-1">
                <a title="<?php echo lng('Back') ?>" class="btn btn-sm btn-outline-primary" href="?p=<?php echo urlencode(trim(FM_PATH)) ?>&amp;view=<?php echo urlencode($file) ?>"><i class="fa fa-reply-all"></i> <?php echo lng('Back') ?></a>
                <a title="<?php echo lng('BackUp') ?>" class="btn btn-sm btn-outline-primary" href="javascript:void(0);" onclick="backup('<?php echo urlencode(trim(FM_PATH)) ?>','<?php echo urlencode($file) ?>')"><i class="fa fa-database"></i> <?php echo lng('BackUp') ?></a>
                <?php if ($is_text) { ?>
                    <?php if ($isNormalEditor) { ?>
                        <a title="Advanced" class="btn btn-sm btn-outline-primary" href="?p=<?php echo urlencode(trim(FM_PATH)) ?>&amp;edit=<?php echo urlencode($file) ?>&amp;env=ace"><i class="fa fa-pencil-square-o"></i> <?php echo lng('AdvancedEditor') ?></a>
                        <button type="button" class="btn btn-sm btn-success" name="Save" data-url="<?php echo fm_enc($file_url) ?>" onclick="edit_save(this,'nrl')"><i class="fa fa-floppy-o"></i> Save
                        </button>
                    <?php } else { ?>
                        <a title="Plain Editor" class="btn btn-sm btn-outline-primary" href="?p=<?php echo urlencode(trim(FM_PATH)) ?>&amp;edit=<?php echo urlencode($file) ?>"><i class="fa fa-text-height"></i> <?php echo lng('NormalEditor') ?></a>
                        <button type="button" class="btn btn-sm btn-success" name="Save" data-url="<?php echo fm_enc($file_url) ?>" onclick="edit_save(this,'ace')"><i class="fa fa-floppy-o"></i> <?php echo lng('Save') ?>
                        </button>
                    <?php } ?>
                <?php } ?>
            </div>
        </div>
        <?php
        if ($is_text && $isNormalEditor) {
            echo '<textarea class="mt-2" id="normal-editor" rows="33" cols="120" style="width: 99.5%;">' . htmlspecialchars($content) . '</textarea>';
            echo '<script>document.addEventListener("keydown", function(e) {if ((window.navigator.platform.match("Mac") ? e.metaKey : e.ctrlKey)  && e.keyCode == 83) { e.preventDefault();edit_save(this,"nrl");}}, false);</script>';
        } elseif ($is_text) {
            echo '<div id="editor" contenteditable="true">' . htmlspecialchars($content) . '</div>';
        } else {
            fm_set_msg(lng('FILE EXTENSION HAS NOT SUPPORTED'), 'error');
        }
        ?>
    </div>
    <?php
    fm_show_footer();
    exit;
}

// chmod (not for Windows)
if (isset($_GET['chmod']) && !FM_READONLY && !FM_IS_WIN) {
    $file = $_GET['chmod'];
    $file = fm_clean_path($file);
    $file = str_replace('/', '', $file);
    if ($file == '' || (!is_file($path . '/' . $file) && !is_dir($path . '/' . $file))) {
        fm_set_msg(lng('File not found'), 'error');
        $FM_PATH=FM_PATH; fm_redirect(FM_SELF_URL . '?p=' . urlencode($FM_PATH));
    }

    fm_show_header(); // HEADER
    fm_show_nav_path(FM_PATH); // current path

    $file_url = FM_ROOT_URL . (FM_PATH != '' ? '/' . FM_PATH : '') . '/' . $file;
    $file_path = $path . '/' . $file;

    $mode = fileperms($path . '/' . $file);
    ?>
    <div class="path">
        <div class="card mb-2 <?php echo fm_get_theme(); ?>">
            <h6 class="card-header">
                <?php echo lng('ChangePermissions') ?>
            </h6>
            <div class="card-body">
                <p class="card-text">
                    Full path: <?php echo $file_path ?><br>
                </p>
                <form action="" method="post">
                    <input type="hidden" name="p" value="<?php echo fm_enc(FM_PATH) ?>">
                    <input type="hidden" name="chmod" value="<?php echo fm_enc($file) ?>">

                    <table class="table compact-table <?php echo fm_get_theme(); ?>">
                        <tr>
                            <td></td>
                            <td><b><?php echo lng('Owner') ?></b></td>
                            <td><b><?php echo lng('Group') ?></b></td>
                            <td><b><?php echo lng('Other') ?></b></td>
                        </tr>
                        <tr>
                            <td style="text-align: right"><b><?php echo lng('Read') ?></b></td>
                            <td><label><input type="checkbox" name="ur" value="1"<?php echo ($mode & 00400) ? ' checked' : '' ?>></label></td>
                            <td><label><input type="checkbox" name="gr" value="1"<?php echo ($mode & 00040) ? ' checked' : '' ?>></label></td>
                            <td><label><input type="checkbox" name="or" value="1"<?php echo ($mode & 00004) ? ' checked' : '' ?>></label></td>
                        </tr>
                        <tr>
                            <td style="text-align: right"><b><?php echo lng('Write') ?></b></td>
                            <td><label><input type="checkbox" name="uw" value="1"<?php echo ($mode & 00200) ? ' checked' : '' ?>></label></td>
                            <td><label><input type="checkbox" name="gw" value="1"<?php echo ($mode & 00020) ? ' checked' : '' ?>></label></td>
                            <td><label><input type="checkbox" name="ow" value="1"<?php echo ($mode & 00002) ? ' checked' : '' ?>></label></td>
                        </tr>
                        <tr>
                            <td style="text-align: right"><b><?php echo lng('Execute') ?></b></td>
                            <td><label><input type="checkbox" name="ux" value="1"<?php echo ($mode & 00100) ? ' checked' : '' ?>></label></td>
                            <td><label><input type="checkbox" name="gx" value="1"<?php echo ($mode & 00010) ? ' checked' : '' ?>></label></td>
                            <td><label><input type="checkbox" name="ox" value="1"<?php echo ($mode & 00001) ? ' checked' : '' ?>></label></td>
                        </tr>
                    </table>

                    <p>
                       <input type="hidden" name="token" value="<?php echo $_SESSION['token']; ?>"> 
                        <b><a href="?p=<?php echo urlencode(FM_PATH) ?>" class="btn btn-outline-primary"><i class="fa fa-times-circle"></i> <?php echo lng('Cancel') ?></a></b>&nbsp;
                        <button type="submit" class="btn btn-success"><i class="fa fa-check-circle"></i> <?php echo lng('Change') ?></button>
                    </p>
                </form>
            </div>
        </div>
    </div>
    <?php
    fm_show_footer();
    exit;
}

// --- FLIXFILEMANAGER MAIN ---
fm_show_header(); // HEADER
fm_show_nav_path(FM_PATH); // current path

// show alert messages
fm_show_message();

$num_files = count($files);
$num_folders = count($folders);
$all_files_size = 0;
$tableTheme = (FM_THEME == "dark") ? "text-white bg-dark table-dark" : "bg-white";
?>
<form action="" method="post" class="pt-3">
    <input type="hidden" name="p" value="<?php echo fm_enc(FM_PATH) ?>">
    <input type="hidden" name="group" value="1">
    <input type="hidden" name="token" value="<?php echo $_SESSION['token']; ?>">
    <div class="table-responsive">
        <table class="table table-bordered table-hover table-sm <?php echo $tableTheme; ?>" id="main-table">
            <thead class="thead-white">
            <tr>
                <?php if (!FM_READONLY): ?>
                    <th style="width:3%" class="custom-checkbox-header">
                        <div class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input" id="js-select-all-items" onclick="checkbox_toggle()">
                            <label class="custom-control-label" for="js-select-all-items"></label>
                        </div>
                    </th><?php endif; ?>
                <th><?php echo lng('Name') ?></th>
                <th><?php echo lng('Size') ?></th>
                <th><?php echo lng('Modified') ?></th>
                <?php if (!FM_IS_WIN && !$hide_Cols): ?>
                    <th><?php echo lng('Perms') ?></th>
                    <th><?php echo lng('Owner') ?></th><?php endif; ?>
                <th><?php echo lng('Actions') ?></th>
            </tr>
            </thead>
            <?php
            // link to parent folder
            if ($parent !== false) {
                ?>
                <tr><?php if (!FM_READONLY): ?>
                    <td class="nosort"></td><?php endif; ?>
                    <td class="border-0" data-sort><a href="?p=<?php echo urlencode($parent) ?>"><i class="fa fa-chevron-circle-left go-back"></i> ..</a></td>
                    <td class="border-0" data-order></td>
                    <td class="border-0" data-order></td>
                    <td class="border-0"></td>
                    <?php if (!FM_IS_WIN && !$hide_Cols) { ?>
                        <td class="border-0"></td>
                        <td class="border-0"></td>
                    <?php } ?>
                </tr>
                <?php
            }
            $ii = 3399;
            foreach ($folders as $f) {
                $is_link = is_link($path . '/' . $f);
                $img = $is_link ? 'icon-link_folder' : 'fa fa-folder-o';
                $modif_raw = filemtime($path . '/' . $f);
                $modif = date(FM_DATETIME_FORMAT, $modif_raw);
                $date_sorting = strtotime(date("F d Y H:i:s.", $modif_raw));
                $filesize_raw = "";
                $filesize = lng('Folder');
                $perms = substr(decoct(fileperms($path . '/' . $f)), -4);
                if (function_exists('posix_getpwuid') && function_exists('posix_getgrgid')) {
                    $owner = posix_getpwuid(fileowner($path . '/' . $f));
                    $group = posix_getgrgid(filegroup($path . '/' . $f));
                } else {
                    $owner = array('name' => '?');
                    $group = array('name' => '?');
                }
                ?>
                <tr>
                    <?php if (!FM_READONLY): ?>
                        <td class="custom-checkbox-td">
                        <div class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input" id="<?php echo $ii ?>" name="file[]" value="<?php echo fm_enc($f) ?>">
                            <label class="custom-control-label" for="<?php echo $ii ?>"></label>
                        </div>
                        </td><?php endif; ?>
                    <td data-sort=<?php echo fm_convert_win(fm_enc($f)) ?>>
                        <div class="filename"><a href="?p=<?php echo urlencode(trim(FM_PATH . '/' . $f, '/')) ?>"><i class="<?php echo $img ?>"></i> <?php echo fm_convert_win(fm_enc($f)) ?>
                            </a><?php echo($is_link ? ' &rarr; <i>' . readlink($path . '/' . $f) . '</i>' : '') ?></div>
                    </td>
                    <td data-order="a-<?php echo str_pad($filesize_raw, 18, "0", STR_PAD_LEFT);?>">
                        <?php echo $filesize; ?>
                    </td>
                    <td data-order="a-<?php echo $date_sorting;?>"><?php echo $modif ?></td>
                    <?php if (!FM_IS_WIN && !$hide_Cols): ?>
                        <td><?php if (!FM_READONLY): ?><a title="Change Permissions" href="?p=<?php echo urlencode(FM_PATH) ?>&amp;chmod=<?php echo urlencode($f) ?>"><?php echo $perms ?></a><?php else: ?><?php echo $perms ?><?php endif; ?>
                        </td>
                        <td><?php echo $owner['name'] . ':' . $group['name'] ?></td>
                    <?php endif; ?>
                    <td class="inline-actions"><?php if (!FM_READONLY): ?>
                            <a title="<?php echo lng('Delete')?>" href="?p=<?php echo urlencode(FM_PATH) ?>&amp;del=<?php echo urlencode($f) ?>" onclick="confirmDailog(event, '1028','<?php echo lng('Delete').' '.lng('Folder'); ?>','<?php echo urlencode($f) ?>', this.href);"> <i class="fa fa-trash-o" aria-hidden="true"></i></a>
                            <a title="<?php echo lng('Rename')?>" href="#" onclick="rename('<?php echo fm_enc(addslashes(FM_PATH)) ?>', '<?php echo fm_enc(addslashes($f)) ?>');return false;"><i class="fa fa-pencil-square-o" aria-hidden="true"></i></a>
                            <a title="<?php echo lng('CopyTo')?>..." href="?p=&amp;copy=<?php echo urlencode(trim(FM_PATH . '/' . $f, '/')) ?>"><i class="fa fa-files-o" aria-hidden="true"></i></a>
                        <?php endif; ?>
                        <a title="<?php echo lng('DirectLink')?>" href="<?php echo fm_enc(FM_ROOT_URL . (FM_PATH != '' ? '/' . FM_PATH : '') . '/' . $f . '/') ?>" target="_blank"><i class="fa fa-link" aria-hidden="true"></i></a>
                    </td>
                </tr>
                <?php
                flush();
                $ii++;
            }
            $ik = 6070;
            foreach ($files as $f) {
                $is_link = is_link($path . '/' . $f);
                $img = $is_link ? 'fa fa-file-text-o' : fm_get_file_icon_class($path . '/' . $f);
                $modif_raw = filemtime($path . '/' . $f);
                $modif = date(FM_DATETIME_FORMAT, $modif_raw);
                $date_sorting = strtotime(date("F d Y H:i:s.", $modif_raw));
                $filesize_raw = fm_get_size($path . '/' . $f);
                $filesize = fm_get_filesize($filesize_raw);
                $filelink = '?p=' . urlencode(FM_PATH) . '&amp;view=' . urlencode($f);
                $all_files_size += $filesize_raw;
                $perms = substr(decoct(fileperms($path . '/' . $f)), -4);
                if (function_exists('posix_getpwuid') && function_exists('posix_getgrgid')) {
                    $owner = posix_getpwuid(fileowner($path . '/' . $f));
                    $group = posix_getgrgid(filegroup($path . '/' . $f));
                } else {
                    $owner = array('name' => '?');
                    $group = array('name' => '?');
                }
                ?>
                <tr>
                    <?php if (!FM_READONLY): ?>
                        <td class="custom-checkbox-td">
                        <div class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input" id="<?php echo $ik ?>" name="file[]" value="<?php echo fm_enc($f) ?>">
                            <label class="custom-control-label" for="<?php echo $ik ?>"></label>
                        </div>
                        </td><?php endif; ?>
                    <td data-sort=<?php echo fm_enc($f) ?>>
                        <div class="filename">
                        <?php
                           if (in_array(strtolower(pathinfo($f, PATHINFO_EXTENSION)), array('gif', 'jpg', 'jpeg', 'png', 'bmp', 'ico', 'svg', 'webp', 'avif'))): ?>
                                <?php $imagePreview = fm_enc(FM_ROOT_URL . (FM_PATH != '' ? '/' . FM_PATH : '') . '/' . $f); ?>
                                <a href="<?php echo $filelink ?>" data-preview-image="<?php echo $imagePreview ?>" title="<?php echo fm_enc($f) ?>">
                           <?php else: ?>
                                <a href="<?php echo $filelink ?>" title="<?php echo $f ?>">
                            <?php endif; ?>
                                    <i class="<?php echo $img ?>"></i> <?php echo fm_convert_win(fm_enc($f)) ?>
                                </a>
                                <?php echo($is_link ? ' &rarr; <i>' . readlink($path . '/' . $f) . '</i>' : '') ?>
                        </div>
                    </td>
                    <td data-order="b-<?php echo str_pad($filesize_raw, 18, "0", STR_PAD_LEFT); ?>"><span title="<?php printf('%s bytes', $filesize_raw) ?>">
                        <?php echo $filesize; ?>
                        </span></td>
                    <td data-order="b-<?php echo $date_sorting;?>"><?php echo $modif ?></td>
                    <?php if (!FM_IS_WIN && !$hide_Cols): ?>
                        <td><?php if (!FM_READONLY): ?><a title="<?php echo 'Change Permissions' ?>" href="?p=<?php echo urlencode(FM_PATH) ?>&amp;chmod=<?php echo urlencode($f) ?>"><?php echo $perms ?></a><?php else: ?><?php echo $perms ?><?php endif; ?>
                        </td>
                        <td><?php echo fm_enc($owner['name'] . ':' . $group['name']) ?></td>
                    <?php endif; ?>
                    <td class="inline-actions">
                        <?php if (!FM_READONLY): ?>
                            <a title="<?php echo lng('Delete') ?>" href="?p=<?php echo urlencode(FM_PATH) ?>&amp;del=<?php echo urlencode($f) ?>" onclick="confirmDailog(event, 1209, '<?php echo lng('Delete').' '.lng('File'); ?>','<?php echo urlencode($f); ?>', this.href);"> <i class="fa fa-trash-o"></i></a>
                            <a title="<?php echo lng('Rename') ?>" href="#" onclick="rename('<?php echo fm_enc(addslashes(FM_PATH)) ?>', '<?php echo fm_enc(addslashes($f)) ?>');return false;"><i class="fa fa-pencil-square-o"></i></a>
                            <a title="<?php echo lng('CopyTo') ?>..."
                               href="?p=<?php echo urlencode(FM_PATH) ?>&amp;copy=<?php echo urlencode(trim(FM_PATH . '/' . $f, '/')) ?>"><i class="fa fa-files-o"></i></a>
                        <?php endif; ?>
                        <a title="<?php echo lng('DirectLink') ?>" href="<?php echo fm_enc(FM_ROOT_URL . (FM_PATH != '' ? '/' . FM_PATH : '') . '/' . $f) ?>" target="_blank"><i class="fa fa-link"></i></a>
                        <a title="<?php echo lng('Download') ?>" href="?p=<?php echo urlencode(FM_PATH) ?>&amp;dl=<?php echo urlencode($f) ?>" onclick="confirmDailog(event, 1211, '<?php echo lng('Download'); ?>','<?php echo urlencode($f); ?>', this.href);"><i class="fa fa-download"></i></a>
                    </td>
                </tr>
                <?php
                flush();
                $ik++;
            }

            if (empty($folders) && empty($files)) { ?>
                <tfoot>
                    <tr><?php if (!FM_READONLY): ?>
                            <td></td><?php endif; ?>
                        <td colspan="<?php echo (!FM_IS_WIN && !$hide_Cols) ? '6' : '4' ?>"><em><?php echo lng('Folder is empty') ?></em></td>
                    </tr>
                </tfoot>
                <?php
            } else { ?>
                <tfoot>
                    <tr>
                        <td class="gray" colspan="<?php echo (!FM_IS_WIN && !$hide_Cols) ? (FM_READONLY ? '6' :'7') : (FM_READONLY ? '4' : '5') ?>">
                            <?php echo lng('FullSize').': <span class="badge text-bg-light border-radius-0">'.fm_get_filesize($all_files_size).'</span>' ?>
                            <?php echo lng('File').': <span class="badge text-bg-light border-radius-0">'.$num_files.'</span>' ?>
                            <?php echo lng('Folder').': <span class="badge text-bg-light border-radius-0">'.$num_folders.'</span>' ?>
                        </td>
                    </tr>
                </tfoot>
                <?php } ?>
        </table>
    </div>

    <div class="row">
        <?php if (!FM_READONLY): ?>
        <div class="col-xs-12 col-sm-9">
            <ul class="list-inline footer-action">
                <li class="list-inline-item"> <a href="#/select-all" class="btn btn-small btn-outline-primary btn-2" onclick="select_all();return false;"><i class="fa fa-check-square"></i> <?php echo lng('SelectAll') ?> </a></li>
                <li class="list-inline-item"><a href="#/unselect-all" class="btn btn-small btn-outline-primary btn-2" onclick="unselect_all();return false;"><i class="fa fa-window-close"></i> <?php echo lng('UnSelectAll') ?> </a></li>
                <li class="list-inline-item"><a href="#/invert-all" class="btn btn-small btn-outline-primary btn-2" onclick="invert_all();return false;"><i class="fa fa-th-list"></i> <?php echo lng('InvertSelection') ?> </a></li>
                <li class="list-inline-item"><input type="submit" class="hidden" name="delete" id="a-delete" value="Delete" onclick="return confirm('<?php echo lng('Delete selected files and folders?'); ?>')">
                    <a href="javascript:document.getElementById('a-delete').click();" class="btn btn-small btn-outline-primary btn-2"><i class="fa fa-trash"></i> <?php echo lng('Delete') ?> </a></li>
                <li class="list-inline-item"><input type="submit" class="hidden" name="zip" id="a-zip" value="zip" onclick="return confirm('<?php echo lng('Create archive?'); ?>')">
                    <a href="javascript:document.getElementById('a-zip').click();" class="btn btn-small btn-outline-primary btn-2"><i class="fa fa-file-archive-o"></i> <?php echo lng('Zip') ?> </a></li>
                <li class="list-inline-item"><input type="submit" class="hidden" name="tar" id="a-tar" value="tar" onclick="return confirm('<?php echo lng('Create archive?'); ?>')">
                    <a href="javascript:document.getElementById('a-tar').click();" class="btn btn-small btn-outline-primary btn-2"><i class="fa fa-file-archive-o"></i> <?php echo lng('Tar') ?> </a></li>
                <li class="list-inline-item"><input type="submit" class="hidden" name="copy" id="a-copy" value="Copy">
                    <a href="javascript:document.getElementById('a-copy').click();" class="btn btn-small btn-outline-primary btn-2"><i class="fa fa-files-o"></i> <?php echo lng('Copy') ?> </a></li>
            </ul>
        </div>
        <div class="col-3 d-none d-sm-block"><a href="" target="_blank" class="float-right text-muted">Flix File Manager <?php echo VERSION; ?></a></div>
        <?php else: ?>
            <div class="col-12"><a href="" target="_blank" class="float-right text-muted">Flix File Manager <?php echo VERSION; ?></a></div>
        <?php endif; ?>
    </div>
</form>

<?php
fm_show_footer();

// --- END HTML ---

// Functions

/**
 * It prints the css/js files into html
 * @param key The key of the external file to print.
 * @return The value of the key in the  array.
 */
function print_external($key) {
    global $external;

    if(!array_key_exists($key, $external)) {
        // throw new Exception('Key missing in external: ' . key);
        echo "<!-- EXTERNAL: MISSING KEY $key -->";
        return;
    }

    echo "$external[$key]";
}

/**
 * Verify CSRF TOKEN and remove after cerify
 * @param string $token
 * @return bool
 */
function verifyToken($token) 
{
    if (hash_equals($_SESSION['token'], $token)) { 
        return true;
    }
    return false;
}

/**
 * Delete  file or folder (recursively)
 * @param string $path
 * @return bool
 */
function fm_rdelete($path)
{
    if (is_link($path)) {
        return unlink($path);
    } elseif (is_dir($path)) {
        $objects = scandir($path);
        $ok = true;
        if (is_array($objects)) {
            foreach ($objects as $file) {
                if ($file != '.' && $file != '..') {
                    if (!fm_rdelete($path . '/' . $file)) {
                        $ok = false;
                    }
                }
            }
        }
        return ($ok) ? rmdir($path) : false;
    } elseif (is_file($path)) {
        return unlink($path);
    }
    return false;
}

/**
 * Recursive chmod
 * @param string $path
 * @param int $filemode
 * @param int $dirmode
 * @return bool
 * @todo Will use in mass chmod
 */
function fm_rchmod($path, $filemode, $dirmode)
{
    if (is_dir($path)) {
        if (!chmod($path, $dirmode)) {
            return false;
        }
        $objects = scandir($path);
        if (is_array($objects)) {
            foreach ($objects as $file) {
                if ($file != '.' && $file != '..') {
                    if (!fm_rchmod($path . '/' . $file, $filemode, $dirmode)) {
                        return false;
                    }
                }
            }
        }
        return true;
    } elseif (is_link($path)) {
        return true;
    } elseif (is_file($path)) {
        return chmod($path, $filemode);
    }
    return false;
}

/**
 * Check the file extension which is allowed or not
 * @param string $filename
 * @return bool
 */
function fm_is_valid_ext($filename)
{
    $allowed = (FM_FILE_EXTENSION) ? explode(',', FM_FILE_EXTENSION) : false;

    $ext = pathinfo($filename, PATHINFO_EXTENSION);
    $isFileAllowed = ($allowed) ? in_array($ext, $allowed) : true;

    return ($isFileAllowed) ? true : false;
}

/**
 * Safely rename
 * @param string $old
 * @param string $new
 * @return bool|null
 */
function fm_rename($old, $new)
{
    $isFileAllowed = fm_is_valid_ext($new);

    if(!is_dir($old)) {
        if (!$isFileAllowed) return false;
    }

    return (!file_exists($new) && file_exists($old)) ? rename($old, $new) : null;
}

/**
 * Copy file or folder (recursively).
 * @param string $path
 * @param string $dest
 * @param bool $upd Update files
 * @param bool $force Create folder with same names instead file
 * @return bool
 */
function fm_rcopy($path, $dest, $upd = true, $force = true)
{
    if (is_dir($path)) {
        if (!fm_mkdir($dest, $force)) {
            return false;
        }
        $objects = scandir($path);
        $ok = true;
        if (is_array($objects)) {
            foreach ($objects as $file) {
                if ($file != '.' && $file != '..') {
                    if (!fm_rcopy($path . '/' . $file, $dest . '/' . $file)) {
                        $ok = false;
                    }
                }
            }
        }
        return $ok;
    } elseif (is_file($path)) {
        return fm_copy($path, $dest, $upd);
    }
    return false;
}

/**
 * Safely create folder
 * @param string $dir
 * @param bool $force
 * @return bool
 */
function fm_mkdir($dir, $force)
{
    if (file_exists($dir)) {
        if (is_dir($dir)) {
            return $dir;
        } elseif (!$force) {
            return false;
        }
        unlink($dir);
    }
    return mkdir($dir, 0777, true);
}

/**
 * Safely copy file
 * @param string $f1
 * @param string $f2
 * @param bool $upd Indicates if file should be updated with new content
 * @return bool
 */
function fm_copy($f1, $f2, $upd)
{
    $time1 = filemtime($f1);
    if (file_exists($f2)) {
        $time2 = filemtime($f2);
        if ($time2 >= $time1 && $upd) {
            return false;
        }
    }
    $ok = copy($f1, $f2);
    if ($ok) {
        touch($f2, $time1);
    }
    return $ok;
}

/**
 * Get mime type
 * @param string $file_path
 * @return mixed|string
 */
function fm_get_mime_type($file_path)
{
    if (function_exists('finfo_open')) {
        $finfo = finfo_open(FILEINFO_MIME_TYPE);
        $mime = finfo_file($finfo, $file_path);
        finfo_close($finfo);
        return $mime;
    } elseif (function_exists('mime_content_type')) {
        return mime_content_type($file_path);
    } elseif (!stristr(ini_get('disable_functions'), 'shell_exec')) {
        $file = escapeshellarg($file_path);
        $mime = shell_exec('file -bi ' . $file);
        return $mime;
    } else {
        return '--';
    }
}

/**
 * HTTP Redirect
 * @param string $url
 * @param int $code
 */
function fm_redirect($url, $code = 302)
{
    header('Location: ' . $url, true, $code);
    exit;
}

/**
 * Path traversal prevention and clean the url
 * It replaces (consecutive) occurrences of / and \\ with whatever is in DIRECTORY_SEPARATOR, and processes /. and /.. fine.
 * @param $path
 * @return string
 */
function get_absolute_path($path) {
    $path = str_replace(array('/', '\\'), DIRECTORY_SEPARATOR, $path);
    $parts = array_filter(explode(DIRECTORY_SEPARATOR, $path), 'strlen');
    $absolutes = array();
    foreach ($parts as $part) {
        if ('.' == $part) continue;
        if ('..' == $part) {
            array_pop($absolutes);
        } else {
            $absolutes[] = $part;
        }
    }
    return implode(DIRECTORY_SEPARATOR, $absolutes);
}

/**
 * Clean path
 * @param string $path
 * @return string
 */
function fm_clean_path($path, $trim = true)
{
    $path = $trim ? trim($path) : $path;
    $path = trim($path, '\\/');
    $path = str_replace(array('../', '..\\'), '', $path);
    $path =  get_absolute_path($path);
    if ($path == '..') {
        $path = '';
    }
    return str_replace('\\', '/', $path);
}

/**
 * Get parent path
 * @param string $path
 * @return bool|string
 */
function fm_get_parent_path($path)
{
    $path = fm_clean_path($path);
    if ($path != '') {
        $array = explode('/', $path);
        if (count($array) > 1) {
            $array = array_slice($array, 0, -1);
            return implode('/', $array);
        }
        return '';
    }
    return false;
}

/**
 * Check file is in exclude list
 * @param string $file
 * @return bool
 */
function fm_is_exclude_items($file) {
    $ext = strtolower(pathinfo($file, PATHINFO_EXTENSION));
    if (isset($exclude_items) and sizeof($exclude_items)) {
        unset($exclude_items);
    }

    $exclude_items = FM_EXCLUDE_ITEMS;
    if (version_compare(PHP_VERSION, '7.0.0', '<')) {
        $exclude_items = unserialize($exclude_items);
    }
    if (!in_array($file, $exclude_items) && !in_array("*.$ext", $exclude_items)) {
        return true;
    }
    return false;
}

/**
 * get language translations from json file
 * @param int $tr
 * @return array
 */
function fm_get_translations($tr) {
    try {
        $content = @file_get_contents('translation.json');
        if($content !== FALSE) {
            $lng = json_decode($content, TRUE);
            global $lang_list;
            foreach ($lng["language"] as $key => $value)
            {
                $code = $value["code"];
                $lang_list[$code] = $value["name"];
                if ($tr)
                    $tr[$code] = $value["translation"];
            }
            return $tr;
        }

    }
    catch (Exception $e) {
        echo $e;
    }
}

/**
 * @param string $file
 * Recover all file sizes larger than > 2GB.
 * Works on php 32bits and 64bits and supports linux
 * @return int|string
 */
function fm_get_size($file)
{
    static $iswin;
    static $isdarwin;
    if (!isset($iswin)) {
        $iswin = (strtoupper(substr(PHP_OS, 0, 3)) == 'WIN');
    }
    if (!isset($isdarwin)) {
        $isdarwin = (strtoupper(substr(PHP_OS, 0)) == "DARWIN");
    }

    static $exec_works;
    if (!isset($exec_works)) {
        $exec_works = (function_exists('exec') && !ini_get('safe_mode') && @exec('echo EXEC') == 'EXEC');
    }

    // try a shell command
    if ($exec_works) {
        $arg = escapeshellarg($file);
        $cmd = ($iswin) ? "for %F in (\"$file\") do @echo %~zF" : ($isdarwin ? "stat -f%z $arg" : "stat -c%s $arg");
        @exec($cmd, $output);
        if (is_array($output) && ctype_digit($size = trim(implode("\n", $output)))) {
            return $size;
        }
    }

    // try the Windows COM interface
    if ($iswin && class_exists("COM")) {
        try {
            $fsobj = new COM('Scripting.FileSystemObject');
            $f = $fsobj->GetFile( realpath($file) );
            $size = $f->Size;
        } catch (Exception $e) {
            $size = null;
        }
        if (ctype_digit($size)) {
            return $size;
        }
    }

    // if all else fails
    return filesize($file);
}

/**
 * Get nice filesize
 * @param int $size
 * @return string
 */
function fm_get_filesize($size)
{
    $size = (float) $size;
    $units = array('B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB');
    $power = ($size > 0) ? floor(log($size, 1024)) : 0;
    $power = ($power > (count($units) - 1)) ? (count($units) - 1) : $power;
    return sprintf('%s %s', round($size / pow(1024, $power), 2), $units[$power]);
}

/**
 * Get total size of directory tree.
 *
 * @param  string $directory Relative or absolute directory name.
 * @return int Total number of bytes.
 */
function fm_get_directorysize($directory) {
    $bytes = 0;
    $directory = realpath($directory);
    if ($directory !== false && $directory != '' && file_exists($directory)){
        foreach(new RecursiveIteratorIterator(new RecursiveDirectoryIterator($directory, FilesystemIterator::SKIP_DOTS)) as $file){
            $bytes += $file->getSize();
        }
    }
    return $bytes;
}

/**
 * Get info about zip archive
 * @param string $path
 * @return array|bool
 */
function fm_get_zif_info($path, $ext) {
    if ($ext == 'zip' && function_exists('zip_open')) {
        $arch = @zip_open($path);
        if ($arch) {
            $filenames = array();
            while ($zip_entry = @zip_read($arch)) {
                $zip_name = @zip_entry_name($zip_entry);
                $zip_folder = substr($zip_name, -1) == '/';
                $filenames[] = array(
                    'name' => $zip_name,
                    'filesize' => @zip_entry_filesize($zip_entry),
                    'compressed_size' => @zip_entry_compressedsize($zip_entry),
                    'folder' => $zip_folder
                    //'compression_method' => zip_entry_compressionmethod($zip_entry),
                );
            }
            @zip_close($arch);
            return $filenames;
        }
    } elseif($ext == 'tar' && class_exists('PharData')) {
        $archive = new PharData($path);
        $filenames = array();
        foreach(new RecursiveIteratorIterator($archive) as $file) {
            $parent_info = $file->getPathInfo();
            $zip_name = str_replace("phar://".$path, '', $file->getPathName());
            $zip_name = substr($zip_name, ($pos = strpos($zip_name, '/')) !== false ? $pos + 1 : 0);
            $zip_folder = $parent_info->getFileName();
            $zip_info = new SplFileInfo($file);
            $filenames[] = array(
                'name' => $zip_name,
                'filesize' => $zip_info->getSize(),
                'compressed_size' => $file->getCompressedSize(),
                'folder' => $zip_folder
            );
        }
        return $filenames;
    }
    return false;
}

/**
 * Encode html entities
 * @param string $text
 * @return string
 */
function fm_enc($text)
{
    return htmlspecialchars($text, ENT_QUOTES, 'UTF-8');
}

/**
 * Prevent XSS attacks
 * @param string $text
 * @return string
 */
function fm_isvalid_filename($text) {
    return (strpbrk($text, '/?%*:|"<>') === FALSE) ? true : false;
}

/**
 * Save message in session
 * @param string $msg
 * @param string $status
 */
function fm_set_msg($msg, $status = 'ok')
{
    $_SESSION[FM_SESSION_ID]['message'] = $msg;
    $_SESSION[FM_SESSION_ID]['status'] = $status;
}

/**
 * Check if string is in UTF-8
 * @param string $string
 * @return int
 */
function fm_is_utf8($string)
{
    return preg_match('//u', $string);
}

/**
 * Convert file name to UTF-8 in Windows
 * @param string $filename
 * @return string
 */
function fm_convert_win($filename)
{
    if (FM_IS_WIN && function_exists('iconv')) {
        $filename = iconv(FM_ICONV_INPUT_ENC, 'UTF-8//IGNORE', $filename);
    }
    return $filename;
}

/**
 * @param $obj
 * @return array
 */
function fm_object_to_array($obj)
{
    if (!is_object($obj) && !is_array($obj)) {
        return $obj;
    }
    if (is_object($obj)) {
        $obj = get_object_vars($obj);
    }
    return array_map('fm_object_to_array', $obj);
}

/**
 * Get CSS classname for file
 * @param string $path
 * @return string
 */
function fm_get_file_icon_class($path)
{
    // get extension
    $ext = strtolower(pathinfo($path, PATHINFO_EXTENSION));

    switch ($ext) {
        case 'ico':
        case 'gif':
        case 'jpg':
        case 'jpeg':
        case 'jpc':
        case 'jp2':
        case 'jpx':
        case 'xbm':
        case 'wbmp':
        case 'png':
        case 'bmp':
        case 'tif':
        case 'tiff':
        case 'webp':
        case 'avif':
        case 'svg':
            $img = 'fa fa-picture-o';
            break;
        case 'passwd':
        case 'ftpquota':
        case 'sql':
        case 'js':
        case 'ts':
        case 'jsx':
        case 'tsx':
        case 'hbs':
        case 'json':
        case 'sh':
        case 'config':
        case 'twig':
        case 'tpl':
        case 'md':
        case 'gitignore':
        case 'c':
        case 'cpp':
        case 'cs':
        case 'py':
        case 'rs':
        case 'map':
        case 'lock':
        case 'dtd':
            $img = 'fa fa-file-code-o';
            break;
        case 'txt':
        case 'ini':
        case 'conf':
        case 'log':
        case 'htaccess':
        case 'yaml':
        case 'yml':
        case 'toml':
        case 'tmp':
        case 'top':
        case 'bot':
        case 'dat':
        case 'bak':
        case 'htpasswd':
        case 'pl':
            $img = 'fa fa-file-text-o';
            break;
        case 'css':
        case 'less':
        case 'sass':
        case 'scss':
            $img = 'fa fa-css3';
            break;
        case 'bz2':
        case 'zip':
        case 'rar':
        case 'gz':
        case 'tar':
        case '7z':
        case 'xz':
            $img = 'fa fa-file-archive-o';
            break;
        case 'php':
        case 'php4':
        case 'php5':
        case 'phps':
        case 'phtml':
            $img = 'fa fa-code';
            break;
        case 'htm':
        case 'html':
        case 'shtml':
        case 'xhtml':
            $img = 'fa fa-html5';
            break;
        case 'xml':
        case 'xsl':
            $img = 'fa fa-file-excel-o';
            break;
        case 'wav':
        case 'mp3':
        case 'mp2':
        case 'm4a':
        case 'aac':
        case 'ogg':
        case 'oga':
        case 'wma':
        case 'mka':
        case 'flac':
        case 'ac3':
        case 'tds':
            $img = 'fa fa-music';
            break;
        case 'm3u':
        case 'm3u8':
        case 'pls':
        case 'cue':
        case 'xspf':
            $img = 'fa fa-headphones';
            break;
        case 'avi':
        case 'mpg':
        case 'mpeg':
        case 'mp4':
        case 'm4v':
        case 'flv':
        case 'f4v':
        case 'ogm':
        case 'ogv':
        case 'mov':
        case 'mkv':
        case '3gp':
        case 'asf':
        case 'wmv':
        case 'webm':
            $img = 'fa fa-file-video-o';
            break;
        case 'eml':
        case 'msg':
            $img = 'fa fa-envelope-o';
            break;
        case 'xls':
        case 'xlsx':
        case 'ods':
            $img = 'fa fa-file-excel-o';
            break;
        case 'csv':
            $img = 'fa fa-file-text-o';
            break;
        case 'bak':
        case 'swp':
            $img = 'fa fa-clipboard';
            break;
        case 'doc':
        case 'docx':
        case 'odt':
            $img = 'fa fa-file-word-o';
            break;
        case 'ppt':
        case 'pptx':
            $img = 'fa fa-file-powerpoint-o';
            break;
        case 'ttf':
        case 'ttc':
        case 'otf':
        case 'woff':
        case 'woff2':
        case 'eot':
        case 'fon':
            $img = 'fa fa-font';
            break;
        case 'pdf':
            $img = 'fa fa-file-pdf-o';
            break;
        case 'psd':
        case 'ai':
        case 'eps':
        case 'fla':
        case 'swf':
            $img = 'fa fa-file-image-o';
            break;
        case 'exe':
        case 'msi':
            $img = 'fa fa-file-o';
            break;
        case 'bat':
            $img = 'fa fa-terminal';
            break;
        default:
            $img = 'fa fa-info-circle';
    }

    return $img;
}

/**
 * Get image files extensions
 * @return array
 */
function fm_get_image_exts()
{
    return array('ico', 'gif', 'jpg', 'jpeg', 'jpc', 'jp2', 'jpx', 'xbm', 'wbmp', 'png', 'bmp', 'tif', 'tiff', 'psd', 'svg', 'webp', 'avif');
}

/**
 * Get video files extensions
 * @return array
 */
function fm_get_video_exts()
{
    return array('avi', 'webm', 'wmv', 'mp4', 'm4v', 'ogm', 'ogv', 'mov', 'mkv');
}

/**
 * Get audio files extensions
 * @return array
 */
function fm_get_audio_exts()
{
    return array('wav', 'mp3', 'ogg', 'm4a');
}

/**
 * Get text file extensions
 * @return array
 */
function fm_get_text_exts()
{
    return array(
        'txt', 'css', 'ini', 'conf', 'log', 'htaccess', 'passwd', 'ftpquota', 'sql', 'js', 'ts', 'jsx', 'tsx', 'mjs', 'json', 'sh', 'config',
        'php', 'php4', 'php5', 'phps', 'phtml', 'htm', 'html', 'shtml', 'xhtml', 'xml', 'xsl', 'm3u', 'm3u8', 'pls', 'cue', 'bash', 'vue',
        'eml', 'msg', 'csv', 'bat', 'twig', 'tpl', 'md', 'gitignore', 'less', 'sass', 'scss', 'c', 'cpp', 'cs', 'py', 'go', 'zsh', 'swift',
        'map', 'lock', 'dtd', 'svg', 'asp', 'aspx', 'asx', 'asmx', 'ashx', 'jsp', 'jspx', 'cgi', 'dockerfile', 'ruby', 'yml', 'yaml', 'toml',
        'vhost', 'scpt', 'applescript', 'csx', 'cshtml', 'c++', 'coffee', 'cfm', 'rb', 'graphql', 'mustache', 'jinja', 'http', 'handlebars',
        'java', 'es', 'es6', 'markdown', 'wiki', 'tmp', 'top', 'bot', 'dat', 'bak', 'htpasswd', 'pl'
    );
}

/**
 * Get mime types of text files
 * @return array
 */
function fm_get_text_mimes()
{
    return array(
        'application/xml',
        'application/javascript',
        'application/x-javascript',
        'image/svg+xml',
        'message/rfc822',
        'application/json',
    );
}

/**
 * Get file names of text files w/o extensions
 * @return array
 */
function fm_get_text_names()
{
    return array(
        'license',
        'readme',
        'authors',
        'contributors',
        'changelog',
    );
}

/**
 * Get online docs viewer supported files extensions
 * @return array
 */
function fm_get_onlineViewer_exts()
{
    return array('doc', 'docx', 'xls', 'xlsx', 'pdf', 'ppt', 'pptx', 'ai', 'psd', 'dxf', 'xps', 'rar', 'odt', 'ods');
}

/**
 * It returns the mime type of a file based on its extension.
 * @param extension The file extension of the file you want to get the mime type for.
 * @return string|string[] The mime type of the file.
 */
function fm_get_file_mimes($extension)
{
    $fileTypes['swf'] = 'application/x-shockwave-flash';
    $fileTypes['pdf'] = 'application/pdf';
    $fileTypes['exe'] = 'application/octet-stream';
    $fileTypes['zip'] = 'application/zip';
    $fileTypes['doc'] = 'application/msword';
    $fileTypes['xls'] = 'application/vnd.ms-excel';
    $fileTypes['ppt'] = 'application/vnd.ms-powerpoint';
    $fileTypes['gif'] = 'image/gif';
    $fileTypes['png'] = 'image/png';
    $fileTypes['jpeg'] = 'image/jpg';
    $fileTypes['jpg'] = 'image/jpg';
    $fileTypes['webp'] = 'image/webp';
    $fileTypes['avif'] = 'image/avif';
    $fileTypes['rar'] = 'application/rar';

    $fileTypes['ra'] = 'audio/x-pn-realaudio';
    $fileTypes['ram'] = 'audio/x-pn-realaudio';
    $fileTypes['ogg'] = 'audio/x-pn-realaudio';

    $fileTypes['wav'] = 'video/x-msvideo';
    $fileTypes['wmv'] = 'video/x-msvideo';
    $fileTypes['avi'] = 'video/x-msvideo';
    $fileTypes['asf'] = 'video/x-msvideo';
    $fileTypes['divx'] = 'video/x-msvideo';

    $fileTypes['mp3'] = 'audio/mpeg';
    $fileTypes['mp4'] = 'audio/mpeg';
    $fileTypes['mpeg'] = 'video/mpeg';
    $fileTypes['mpg'] = 'video/mpeg';
    $fileTypes['mpe'] = 'video/mpeg';
    $fileTypes['mov'] = 'video/quicktime';
    $fileTypes['swf'] = 'video/quicktime';
    $fileTypes['3gp'] = 'video/quicktime';
    $fileTypes['m4a'] = 'video/quicktime';
    $fileTypes['aac'] = 'video/quicktime';
    $fileTypes['m3u'] = 'video/quicktime';

    $fileTypes['php'] = ['application/x-php'];
    $fileTypes['html'] = ['text/html'];
    $fileTypes['txt'] = ['text/plain'];
    //Unknown mime-types should be 'application/octet-stream'
    if(empty($fileTypes[$extension])) {
      $fileTypes[$extension] = ['application/octet-stream'];
    }
    return $fileTypes[$extension];
}

/**
 * This function scans the files and folder recursively, and return matching files
 * @param string $dir
 * @param string $filter
 * @return array|null
 */
 function scan($dir = '', $filter = '') {
    $path = FM_ROOT_PATH.'/'.$dir;
     if($path) {
         $ite = new RecursiveIteratorIterator(new RecursiveDirectoryIterator($path));
         $rii = new RegexIterator($ite, "/(" . $filter . ")/i");

         $files = array();
         foreach ($rii as $file) {
             if (!$file->isDir()) {
                 $fileName = $file->getFilename();
                 $location = str_replace(FM_ROOT_PATH, '', $file->getPath());
                 $files[] = array(
                     "name" => $fileName,
                     "type" => "file",
                     "path" => $location,
                 );
             }
         }
         return $files;
     }
}

/**
* Parameters: downloadFile(File Location, File Name,
* max speed, is streaming
* If streaming - videos will show as videos, images as images
* instead of download prompt
* https://stackoverflow.com/a/13821992/1164642
*/
function fm_download_file($fileLocation, $fileName, $chunkSize  = 1024)
{
    if (connection_status() != 0)
        return (false);
    $extension = pathinfo($fileName, PATHINFO_EXTENSION);

    $contentType = fm_get_file_mimes($extension);

    if(is_array($contentType)) {
        $contentType = implode(' ', $contentType);
    }

    $size = filesize($fileLocation);

    if ($size == 0) {
        fm_set_msg(lng('Zero byte file! Aborting download'), 'error');
        $FM_PATH=FM_PATH; fm_redirect(FM_SELF_URL . '?p=' . urlencode($FM_PATH));

        return (false);
    }

    @ini_set('magic_quotes_runtime', 0);
    $fp = fopen("$fileLocation", "rb");

    if ($fp === false) {
        fm_set_msg(lng('Cannot open file! Aborting download'), 'error');
        $FM_PATH=FM_PATH; fm_redirect(FM_SELF_URL . '?p=' . urlencode($FM_PATH));
        return (false);
    }

    // headers
    header('Content-Description: File Transfer');
    header('Expires: 0');
    header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
    header('Pragma: public');
    header("Content-Transfer-Encoding: binary");
    header("Content-Type: $contentType");

    $contentDisposition = 'attachment';

    if (strstr($_SERVER['HTTP_USER_AGENT'], "MSIE")) {
        $fileName = preg_replace('/\./', '%2e', $fileName, substr_count($fileName, '.') - 1);
        header("Content-Disposition: $contentDisposition;filename=\"$fileName\"");
    } else {
        header("Content-Disposition: $contentDisposition;filename=\"$fileName\"");
    }

    header("Accept-Ranges: bytes");
    $range = 0;

    if (isset($_SERVER['HTTP_RANGE'])) {
        list($a, $range) = explode("=", $_SERVER['HTTP_RANGE']);
        str_replace($range, "-", $range);
        $size2 = $size - 1;
        $new_length = $size - $range;
        header("HTTP/1.1 206 Partial Content");
        header("Content-Length: $new_length");
        header("Content-Range: bytes $range$size2/$size");
    } else {
        $size2 = $size - 1;
        header("Content-Range: bytes 0-$size2/$size");
        header("Content-Length: " . $size);
    }
    $fileLocation = realpath($fileLocation);
    while (ob_get_level()) ob_end_clean();
    readfile($fileLocation);

    fclose($fp);

    return ((connection_status() == 0) and !connection_aborted());
}

/**
 * If the theme is dark, return the text-white and bg-dark classes.
 * @return string the value of the  variable.
 */
function fm_get_theme() {
    $result = '';
    if(FM_THEME == "dark") {
        $result = "text-white bg-dark";
    }
    return $result;
}

/**
 * Class to work with zip files (using ZipArchive)
 */
class FM_Zipper
{
    private $zip;

    public function __construct()
    {
        $this->zip = new ZipArchive();
    }

    /**
     * Create archive with name $filename and files $files (RELATIVE PATHS!)
     * @param string $filename
     * @param array|string $files
     * @return bool
     */
    public function create($filename, $files)
    {
        $res = $this->zip->open($filename, ZipArchive::CREATE);
        if ($res !== true) {
            return false;
        }
        if (is_array($files)) {
            foreach ($files as $f) {
                $f = fm_clean_path($f);
                if (!$this->addFileOrDir($f)) {
                    $this->zip->close();
                    return false;
                }
            }
            $this->zip->close();
            return true;
        } else {
            if ($this->addFileOrDir($files)) {
                $this->zip->close();
                return true;
            }
            return false;
        }
    }

    /**
     * Extract archive $filename to folder $path (RELATIVE OR ABSOLUTE PATHS)
     * @param string $filename
     * @param string $path
     * @return bool
     */
    public function unzip($filename, $path)
    {
        $res = $this->zip->open($filename);
        if ($res !== true) {
            return false;
        }
        if ($this->zip->extractTo($path)) {
            $this->zip->close();
            return true;
        }
        return false;
    }

    /**
     * Add file/folder to archive
     * @param string $filename
     * @return bool
     */
    private function addFileOrDir($filename)
    {
        if (is_file($filename)) {
            return $this->zip->addFile($filename);
        } elseif (is_dir($filename)) {
            return $this->addDir($filename);
        }
        return false;
    }

    /**
     * Add folder recursively
     * @param string $path
     * @return bool
     */
    private function addDir($path)
    {
        if (!$this->zip->addEmptyDir($path)) {
            return false;
        }
        $objects = scandir($path);
        if (is_array($objects)) {
            foreach ($objects as $file) {
                if ($file != '.' && $file != '..') {
                    if (is_dir($path . '/' . $file)) {
                        if (!$this->addDir($path . '/' . $file)) {
                            return false;
                        }
                    } elseif (is_file($path . '/' . $file)) {
                        if (!$this->zip->addFile($path . '/' . $file)) {
                            return false;
                        }
                    }
                }
            }
            return true;
        }
        return false;
    }
}

/**
 * Class to work with Tar files (using PharData)
 */
class FM_Zipper_Tar
{
    private $tar;

    public function __construct()
    {
        $this->tar = null;
    }

    /**
     * Create archive with name $filename and files $files (RELATIVE PATHS!)
     * @param string $filename
     * @param array|string $files
     * @return bool
     */
    public function create($filename, $files)
    {
        $this->tar = new PharData($filename);
        if (is_array($files)) {
            foreach ($files as $f) {
                $f = fm_clean_path($f);
                if (!$this->addFileOrDir($f)) {
                    return false;
                }
            }
            return true;
        } else {
            if ($this->addFileOrDir($files)) {
                return true;
            }
            return false;
        }
    }

    /**
     * Extract archive $filename to folder $path (RELATIVE OR ABSOLUTE PATHS)
     * @param string $filename
     * @param string $path
     * @return bool
     */
    public function unzip($filename, $path)
    {
        $res = $this->tar->open($filename);
        if ($res !== true) {
            return false;
        }
        if ($this->tar->extractTo($path)) {
            return true;
        }
        return false;
    }

    /**
     * Add file/folder to archive
     * @param string $filename
     * @return bool
     */
    private function addFileOrDir($filename)
    {
        if (is_file($filename)) {
            try {
                $this->tar->addFile($filename);
                return true;
            } catch (Exception $e) {
                return false;
            }
        } elseif (is_dir($filename)) {
            return $this->addDir($filename);
        }
        return false;
    }

    /**
     * Add folder recursively
     * @param string $path
     * @return bool
     */
    private function addDir($path)
    {
        $objects = scandir($path);
        if (is_array($objects)) {
            foreach ($objects as $file) {
                if ($file != '.' && $file != '..') {
                    if (is_dir($path . '/' . $file)) {
                        if (!$this->addDir($path . '/' . $file)) {
                            return false;
                        }
                    } elseif (is_file($path . '/' . $file)) {
                        try {
                            $this->tar->addFile($path . '/' . $file);
                        } catch (Exception $e) {
                            return false;
                        }
                    }
                }
            }
            return true;
        }
        return false;
    }
}

/**
 * Save Configuration
 */
 class FM_Config
{
     var $data;

    function __construct()
    {
        global $root_path, $root_url, $CONFIG;
        $fm_url = $root_url.$_SERVER["PHP_SELF"];
        $this->data = array(
            'lang' => 'en',
            'error_reporting' => true,
            'show_hidden' => true
        );
        $data = false;
        if (strlen($CONFIG)) {
            $data = fm_object_to_array(json_decode($CONFIG));
        } else {
            $msg = 'Flix File Manager<br>Error: Cannot load configuration';
            if (substr($fm_url, -1) == '/') {
                $fm_url = rtrim($fm_url, '/');
                $msg .= '<br>';
                $msg .= '<br>Seems like you have a trailing slash on the URL.';
                $msg .= '<br>Try this link: <a href="' . $fm_url . '">' . $fm_url . '</a>';
            }
            die($msg);
        }
        if (is_array($data) && count($data)) $this->data = $data;
        else $this->save();
    }

    function save()
    {
        $fm_file = __FILE__;
        $var_name = '$CONFIG';
        $var_value = var_export(json_encode($this->data), true);
        $config_string = "<?php" . chr(13) . chr(10) . "//Default Configuration".chr(13) . chr(10)."$var_name = $var_value;" . chr(13) . chr(10);
        if (is_writable($fm_file)) {
            $lines = file($fm_file);
            if ($fh = @fopen($fm_file, "w")) {
                @fputs($fh, $config_string, strlen($config_string));
                for ($x = 3; $x < count($lines); $x++) {
                    @fputs($fh, $lines[$x], strlen($lines[$x]));
                }
                @fclose($fh);
            }
        }
    }
}

//--- Templates Functions ---

/**
 * Show nav block
 * @param string $path
 */
function fm_show_nav_path($path)
{
    global $lang, $sticky_navbar, $editFile;
    $isStickyNavBar = $sticky_navbar ? 'fixed-top' : '';
    $getTheme = fm_get_theme();
    $getTheme .= " navbar-light";
    if(FM_THEME == "dark") {
        $getTheme .= " navbar-dark";
    } else {
        $getTheme .= " bg-white";
    }
    ?>
    <nav class="navbar navbar-expand-lg <?php echo $getTheme; ?> mb-4 main-nav <?php echo $isStickyNavBar ?>">
        <a class="navbar-brand"> <?php echo lng('AppTitle') ?> </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">

            <?php
            $path = fm_clean_path($path);
            $root_url = "<a href='?p='><i class='fa fa-home' aria-hidden='true' title='" . FM_ROOT_PATH . "'></i></a>";
            $sep = '<i class="bread-crumb"> / </i>';
            if ($path != '') {
                $exploded = explode('/', $path);
                $count = count($exploded);
                $array = array();
                $parent = '';
                for ($i = 0; $i < $count; $i++) {
                    $parent = trim($parent . '/' . $exploded[$i], '/');
                    $parent_enc = urlencode($parent);
                    $array[] = "<a href='?p={$parent_enc}'>" . fm_enc(fm_convert_win($exploded[$i])) . "</a>";
                }
                $root_url .= $sep . implode($sep, $array);
            }
            echo '<div class="col-xs-6 col-sm-5">' . $root_url . $editFile . '</div>';
            ?>

            <div class="col-xs-6 col-sm-7">
                <ul class="navbar-nav justify-content-end <?php echo fm_get_theme();  ?>">
                    <li class="nav-item mr-2">
                        <div class="input-group input-group-sm mr-1" style="margin-top:4px;">
                            <input type="text" class="form-control" placeholder="<?php echo lng('Filter') ?>" aria-label="<?php echo lng('Search') ?>" aria-describedby="search-addon2" id="search-addon">
                            <div class="input-group-append">
                                <span class="input-group-text brl-0 brr-0" id="search-addon2"><i class="fa fa-search"></i></span>
                            </div>
                            <div class="input-group-append btn-group">
                                <span class="input-group-text dropdown-toggle brl-0" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></span>
                                  <div class="dropdown-menu dropdown-menu-right">
                                    <a class="dropdown-item" href="<?php echo $path2 = $path ? $path : '.'; ?>" id="js-search-modal" data-bs-toggle="modal" data-bs-target="#searchModal"><?php echo lng('Advanced Search') ?></a>
                                  </div>
                            </div>
                        </div>
                    </li>
                    <?php if (!FM_READONLY): ?>
                    <li class="nav-item">
                        <a title="<?php echo lng('Upload') ?>" class="nav-link" href="?p=<?php echo urlencode(FM_PATH) ?>&amp;upload"><i class="fa fa-cloud-upload" aria-hidden="true"></i> <?php echo lng('Upload') ?></a>
                    </li>
                    <li class="nav-item">
                        <a title="<?php echo lng('NewItem') ?>" class="nav-link" href="#createNewItem" data-bs-toggle="modal" data-bs-target="#createNewItem"><i class="fa fa-plus-square"></i> <?php echo lng('NewItem') ?></a>
                    </li>
                    <?php endif; ?>
                    <?php if (FM_USE_AUTH): ?>
                    <li class="nav-item avatar dropdown">
                        <a class="nav-link dropdown-toggle" id="navbarDropdownMenuLink-5" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="fa fa-user-circle"></i> <?php if(isset($_SESSION[FM_SESSION_ID]['logged'])) { echo $_SESSION[FM_SESSION_ID]['logged']; } ?></a>
                        <div class="dropdown-menu text-small shadow <?php echo fm_get_theme(); ?>" aria-labelledby="navbarDropdownMenuLink-5">
                            <?php if (!FM_READONLY): ?>
                            <a title="<?php echo lng('Settings') ?>" class="dropdown-item nav-link" href="?p=<?php echo urlencode(FM_PATH) ?>&amp;settings=1"><i class="fa fa-cog" aria-hidden="true"></i> <?php echo lng('Settings') ?></a>
                            <?php endif ?>
                            <a title="<?php echo lng('Help') ?>" class="dropdown-item nav-link" href="?p=<?php echo urlencode(FM_PATH) ?>&amp;help=2"><i class="fa fa-exclamation-circle" aria-hidden="true"></i> <?php echo lng('Help') ?></a>
                            <a title="<?php echo lng('Logout') ?>" class="dropdown-item nav-link" href="?logout=1"><i class="fa fa-sign-out" aria-hidden="true"></i> <?php echo lng('Logout') ?></a>
                        </div>
                    </li>
                    <?php else: ?>
                        <?php if (!FM_READONLY): ?>
                            <li class="nav-item">
                                <a title="<?php echo lng('Settings') ?>" class="dropdown-item nav-link" href="?p=<?php echo urlencode(FM_PATH) ?>&amp;settings=1"><i class="fa fa-cog" aria-hidden="true"></i> <?php echo lng('Settings') ?></a>
                            </li>
                        <?php endif; ?>
                    <?php endif; ?>
                </ul>
            </div>
        </div>
    </nav>
    <?php
}

/**
 * Show alert message from session
 */
function fm_show_message()
{
    if (isset($_SESSION[FM_SESSION_ID]['message'])) {
        $class = isset($_SESSION[FM_SESSION_ID]['status']) ? $_SESSION[FM_SESSION_ID]['status'] : 'ok';
        echo '<p class="message ' . $class . '">' . $_SESSION[FM_SESSION_ID]['message'] . '</p>';
        unset($_SESSION[FM_SESSION_ID]['message']);
        unset($_SESSION[FM_SESSION_ID]['status']);
    }
}

/**
 * Show page header in Login Form
 */
function fm_show_header_login()
{
$sprites_ver = '20160315';
header("Content-Type: text/html; charset=utf-8");
header("Expires: Sat, 26 Jul 1997 05:00:00 GMT");
header("Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0");
header("Pragma: no-cache");

global $lang, $root_url, $favicon_path;
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Web based File Manager in PHP, Manage your files efficiently and easily with Flix File Manager">
    <meta name="author" content="CCP Programmers">
    <meta name="robots" content="noindex, nofollow">
    <meta name="googlebot" content="noindex">
    <?php if($favicon_path) { echo '<link rel="icon" href="'.fm_enc($favicon_path).'" type="image/png">'; } ?>
    <title><?php echo fm_enc(APP_TITLE) ?></title>
    <?php print_external('pre-jsdelivr'); ?>
    <?php print_external('css-bootstrap'); ?>
    <style>
        body.fm-login-page{ background-color:#f7f9fb;font-size:14px;background-color:#f7f9fb;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 304 304' width='304' height='304'%3E%3Cpath fill='%23e2e9f1' fill-opacity='0.4' d='M44.1 224a5 5 0 1 1 0 2H0v-2h44.1zm160 48a5 5 0 1 1 0 2H82v-2h122.1zm57.8-46a5 5 0 1 1 0-2H304v2h-42.1zm0 16a5 5 0 1 1 0-2H304v2h-42.1zm6.2-114a5 5 0 1 1 0 2h-86.2a5 5 0 1 1 0-2h86.2zm-256-48a5 5 0 1 1 0 2H0v-2h12.1zm185.8 34a5 5 0 1 1 0-2h86.2a5 5 0 1 1 0 2h-86.2zM258 12.1a5 5 0 1 1-2 0V0h2v12.1zm-64 208a5 5 0 1 1-2 0v-54.2a5 5 0 1 1 2 0v54.2zm48-198.2V80h62v2h-64V21.9a5 5 0 1 1 2 0zm16 16V64h46v2h-48V37.9a5 5 0 1 1 2 0zm-128 96V208h16v12.1a5 5 0 1 1-2 0V210h-16v-76.1a5 5 0 1 1 2 0zm-5.9-21.9a5 5 0 1 1 0 2H114v48H85.9a5 5 0 1 1 0-2H112v-48h12.1zm-6.2 130a5 5 0 1 1 0-2H176v-74.1a5 5 0 1 1 2 0V242h-60.1zm-16-64a5 5 0 1 1 0-2H114v48h10.1a5 5 0 1 1 0 2H112v-48h-10.1zM66 284.1a5 5 0 1 1-2 0V274H50v30h-2v-32h18v12.1zM236.1 176a5 5 0 1 1 0 2H226v94h48v32h-2v-30h-48v-98h12.1zm25.8-30a5 5 0 1 1 0-2H274v44.1a5 5 0 1 1-2 0V146h-10.1zm-64 96a5 5 0 1 1 0-2H208v-80h16v-14h-42.1a5 5 0 1 1 0-2H226v18h-16v80h-12.1zm86.2-210a5 5 0 1 1 0 2H272V0h2v32h10.1zM98 101.9V146H53.9a5 5 0 1 1 0-2H96v-42.1a5 5 0 1 1 2 0zM53.9 34a5 5 0 1 1 0-2H80V0h2v34H53.9zm60.1 3.9V66H82v64H69.9a5 5 0 1 1 0-2H80V64h32V37.9a5 5 0 1 1 2 0zM101.9 82a5 5 0 1 1 0-2H128V37.9a5 5 0 1 1 2 0V82h-28.1zm16-64a5 5 0 1 1 0-2H146v44.1a5 5 0 1 1-2 0V18h-26.1zm102.2 270a5 5 0 1 1 0 2H98v14h-2v-16h124.1zM242 149.9V160h16v34h-16v62h48v48h-2v-46h-48v-66h16v-30h-16v-12.1a5 5 0 1 1 2 0zM53.9 18a5 5 0 1 1 0-2H64V2H48V0h18v18H53.9zm112 32a5 5 0 1 1 0-2H192V0h50v2h-48v48h-28.1zm-48-48a5 5 0 0 1-9.8-2h2.07a3 3 0 1 0 5.66 0H178v34h-18V21.9a5 5 0 1 1 2 0V32h14V2h-58.1zm0 96a5 5 0 1 1 0-2H137l32-32h39V21.9a5 5 0 1 1 2 0V66h-40.17l-32 32H117.9zm28.1 90.1a5 5 0 1 1-2 0v-76.51L175.59 80H224V21.9a5 5 0 1 1 2 0V82h-49.59L146 112.41v75.69zm16 32a5 5 0 1 1-2 0v-99.51L184.59 96H300.1a5 5 0 0 1 3.9-3.9v2.07a3 3 0 0 0 0 5.66v2.07a5 5 0 0 1-3.9-3.9H185.41L162 121.41v98.69zm-144-64a5 5 0 1 1-2 0v-3.51l48-48V48h32V0h2v50H66v55.41l-48 48v2.69zM50 53.9v43.51l-48 48V208h26.1a5 5 0 1 1 0 2H0v-65.41l48-48V53.9a5 5 0 1 1 2 0zm-16 16V89.41l-34 34v-2.82l32-32V69.9a5 5 0 1 1 2 0zM12.1 32a5 5 0 1 1 0 2H9.41L0 43.41V40.6L8.59 32h3.51zm265.8 18a5 5 0 1 1 0-2h18.69l7.41-7.41v2.82L297.41 50H277.9zm-16 160a5 5 0 1 1 0-2H288v-71.41l16-16v2.82l-14 14V210h-28.1zm-208 32a5 5 0 1 1 0-2H64v-22.59L40.59 194H21.9a5 5 0 1 1 0-2H41.41L66 216.59V242H53.9zm150.2 14a5 5 0 1 1 0 2H96v-56.6L56.6 162H37.9a5 5 0 1 1 0-2h19.5L98 200.6V256h106.1zm-150.2 2a5 5 0 1 1 0-2H80v-46.59L48.59 178H21.9a5 5 0 1 1 0-2H49.41L82 208.59V258H53.9zM34 39.8v1.61L9.41 66H0v-2h8.59L32 40.59V0h2v39.8zM2 300.1a5 5 0 0 1 3.9 3.9H3.83A3 3 0 0 0 0 302.17V256h18v48h-2v-46H2v42.1zM34 241v63h-2v-62H0v-2h34v1zM17 18H0v-2h16V0h2v18h-1zm273-2h14v2h-16V0h2v16zm-32 273v15h-2v-14h-14v14h-2v-16h18v1zM0 92.1A5.02 5.02 0 0 1 6 97a5 5 0 0 1-6 4.9v-2.07a3 3 0 1 0 0-5.66V92.1zM80 272h2v32h-2v-32zm37.9 32h-2.07a3 3 0 0 0-5.66 0h-2.07a5 5 0 0 1 9.8 0zM5.9 0A5.02 5.02 0 0 1 0 5.9V3.83A3 3 0 0 0 3.83 0H5.9zm294.2 0h2.07A3 3 0 0 0 304 3.83V5.9a5 5 0 0 1-3.9-5.9zm3.9 300.1v2.07a3 3 0 0 0-1.83 1.83h-2.07a5 5 0 0 1 3.9-3.9zM97 100a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-48 32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 48a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-64a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 96a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-144a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-96 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm96 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-64a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-32 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM49 36a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-32 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM33 68a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-48a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 240a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-64a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm80-176a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 48a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm112 176a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM17 180a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM17 84a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 64a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6z'%3E%3C/path%3E%3C/svg%3E");}
        .fm-login-page .brand{ width:121px;overflow:hidden;margin:0 auto;position:relative;z-index:1}
        .fm-login-page .brand img{ width:100%}
        .fm-login-page .card-wrapper{ width:360px;margin-top:10%;margin-left:auto;margin-right:auto;}
        .fm-login-page .card{ border-color:transparent;box-shadow:0 4px 8px rgba(0,0,0,.05)}
        .fm-login-page .card-title{ margin-bottom:1.5rem;font-size:24px;font-weight:400;}
        .fm-login-page .form-control{ border-width:2.3px}
        .fm-login-page .form-group label{ width:100%}
        .fm-login-page .btn.btn-block{ padding:12px 10px}
        .fm-login-page .footer{ margin:40px 0;color:#888;text-align:center}
        @media screen and (max-width:425px){
            .fm-login-page .card-wrapper{ width:90%;margin:0 auto;margin-top:10%;}
        }
        @media screen and (max-width:320px){
            .fm-login-page .card.fat{ padding:0}
            .fm-login-page .card.fat .card-body{ padding:15px}
        }
        .message{ padding:4px 7px;border:1px solid #ddd;background-color:#fff}
        .message.ok{ border-color:green;color:green}
        .message.error{ border-color:red;color:red}
        .message.alert{ border-color:orange;color:orange}
        body.fm-login-page.theme-dark {background-color: #2f2a2a;}
        .theme-dark svg g, .theme-dark svg path {fill: #ffffff; }
    </style>
</head>
<body class="fm-login-page <?php echo (FM_THEME == "dark") ? 'theme-dark' : ''; ?>">
<div id="wrapper" class="container-fluid">

    <?php
    }

    /**
     * Show page footer in Login Form
     */
    function fm_show_footer_login()
    {
    ?>
</div>
<?php print_external('js-jquery'); ?>
<?php print_external('js-bootstrap'); ?>
</body>
</html>
<?php
}

/**
 * Show Header after login
 */
function fm_show_header()
{
$sprites_ver = '20160315';
header("Content-Type: text/html; charset=utf-8");
header("Expires: Sat, 26 Jul 1997 05:00:00 GMT");
header("Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0");
header("Pragma: no-cache");

global $lang, $root_url, $sticky_navbar, $favicon_path;
$isStickyNavBar = $sticky_navbar ? 'navbar-fixed' : 'navbar-normal';
?>
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Web based File Manager in PHP, Manage your files efficiently and easily with Flix File Manager">
    <meta name="author" content="CCP Programmers">
    <meta name="robots" content="noindex, nofollow">
    <meta name="googlebot" content="noindex">
    <?php if($favicon_path) { echo '<link rel="icon" href="'.fm_enc($favicon_path).'" type="image/png">'; } ?>
    <title><?php echo fm_enc(APP_TITLE) ?></title>
    <?php print_external('pre-jsdelivr'); ?>
    <?php print_external('pre-cloudflare'); ?>
    <?php print_external('css-bootstrap'); ?>
    <?php print_external('css-font-awesome'); ?>
    <?php if (FM_USE_HIGHLIGHTJS && isset($_GET['view'])): ?>
    <?php print_external('css-highlightjs'); ?>
    <?php endif; ?>
    <script type="text/javascript">window.csrf = '<?php echo $_SESSION['token']; ?>';</script>
    <style>
        html { -moz-osx-font-smoothing: grayscale; -webkit-font-smoothing: antialiased; text-rendering: optimizeLegibility; height: 100%; scroll-behavior: smooth;}
        *,*::before,*::after { box-sizing: border-box;}
        body { font-size:15px; color:#222;background:#F7F7F7; }
        body.navbar-fixed { margin-top:55px; }
        a, a:hover, a:visited, a:focus { text-decoration:none !important; }
        .filename, td, th { white-space:nowrap  }
        .navbar-brand { font-weight:bold; }
        .nav-item.avatar a { cursor:pointer;text-transform:capitalize; }
        .nav-item.avatar a > i { font-size:15px; }
        .nav-item.avatar .dropdown-menu a { font-size:13px; }
        #search-addon { font-size:12px;border-right-width:0; }
        .brl-0 { background:transparent;border-left:0; border-top-left-radius: 0; border-bottom-left-radius: 0; }
        .brr-0 { border-top-right-radius: 0; border-bottom-right-radius: 0; }
        .bread-crumb { color:#cccccc;font-style:normal; }
        #main-table { transition: transform .25s cubic-bezier(0.4, 0.5, 0, 1),width 0s .25s;}
        #main-table .filename a { color:#222222; }
        .table td, .table th { vertical-align:middle !important; }
        .table .custom-checkbox-td .custom-control.custom-checkbox, .table .custom-checkbox-header .custom-control.custom-checkbox { min-width:18px; display: flex;align-items: center; justify-content: center; }
        .table-sm td, .table-sm th { padding:.4rem; }
        .table-bordered td, .table-bordered th { border:1px solid #f1f1f1; }
        .hidden { display:none  }
        pre.with-hljs { padding:0; overflow: hidden;  }
        pre.with-hljs code { margin:0;border:0;overflow:scroll;  }
        code.maxheight, pre.maxheight { max-height:512px  }
        .fa.fa-caret-right { font-size:1.2em;margin:0 4px;vertical-align:middle;color:#ececec  }
        .fa.fa-home { font-size:1.3em;vertical-align:bottom  }
        .path { margin-bottom:10px  }
        form.dropzone { min-height:200px;border:2px dashed #007bff;line-height:6rem; }
        .right { text-align:right  }
        .center, .close, .login-form, .preview-img-container { text-align:center  }
        .message { padding:4px 7px;border:1px solid #ddd;background-color:#fff  }
        .message.ok { border-color:green;color:green  }
        .message.error { border-color:red;color:red  }
        .message.alert { border-color:orange;color:orange  }
        .preview-img { max-width:100%;max-height:80vh;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAAKklEQVR42mL5//8/Azbw+PFjrOJMDCSCUQ3EABZc4S0rKzsaSvTTABBgAMyfCMsY4B9iAAAAAElFTkSuQmCC) }
        .inline-actions > a > i { font-size:1em;margin-left:5px;background:#3785c1;color:#fff;padding:3px 4px;border-radius:3px; }
        .preview-video { position:relative;max-width:100%;height:0;padding-bottom:62.5%;margin-bottom:10px  }
        .preview-video video { position:absolute;width:100%;height:100%;left:0;top:0;background:#000  }
        .compact-table { border:0;width:auto  }
        .compact-table td, .compact-table th { width:100px;border:0;text-align:center  }
        .compact-table tr:hover td { background-color:#fff  }
        .filename { max-width:420px;overflow:hidden;text-overflow:ellipsis  }
        .break-word { word-wrap:break-word;margin-left:30px  }
        .break-word.float-left a { color:#7d7d7d  }
        .break-word + .float-right { padding-right:30px;position:relative  }
        .break-word + .float-right > a { color:#7d7d7d;font-size:1.2em;margin-right:4px  }
        #editor { position:absolute;right:15px;top:100px;bottom:15px;left:15px  }
        @media (max-width:481px) {
            #editor { top:150px; }
        }
        #normal-editor { border-radius:3px;border-width:2px;padding:10px;outline:none; }
        .btn-2 { padding:4px 10px;font-size:small; }
        li.file:before,li.folder:before { font:normal normal normal 14px/1 FontAwesome;content:"\f016";margin-right:5px }
        li.folder:before { content:"\f114" }
        i.fa.fa-folder-o { color:#0157b3 }
        i.fa.fa-picture-o { color:#26b99a }
        i.fa.fa-file-archive-o { color:#da7d7d }
        .btn-2 i.fa.fa-file-archive-o { color:inherit }
        i.fa.fa-css3 { color:#f36fa0 }
        i.fa.fa-file-code-o { color:#007bff }
        i.fa.fa-code { color:#cc4b4c }
        i.fa.fa-file-text-o { color:#0096e6 }
        i.fa.fa-html5 { color:#d75e72 }
        i.fa.fa-file-excel-o { color:#09c55d }
        i.fa.fa-file-powerpoint-o { color:#f6712e }
        i.go-back { font-size:1.2em;color:#007bff; }
        .main-nav { padding:0.2rem 1rem;box-shadow:0 4px 5px 0 rgba(0, 0, 0, .14), 0 1px 10px 0 rgba(0, 0, 0, .12), 0 2px 4px -1px rgba(0, 0, 0, .2)  }
        .dataTables_filter { display:none; }
        table.dataTable thead .sorting { cursor:pointer;background-repeat:no-repeat;background-position:center right;background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAQAAADYWf5HAAAAkElEQVQoz7XQMQ5AQBCF4dWQSJxC5wwax1Cq1e7BAdxD5SL+Tq/QCM1oNiJidwox0355mXnG/DrEtIQ6azioNZQxI0ykPhTQIwhCR+BmBYtlK7kLJYwWCcJA9M4qdrZrd8pPjZWPtOqdRQy320YSV17OatFC4euts6z39GYMKRPCTKY9UnPQ6P+GtMRfGtPnBCiqhAeJPmkqAAAAAElFTkSuQmCC'); }
        table.dataTable thead .sorting_asc { cursor:pointer;background-repeat:no-repeat;background-position:center right;background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAAZ0lEQVQ4y2NgGLKgquEuFxBPAGI2ahhWCsS/gDibUoO0gPgxEP8H4ttArEyuQYxAPBdqEAxPBImTY5gjEL9DM+wTENuQahAvEO9DMwiGdwAxOymGJQLxTyD+jgWDxCMZRsEoGAVoAADeemwtPcZI2wAAAABJRU5ErkJggg=='); }
        table.dataTable thead .sorting_desc { cursor:pointer;background-repeat:no-repeat;background-position:center right;background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAAZUlEQVQ4y2NgGAWjYBSggaqGu5FA/BOIv2PBIPFEUgxjB+IdQPwfC94HxLykus4GiD+hGfQOiB3J8SojEE9EM2wuSJzcsFMG4ttQgx4DsRalkZENxL+AuJQaMcsGxBOAmGvopk8AVz1sLZgg0bsAAAAASUVORK5CYII='); }
        table.dataTable thead tr:first-child th.custom-checkbox-header:first-child { background-image:none; }
        .footer-action li { margin-bottom:10px; }
        .app-v-title { font-size:24px;font-weight:300;letter-spacing:-.5px;text-transform:uppercase; }
        hr.custom-hr { border-top:1px dashed #8c8b8b;border-bottom:1px dashed #fff; }
        #snackbar { visibility:hidden;min-width:250px;margin-left:-125px;background-color:#333;color:#fff;text-align:center;border-radius:2px;padding:16px;position:fixed;z-index:1;left:50%;bottom:30px;font-size:17px; }
        #snackbar.show { visibility:visible;-webkit-animation:fadein 0.5s, fadeout 0.5s 2.5s;animation:fadein 0.5s, fadeout 0.5s 2.5s; }
        @-webkit-keyframes fadein { from { bottom:0;opacity:0; }
        to { bottom:30px;opacity:1; }
        }
        @keyframes fadein { from { bottom:0;opacity:0; }
        to { bottom:30px;opacity:1; }
        }
        @-webkit-keyframes fadeout { from { bottom:30px;opacity:1; }
        to { bottom:0;opacity:0; }
        }
        @keyframes fadeout { from { bottom:30px;opacity:1; }
        to { bottom:0;opacity:0; }
        }
        #main-table span.badge { border-bottom:2px solid #f8f9fa }
        #main-table span.badge:nth-child(1) { border-color:#df4227 }
        #main-table span.badge:nth-child(2) { border-color:#f8b600 }
        #main-table span.badge:nth-child(3) { border-color:#00bd60 }
        #main-table span.badge:nth-child(4) { border-color:#4581ff }
        #main-table span.badge:nth-child(5) { border-color:#ac68fc }
        #main-table span.badge:nth-child(6) { border-color:#45c3d2 }
        @media only screen and (min-device-width:768px) and (max-device-width:1024px) and (orientation:landscape) and (-webkit-min-device-pixel-ratio:2) { .navbar-collapse .col-xs-6 { padding:0; }
        }
        .btn.active.focus,.btn.active:focus,.btn.focus,.btn.focus:active,.btn:active:focus,.btn:focus { outline:0!important;outline-offset:0!important;background-image:none!important;-webkit-box-shadow:none!important;box-shadow:none!important }
        .lds-facebook { display:none;position:relative;width:64px;height:64px }
        .lds-facebook div,.lds-facebook.show-me { display:inline-block }
        .lds-facebook div { position:absolute;left:6px;width:13px;background:#007bff;animation:lds-facebook 1.2s cubic-bezier(0,.5,.5,1) infinite }
        .lds-facebook div:nth-child(1) { left:6px;animation-delay:-.24s }
        .lds-facebook div:nth-child(2) { left:26px;animation-delay:-.12s }
        .lds-facebook div:nth-child(3) { left:45px;animation-delay:0s }
        @keyframes lds-facebook { 0% { top:6px;height:51px }
        100%,50% { top:19px;height:26px }
        }
        ul#search-wrapper { padding-left: 0;border: 1px solid #ecececcc; } ul#search-wrapper li { list-style: none; padding: 5px;border-bottom: 1px solid #ecececcc; }
        ul#search-wrapper li:nth-child(odd){ background: #f9f9f9cc;}
        .c-preview-img { max-width: 300px; }
        .border-radius-0 { border-radius: 0; }
        .float-right { float: right; }
        .table-hover>tbody>tr:hover>td:first-child { border-left: 1px solid #1b77fd; }
        #main-table tr.even { background-color: #F8F9Fa; }
        .filename>a>i {margin-right: 3px;}
    </style>
    <?php
    if (FM_THEME == "dark"): ?>
        <style>
            :root {
                --bs-bg-opacity: 1;
                --bg-color: #f3daa6;
                --bs-dark-rgb: 28, 36, 41 !important;
                --bs-bg-opacity: 1;
            }
            .table-dark { --bs-table-bg: 28, 36, 41 !important; }
            .btn-primary { --bs-btn-bg: #26566c; --bs-btn-border-color: #26566c; }
            body.theme-dark { background-image: linear-gradient(90deg, #1c2429, #263238); color: #CFD8DC; }
            .list-group .list-group-item { background: #343a40; }
            .theme-dark .navbar-nav i, .navbar-nav .dropdown-toggle, .break-word { color: #CFD8DC; }
            a, a:hover, a:visited, a:active, #main-table .filename a, i.fa.fa-folder-o, i.go-back { color: var(--bg-color); }
            ul#search-wrapper li:nth-child(odd) { background: #212a2f; }
            .theme-dark .btn-outline-primary { color: #b8e59c; border-color: #b8e59c; }
            .theme-dark .btn-outline-primary:hover, .theme-dark .btn-outline-primary:active { background-color: #2d4121;}
            .theme-dark input.form-control { background-color: #101518; color: #CFD8DC; }
            .theme-dark .dropzone { background: transparent; }
            .theme-dark .inline-actions > a > i { background: #79755e; }
            .theme-dark .text-white { color: #CFD8DC !important; }
            .theme-dark .table-bordered td, .table-bordered th { border-color: #343434; }
            .theme-dark .table-bordered td .custom-control-input, .theme-dark .table-bordered th .custom-control-input { opacity: 0.678; }
            .message { background-color: #212529; }
            .compact-table tr:hover td { background-color: #3d3d3d; }
            #main-table tr.even { background-color: #21292f; }
            form.dropzone { border-color: #79755e; }
        </style>
    <?php endif; ?>
</head>
<body class="<?php echo (FM_THEME == "dark") ? 'theme-dark' : ''; ?> <?php echo $isStickyNavBar; ?>">
<div id="wrapper" class="container-fluid">
    <!-- New Item creation -->
    <div class="modal fade" id="createNewItem" tabindex="-1" role="dialog" data-bs-backdrop="static" data-bs-keyboard="false" aria-labelledby="newItemModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <form class="modal-content <?php echo fm_get_theme(); ?>" method="post">
                <div class="modal-header">
                    <h5 class="modal-title" id="newItemModalLabel"><i class="fa fa-plus-square fa-fw"></i><?php echo lng('CreateNewItem') ?></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p><label for="newfile"><?php echo lng('ItemType') ?> </label></p>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="newfile" id="customRadioInline1" name="newfile" value="file">
                      <label class="form-check-label" for="customRadioInline1"><?php echo lng('File') ?></label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="newfile" id="customRadioInline2" value="folder" checked>
                      <label class="form-check-label" for="customRadioInline2"><?php echo lng('Folder') ?></label>
                    </div>

                    <p class="mt-3"><label for="newfilename"><?php echo lng('ItemName') ?> </label></p>
                    <input type="text" name="newfilename" id="newfilename" value="" class="form-control" placeholder="<?php echo lng('Enter here...') ?>" required>
                </div>
                <div class="modal-footer">
                    <input type="hidden" name="token" value="<?php echo $_SESSION['token']; ?>">
                    <button type="button" class="btn btn-outline-primary" data-bs-dismiss="modal"><i class="fa fa-times-circle"></i> <?php echo lng('Cancel') ?></button>
                    <button type="submit" class="btn btn-success"><i class="fa fa-check-circle"></i> <?php echo lng('CreateNow') ?></button>
                </div>
            </form>
        </div>
    </div>

    <!-- Advance Search Modal -->
    <div class="modal fade" id="searchModal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content <?php echo fm_get_theme(); ?>">
          <div class="modal-header">
            <h5 class="modal-title col-10" id="searchModalLabel">
                <div class="input-group mb-3">
                  <input type="text" class="form-control" placeholder="<?php echo lng('Search') ?> <?php echo lng('a files') ?>" aria-label="<?php echo lng('Search') ?>" aria-describedby="search-addon3" id="advanced-search" autofocus required>
                  <span class="input-group-text" id="search-addon3"><i class="fa fa-search"></i></span>
                </div>
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form action="" method="post">
                <div class="lds-facebook"><div></div><div></div><div></div></div>
                <ul id="search-wrapper">
                    <p class="m-2"><?php echo lng('Search file in folder and subfolders...') ?></p>
                </ul>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!--Rename Modal -->
    <div class="modal modal-alert" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" role="dialog" id="renameDailog">
      <div class="modal-dialog" role="document">
        <form class="modal-content rounded-3 shadow <?php echo fm_get_theme(); ?>" method="post" autocomplete="off">
          <div class="modal-body p-4 text-center">
            <h5 class="mb-3"><?php echo lng('Are you sure want to rename?') ?></h5>
            <p class="mb-1">
                <input type="text" name="rename_to" id="js-rename-to" class="form-control" placeholder="<?php echo lng('Enter new file name') ?>" required>
                <input type="hidden" name="token" value="<?php echo $_SESSION['token']; ?>">
                <input type="hidden" name="rename_from" id="js-rename-from">
            </p>
          </div>
          <div class="modal-footer flex-nowrap p-0">
            <button type="button" class="btn btn-lg btn-link fs-6 text-decoration-none col-6 m-0 rounded-0 border-end" data-bs-dismiss="modal"><?php echo lng('Cancel') ?></button>
            <button type="submit" class="btn btn-lg btn-link fs-6 text-decoration-none col-6 m-0 rounded-0"><strong><?php echo lng('Okay') ?></strong></button>
          </div>
        </form>
      </div>
    </div>

    <!-- Confirm Modal -->
    <script type="text/html" id="js-tpl-confirm">
        <div class="modal modal-alert confirmDailog" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" role="dialog" id="confirmDailog-<%this.id%>">
          <div class="modal-dialog" role="document">
            <form class="modal-content rounded-3 shadow <?php echo fm_get_theme(); ?>" method="post" autocomplete="off" action="<%this.action%>">
              <div class="modal-body p-4 text-center">
                <h5 class="mb-2"><?php echo lng('Are you sure want to') ?> <%this.title%> ?</h5>
                <p class="mb-1"><%this.content%></p>
              </div>
              <div class="modal-footer flex-nowrap p-0">
                <button type="button" class="btn btn-lg btn-link fs-6 text-decoration-none col-6 m-0 rounded-0 border-end" data-bs-dismiss="modal"><?php echo lng('Cancel') ?></button>
                <input type="hidden" name="token" value="<?php echo $_SESSION['token']; ?>">
                <button type="submit" class="btn btn-lg btn-link fs-6 text-decoration-none col-6 m-0 rounded-0" data-bs-dismiss="modal"><strong><?php echo lng('Okay') ?></strong></button>
              </div>
            </form>
          </div>
        </div>
    </script>

    <?php
    }

    /**
     * Show page footer after login
     */
    function fm_show_footer()
    {
    ?>
</div>
<?php print_external('js-jquery'); ?>
<?php print_external('js-bootstrap'); ?>
<?php print_external('js-jquery-datatables'); ?>
<?php if (FM_USE_HIGHLIGHTJS && isset($_GET['view'])): ?>
    <?php print_external('js-highlightjs'); ?>
    <script>hljs.highlightAll(); var isHighlightingEnabled = true;</script>
<?php endif; ?>
<script>
    function template(html,options){
        var re=/<\%([^\%>]+)?\%>/g,reExp=/(^( )?(if|for|else|switch|case|break|{|}))(.*)?/g,code='var r=[];\n',cursor=0,match;var add=function(line,js){js?(code+=line.match(reExp)?line+'\n':'r.push('+line+');\n'):(code+=line!=''?'r.push("'+line.replace(/"/g,'\\"')+'");\n':'');return add}
        while(match=re.exec(html)){add(html.slice(cursor,match.index))(match[1],!0);cursor=match.index+match[0].length}
        add(html.substr(cursor,html.length-cursor));code+='return r.join("");';return new Function(code.replace(/[\r\t\n]/g,'')).apply(options)
    }
    function rename(e, t) { if(t) { $("#js-rename-from").val(t);$("#js-rename-to").val(t); $("#renameDailog").modal('show'); } }
    function change_checkboxes(e, t) { for (var n = e.length - 1; n >= 0; n--) e[n].checked = "boolean" == typeof t ? t : !e[n].checked }
    function get_checkboxes() { for (var e = document.getElementsByName("file[]"), t = [], n = e.length - 1; n >= 0; n--) (e[n].type = "checkbox") && t.push(e[n]); return t }
    function select_all() { change_checkboxes(get_checkboxes(), !0) }
    function unselect_all() { change_checkboxes(get_checkboxes(), !1) }
    function invert_all() { change_checkboxes(get_checkboxes()) }
    function checkbox_toggle() { var e = get_checkboxes(); e.push(this), change_checkboxes(e) }
    function backup(e, t) { // Create file backup with .bck
        var n = new XMLHttpRequest,
            a = "path=" + e + "&file=" + t + "&token="+ window.csrf +"&type=backup&ajax=true";
        return n.open("POST", "", !0), n.setRequestHeader("Content-type", "application/x-www-form-urlencoded"), n.onreadystatechange = function () {
            4 == n.readyState && 200 == n.status && toast(n.responseText)
        }, n.send(a), !1
    }
    // Toast message
    function toast(txt) { var x = document.getElementById("snackbar");x.innerHTML=txt;x.className = "show";setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000); }
    // Save file
    function edit_save(e, t) {
        var n = "ace" == t ? editor.getSession().getValue() : document.getElementById("normal-editor").value;
        if (typeof n !== 'undefined' && n !== null) {
            if (true) {
                var data = {ajax: true, content: n, type: 'save', token: window.csrf};

                $.ajax({
                    type: "POST",
                    url: window.location,
                    data: JSON.stringify(data),
                    contentType: "application/json; charset=utf-8",
                    success: function(mes){toast("Saved Successfully"); window.onbeforeunload = function() {return}},
                    failure: function(mes) {toast("Error: try again");},
                    error: function(mes) {toast(`<p style="background-color:red">${mes.responseText}</p>`);}
                });
            } else {
                var a = document.createElement("form");
                a.setAttribute("method", "POST"), a.setAttribute("action", "");
                var o = document.createElement("textarea");
                o.setAttribute("type", "textarea"), o.setAttribute("name", "savedata");
                let cx = document.createElement("input"); cx.setAttribute("type", "hidden");cx.setAttribute("name", "token");cx.setAttribute("value", window.csrf);
                var c = document.createTextNode(n);
                o.appendChild(c), a.appendChild(o), a.appendChild(cx), document.body.appendChild(a), a.submit()
            }
        }
    }
    function show_new_pwd() { $(".js-new-pwd").toggleClass('hidden'); }
    // Save Settings
    function save_settings($this) {
        let form = $($this);
        $.ajax({
            type: form.attr('method'), url: form.attr('action'), data: form.serialize()+"&token="+ window.csrf +"&ajax="+true,
            success: function (data) {if(data) { window.location.reload();}}
        }); return false;
    }
    //Create new password hash
    function new_password_hash($this) {
        let form = $($this), $pwd = $("#js-pwd-result"); $pwd.val('');
        $.ajax({
            type: form.attr('method'), url: form.attr('action'), data: form.serialize()+"&token="+ window.csrf +"&ajax="+true,
            success: function (data) { if(data) { $pwd.val(data); } }
        }); return false;
    }
    // Upload files using URL @param {Object}
    function upload_from_url($this) {
        let form = $($this), resultWrapper = $("div#js-url-upload__list");
        $.ajax({
            type: form.attr('method'), url: form.attr('action'), data: form.serialize()+"&token="+ window.csrf +"&ajax="+true,
            beforeSend: function() { form.find("input[name=uploadurl]").attr("disabled","disabled"); form.find("button").hide(); form.find(".lds-facebook").addClass('show-me'); },
            success: function (data) {
                if(data) {
                    data = JSON.parse(data);
                    if(data.done) {
                        resultWrapper.append('<div class="alert alert-success row">Uploaded Successful: '+data.done.name+'</div>'); form.find("input[name=uploadurl]").val('');
                    } else if(data['fail']) { resultWrapper.append('<div class="alert alert-danger row">Error: '+data.fail.message+'</div>'); }
                    form.find("input[name=uploadurl]").removeAttr("disabled");form.find("button").show();form.find(".lds-facebook").removeClass('show-me');
                }
            },
            error: function(xhr) {
                form.find("input[name=uploadurl]").removeAttr("disabled");form.find("button").show();form.find(".lds-facebook").removeClass('show-me');console.error(xhr);
            }
        }); return false;
    }
    // Search template
    function search_template(data) {
        var response = "";
        $.each(data, function (key, val) {
            response += `<li><a href="?p=${val.path}&view=${val.name}">${val.path}/${val.name}</a></li>`;
        });
        return response;
    }
    // Advance search
    function fm_search() {
        var searchTxt = $("input#advanced-search").val(), searchWrapper = $("ul#search-wrapper"), path = $("#js-search-modal").attr("href"), _html = "", $loader = $("div.lds-facebook");
        if(!!searchTxt && searchTxt.length > 2 && path) {
            var data = {ajax: true, content: searchTxt, path:path, type: 'search', token: window.csrf };
            $.ajax({
                type: "POST",
                url: window.location,
                data: data,
                beforeSend: function() {
                    searchWrapper.html('');
                    $loader.addClass('show-me');
                },
                success: function(data){
                    $loader.removeClass('show-me');
                    data = JSON.parse(data);
                    if(data && data.length) {
                        _html = search_template(data);
                        searchWrapper.html(_html);
                    } else { searchWrapper.html('<p class="m-2">No result found!<p>'); }
                },
                error: function(xhr) { $loader.removeClass('show-me'); searchWrapper.html('<p class="m-2">ERROR: Try again later!</p>'); },
                failure: function(mes) { $loader.removeClass('show-me'); searchWrapper.html('<p class="m-2">ERROR: Try again later!</p>');}
            });
        } else { searchWrapper.html("OOPS: minimum 3 characters required!"); }
    }

    // action confirm dailog modal
    function confirmDailog(e, id = 0, title = "Action", content = "", action = null) {
        e.preventDefault();
        const tplObj = {id, title, content: decodeURIComponent(content.replace(/\+/g, ' ')), action};
        let tpl = $("#js-tpl-confirm").html();
        $(".modal.confirmDailog").remove();
        $('#wrapper').append(template(tpl,tplObj));
        const $confirmDailog = $("#confirmDailog-"+tplObj.id);
        $confirmDailog.modal('show');
        return false;
    }
    

    // on mouse hover image preview
    !function(s){s.previewImage=function(e){var o=s(document),t=".previewImage",a=s.extend({xOffset:20,yOffset:-20,fadeIn:"fast",css:{padding:"5px",border:"1px solid #cccccc","background-color":"#fff"},eventSelector:"[data-preview-image]",dataKey:"previewImage",overlayId:"preview-image-plugin-overlay"},e);return o.off(t),o.on("mouseover"+t,a.eventSelector,function(e){s("p#"+a.overlayId).remove();var o=s("<p>").attr("id",a.overlayId).css("position","absolute").css("display","none").append(s('<img class="c-preview-img">').attr("src",s(this).data(a.dataKey)));a.css&&o.css(a.css),s("body").append(o),o.css("top",e.pageY+a.yOffset+"px").css("left",e.pageX+a.xOffset+"px").fadeIn(a.fadeIn)}),o.on("mouseout"+t,a.eventSelector,function(){s("#"+a.overlayId).remove()}),o.on("mousemove"+t,a.eventSelector,function(e){s("#"+a.overlayId).css("top",e.pageY+a.yOffset+"px").css("left",e.pageX+a.xOffset+"px")}),this},s.previewImage()}(jQuery);

    // Dom Ready Events
    $(document).ready( function () {
        // dataTable init
        var $table = $('#main-table'),
            tableLng = $table.find('th').length,
            _targets = (tableLng && tableLng == 7 ) ? [0, 4,5,6] : tableLng == 5 ? [0,4] : [3];
            mainTable = $('#main-table').DataTable({paging: false, info: false, order: [], columnDefs: [{targets: _targets, orderable: false}]
        });
        // filter table
        $('#search-addon').on( 'keyup', function () {
            mainTable.search( this.value ).draw();
        });
        $("input#advanced-search").on('keyup', function (e) {
            if (e.keyCode === 13) { fm_search(); }
        });
        $('#search-addon3').on( 'click', function () { fm_search(); });
        //upload nav tabs
        $(".fm-upload-wrapper .card-header-tabs").on("click", 'a', function(e){
            e.preventDefault();let target=$(this).data('target');
            $(".fm-upload-wrapper .card-header-tabs a").removeClass('active');$(this).addClass('active');
            $(".fm-upload-wrapper .card-tabs-container").addClass('hidden');$(target).removeClass('hidden');
        });
    });
</script>
<?php if (isset($_GET['edit']) && isset($_GET['env']) && FM_EDIT_FILE && !FM_READONLY):
        
        $ext = pathinfo($_GET["edit"], PATHINFO_EXTENSION);
        $ext =  $ext == "js" ? "javascript" :  $ext;
        ?>
    <?php print_external('js-ace'); ?>
    <script>
        var editor = ace.edit("editor");
        editor.getSession().setMode( {path:"ace/mode/<?php echo $ext; ?>", inline:true} );
        //editor.setTheme("ace/theme/twilight"); //Dark Theme
        editor.setShowPrintMargin(false); // Hide the vertical ruler
        function ace_commend (cmd) { editor.commands.exec(cmd, editor); }
        editor.commands.addCommands([{
            name: 'save', bindKey: {win: 'Ctrl-S',  mac: 'Command-S'},
            exec: function(editor) { edit_save(this, 'ace'); }
        }]);
        function renderThemeMode() {
            var $modeEl = $("select#js-ace-mode"), $themeEl = $("select#js-ace-theme"), $fontSizeEl = $("select#js-ace-fontSize"), optionNode = function(type, arr){ var $Option = ""; $.each(arr, function(i, val) { $Option += "<option value='"+type+i+"'>" + val + "</option>"; }); return $Option; },
                _data = {"aceTheme":{"bright":{"chrome":"Chrome","clouds":"Clouds","crimson_editor":"Crimson Editor","dawn":"Dawn","dreamweaver":"Dreamweaver","eclipse":"Eclipse","github":"GitHub","iplastic":"IPlastic","solarized_light":"Solarized Light","textmate":"TextMate","tomorrow":"Tomorrow","xcode":"XCode","kuroir":"Kuroir","katzenmilch":"KatzenMilch","sqlserver":"SQL Server"},"dark":{"ambiance":"Ambiance","chaos":"Chaos","clouds_midnight":"Clouds Midnight","dracula":"Dracula","cobalt":"Cobalt","gruvbox":"Gruvbox","gob":"Green on Black","idle_fingers":"idle Fingers","kr_theme":"krTheme","merbivore":"Merbivore","merbivore_soft":"Merbivore Soft","mono_industrial":"Mono Industrial","monokai":"Monokai","pastel_on_dark":"Pastel on dark","solarized_dark":"Solarized Dark","terminal":"Terminal","tomorrow_night":"Tomorrow Night","tomorrow_night_blue":"Tomorrow Night Blue","tomorrow_night_bright":"Tomorrow Night Bright","tomorrow_night_eighties":"Tomorrow Night 80s","twilight":"Twilight","vibrant_ink":"Vibrant Ink"}},"aceMode":{"javascript":"JavaScript","abap":"ABAP","abc":"ABC","actionscript":"ActionScript","ada":"ADA","apache_conf":"Apache Conf","asciidoc":"AsciiDoc","asl":"ASL","assembly_x86":"Assembly x86","autohotkey":"AutoHotKey","apex":"Apex","batchfile":"BatchFile","bro":"Bro","c_cpp":"C and C++","c9search":"C9Search","cirru":"Cirru","clojure":"Clojure","cobol":"Cobol","coffee":"CoffeeScript","coldfusion":"ColdFusion","csharp":"C#","csound_document":"Csound Document","csound_orchestra":"Csound","csound_score":"Csound Score","css":"CSS","curly":"Curly","d":"D","dart":"Dart","diff":"Diff","dockerfile":"Dockerfile","dot":"Dot","drools":"Drools","edifact":"Edifact","eiffel":"Eiffel","ejs":"EJS","elixir":"Elixir","elm":"Elm","erlang":"Erlang","forth":"Forth","fortran":"Fortran","fsharp":"FSharp","fsl":"FSL","ftl":"FreeMarker","gcode":"Gcode","gherkin":"Gherkin","gitignore":"Gitignore","glsl":"Glsl","gobstones":"Gobstones","golang":"Go","graphqlschema":"GraphQLSchema","groovy":"Groovy","haml":"HAML","handlebars":"Handlebars","haskell":"Haskell","haskell_cabal":"Haskell Cabal","haxe":"haXe","hjson":"Hjson","html":"HTML","html_elixir":"HTML (Elixir)","html_ruby":"HTML (Ruby)","ini":"INI","io":"Io","jack":"Jack","jade":"Jade","java":"Java","json":"JSON","jsoniq":"JSONiq","jsp":"JSP","jssm":"JSSM","jsx":"JSX","julia":"Julia","kotlin":"Kotlin","latex":"LaTeX","less":"LESS","liquid":"Liquid","lisp":"Lisp","livescript":"LiveScript","logiql":"LogiQL","lsl":"LSL","lua":"Lua","luapage":"LuaPage","lucene":"Lucene","makefile":"Makefile","markdown":"Markdown","mask":"Mask","matlab":"MATLAB","maze":"Maze","mel":"MEL","mixal":"MIXAL","mushcode":"MUSHCode","mysql":"MySQL","nix":"Nix","nsis":"NSIS","objectivec":"Objective-C","ocaml":"OCaml","pascal":"Pascal","perl":"Perl","perl6":"Perl 6","pgsql":"pgSQL","php_laravel_blade":"PHP (Blade Template)","php":"PHP","puppet":"Puppet","pig":"Pig","powershell":"Powershell","praat":"Praat","prolog":"Prolog","properties":"Properties","protobuf":"Protobuf","python":"Python","r":"R","razor":"Razor","rdoc":"RDoc","red":"Red","rhtml":"RHTML","rst":"RST","ruby":"Ruby","rust":"Rust","sass":"SASS","scad":"SCAD","scala":"Scala","scheme":"Scheme","scss":"SCSS","sh":"SH","sjs":"SJS","slim":"Slim","smarty":"Smarty","snippets":"snippets","soy_template":"Soy Template","space":"Space","sql":"SQL","sqlserver":"SQLServer","stylus":"Stylus","svg":"SVG","swift":"Swift","tcl":"Tcl","terraform":"Terraform","tex":"Tex","text":"Text","textile":"Textile","toml":"Toml","tsx":"TSX","twig":"Twig","typescript":"Typescript","vala":"Vala","vbscript":"VBScript","velocity":"Velocity","verilog":"Verilog","vhdl":"VHDL","visualforce":"Visualforce","wollok":"Wollok","xml":"XML","xquery":"XQuery","yaml":"YAML","django":"Django"},"fontSize":{8:8,10:10,11:11,12:12,13:13,14:14,15:15,16:16,17:17,18:18,20:20,22:22,24:24,26:26,30:30}};
            if(_data && _data.aceMode) { $modeEl.html(optionNode("ace/mode/", _data.aceMode)); }
            if(_data && _data.aceTheme) { var lightTheme = optionNode("ace/theme/", _data.aceTheme.bright), darkTheme = optionNode("ace/theme/", _data.aceTheme.dark); $themeEl.html("<optgroup label=\"Bright\">"+lightTheme+"</optgroup><optgroup label=\"Dark\">"+darkTheme+"</optgroup>");}
            if(_data && _data.fontSize) { $fontSizeEl.html(optionNode("", _data.fontSize)); }
            $modeEl.val( editor.getSession().$modeId );
            $themeEl.val( editor.getTheme() );
            $fontSizeEl.val(12).change(); //set default font size in drop down
        }

        $(function(){
            renderThemeMode();
            $(".js-ace-toolbar").on("click", 'button', function(e){
                e.preventDefault();
                let cmdValue = $(this).attr("data-cmd"), editorOption = $(this).attr("data-option");
                if(cmdValue && cmdValue != "none") {
                    ace_commend(cmdValue);
                } else if(editorOption) {
                    if(editorOption == "fullscreen") {
                        (void 0!==document.fullScreenElement&&null===document.fullScreenElement||void 0!==document.msFullscreenElement&&null===document.msFullscreenElement||void 0!==document.mozFullScreen&&!document.mozFullScreen||void 0!==document.webkitIsFullScreen&&!document.webkitIsFullScreen)
                        &&(editor.container.requestFullScreen?editor.container.requestFullScreen():editor.container.mozRequestFullScreen?editor.container.mozRequestFullScreen():editor.container.webkitRequestFullScreen?editor.container.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):editor.container.msRequestFullscreen&&editor.container.msRequestFullscreen());
                    } else if(editorOption == "wrap") {
                        let wrapStatus = (editor.getSession().getUseWrapMode()) ? false : true;
                        editor.getSession().setUseWrapMode(wrapStatus);
                    }
                }
            });
            $("select#js-ace-mode, select#js-ace-theme, select#js-ace-fontSize").on("change", function(e){
                e.preventDefault();
                let selectedValue = $(this).val(), selectionType = $(this).attr("data-type");
                if(selectedValue && selectionType == "mode") {
                    editor.getSession().setMode(selectedValue);
                } else if(selectedValue && selectionType == "theme") {
                    editor.setTheme(selectedValue);
                }else if(selectedValue && selectionType == "fontSize") {
                    editor.setFontSize(parseInt(selectedValue));
                }
            });
        });
    </script>
<?php endif; ?>
<div id="snackbar"></div>
</body>
</html>
<?php
}

/**
 * Language Translation System
 * @param string $txt
 * @return string
 */
function lng($txt) {
    global $lang;

    // English Language
    $tr['en']['AppName']        = 'Flix File Manager';      $tr['en']['AppTitle']           = 'File Manager';
    $tr['en']['Login']          = 'Sign in';                $tr['en']['Username']           = 'Username';
    $tr['en']['Password']       = 'Password';               $tr['en']['Logout']             = 'Sign Out';
    $tr['en']['Move']           = 'Move';                   $tr['en']['Copy']               = 'Copy';
    $tr['en']['Save']           = 'Save';                   $tr['en']['SelectAll']          = 'Select all';
    $tr['en']['UnSelectAll']    = 'Unselect all';           $tr['en']['File']               = 'File';
    $tr['en']['Back']           = 'Back';                   $tr['en']['Size']               = 'Size';
    $tr['en']['Perms']          = 'Perms';                  $tr['en']['Modified']           = 'Modified';
    $tr['en']['Owner']          = 'Owner';                  $tr['en']['Search']             = 'Search';
    $tr['en']['NewItem']        = 'New Item';               $tr['en']['Folder']             = 'Folder';
    $tr['en']['Delete']         = 'Delete';                 $tr['en']['Rename']             = 'Rename';
    $tr['en']['CopyTo']         = 'Copy to';                $tr['en']['DirectLink']         = 'Direct link';
    $tr['en']['UploadingFiles'] = 'Upload Files';           $tr['en']['ChangePermissions']  = 'Change Permissions';
    $tr['en']['Copying']        = 'Copying';                $tr['en']['CreateNewItem']      = 'Create New Item';
    $tr['en']['Name']           = 'Name';                   $tr['en']['AdvancedEditor']     = 'Advanced Editor';
    $tr['en']['Actions']        = 'Actions';                $tr['en']['Folder is empty']    = 'Folder is empty';
    $tr['en']['Upload']         = 'Upload';                 $tr['en']['Cancel']             = 'Cancel';
    $tr['en']['InvertSelection']= 'Invert Selection';       $tr['en']['DestinationFolder']  = 'Destination Folder';
    $tr['en']['ItemType']       = 'Item Type';              $tr['en']['ItemName']           = 'Item Name';
    $tr['en']['CreateNow']      = 'Create Now';             $tr['en']['Download']           = 'Download';
    $tr['en']['Open']           = 'Open';                   $tr['en']['UnZip']              = 'UnZip';
    $tr['en']['UnZipToFolder']  = 'UnZip to folder';        $tr['en']['Edit']               = 'Edit';
    $tr['en']['NormalEditor']   = 'Normal Editor';          $tr['en']['BackUp']             = 'Back Up';
    $tr['en']['SourceFolder']   = 'Source Folder';          $tr['en']['Files']              = 'Files';
    $tr['en']['Move']           = 'Move';                   $tr['en']['Change']             = 'Change';
    $tr['en']['Settings']       = 'Settings';               $tr['en']['Language']           = 'Language';        
    $tr['en']['ErrorReporting'] = 'Error Reporting';        $tr['en']['ShowHiddenFiles']    = 'Show Hidden Files';
    $tr['en']['Help']           = 'Help';                   $tr['en']['Created']            = 'Created';
    $tr['en']['Help Documents'] = 'Help Documents';         $tr['en']['Report Issue']       = 'Report Issue';
    $tr['en']['Generate']       = 'Generate';               $tr['en']['FullSize']           = 'Full Size';              
    $tr['en']['HideColumns']    = 'Hide Perms/Owner columns';$tr['en']['You are logged in'] = 'You are logged in';
    $tr['en']['Nothing selected']   = 'Nothing selected';   $tr['en']['Paths must be not equal']    = 'Paths must be not equal';
    $tr['en']['Renamed from']       = 'Renamed from';       $tr['en']['Archive not unpacked']       = 'Archive not unpacked';
    $tr['en']['Deleted']            = 'Deleted';            $tr['en']['Archive not created']        = 'Archive not created';
    $tr['en']['Copied from']        = 'Copied from';        $tr['en']['Permissions changed']        = 'Permissions changed';
    $tr['en']['to']                 = 'to';                 $tr['en']['Saved Successfully']         = 'Saved Successfully';
    $tr['en']['not found!']         = 'not found!';         $tr['en']['File Saved Successfully']    = 'File Saved Successfully';
    $tr['en']['Archive']            = 'Archive';            $tr['en']['Permissions not changed']    = 'Permissions not changed';
    $tr['en']['Select folder']      = 'Select folder';      $tr['en']['Source path not defined']    = 'Source path not defined';
    $tr['en']['already exists']     = 'already exists';     $tr['en']['Error while moving from']    = 'Error while moving from';
    $tr['en']['Create archive?']    = 'Create archive?';    $tr['en']['Invalid file or folder name']    = 'Invalid file or folder name';
    $tr['en']['Archive unpacked']   = 'Archive unpacked';   $tr['en']['File extension is not allowed']  = 'File extension is not allowed';
    $tr['en']['Root path']          = 'Root path';          $tr['en']['Error while renaming from']  = 'Error while renaming from';
    $tr['en']['File not found']     = 'File not found';     $tr['en']['Error while deleting items'] = 'Error while deleting items';
    $tr['en']['Moved from']         = 'Moved from';         $tr['en']['Generate new password hash'] = 'Generate new password hash';
    $tr['en']['Login failed. Invalid username or password'] = 'Login failed. Invalid username or password';
    $tr['en']['password_hash not supported, Upgrade PHP version'] = 'password_hash not supported, Upgrade PHP version';
    $tr['en']['Advanced Search']    = 'Advanced Search';    $tr['en']['Error while copying from']    = 'Error while copying from';
    $tr['en']['Invalid characters in file name']                = 'Invalid characters in file name';
    $tr['en']['FILE EXTENSION HAS NOT SUPPORTED']               = 'FILE EXTENSION HAS NOT SUPPORTED';
    $tr['en']['Selected files and folder deleted']              = 'Selected files and folder deleted';
    $tr['en']['Error while fetching archive info']              = 'Error while fetching archive info';
    $tr['en']['Delete selected files and folders?']             = 'Delete selected files and folders?';
    $tr['en']['Search file in folder and subfolders...']        = 'Search file in folder and subfolders...';
    $tr['en']['Access denied. IP restriction applicable']       = 'Access denied. IP restriction applicable';
    $tr['en']['Invalid characters in file or folder name']      = 'Invalid characters in file or folder name';
    $tr['en']['Operations with archives are not available']     = 'Operations with archives are not available';
    $tr['en']['File or folder with this path already exists']   = 'File or folder with this path already exists';

    $i18n = fm_get_translations($tr);
    $tr = $i18n ? $i18n : $tr;

    if (!strlen($lang)) $lang = 'en';
    if (isset($tr[$lang][$txt])) return fm_enc($tr[$lang][$txt]);
    else if (isset($tr['en'][$txt])) return fm_enc($tr['en'][$txt]);
    else return "$txt";
}

?>